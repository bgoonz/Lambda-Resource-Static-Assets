<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.es</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="conceptos-de-gesti√≥n-del-estado">Conceptos de gesti√≥n del estado</h1>
<h2 id="pre-lecture-prueba"><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/47">Pre-lecture prueba</a></h2>
<h3 id="introducci√≥n">Introducci√≥n</h3>
<p>A medida que una aplicaci√≥n web crece, mantener un seguimiento limpio de todos los flujos de datos se convierte en un desaf√≠o. Qu√© c√≥digo obtiene los datos, qu√© p√°gina los consume, d√≥nde y cu√°ndo debe actualizarse, es f√°cil terminar con un c√≥digo desordenado y dif√≠cil de mantener. Esto es especialmente cierto cuando necesita compartir datos entre diferentes p√°ginas de su aplicaci√≥n, por ejemplo, los datos del usuario. El concepto de <em>gesti√≥n estatal</em> siempre ha existido en todo tipo de programas, pero a medida que las aplicaciones web siguen creciendo en complejidad, ahora es un punto clave en el que pensar durante el desarrollo.</p>
<p>En esta parte final, revisaremos la aplicaci√≥n que creamos para repensar c√≥mo se administra el estado, lo que permite la compatibilidad con la actualizaci√≥n del navegador en cualquier momento y la persistencia de datos en las sesiones de los usuarios.</p>
<h3 id="requisito-previo">Requisito previo</h3>
<p>Debe haber completado la parte <a href="../3-data/README.md">obtenci√≥n de datos</a> de la aplicaci√≥n web para esta lecci√≥n. Tambi√©n necesita instalar <a href="https://nodejs.org">Node.js</a> y <a href="../api/README.md">ejecutar la API del servidor</a> localmente para poder administrar los datos de la cuenta.</p>
<p>Puede probar que el servidor est√° funcionando correctamente ejecutando este comando en una terminal:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="ex">curl</span> http://localhost:5000/api</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="co"># -&gt; debe devolver &quot;API bancaria v1.0.0&quot; como resultado</span></a></code></pre></div>
<hr />
<h2 id="repensar-la-gesti√≥n-del-estado">Repensar la gesti√≥n del estado</h2>
<p>En la <a href="../3-data/README.md">lecci√≥n anterior</a>, introdujimos un concepto b√°sico de estado en nuestra aplicaci√≥n con la variable global <code>account</code> que contiene los datos bancarios del usuario actualmente conectado. Sin embargo, nuestra implementaci√≥n actual tiene algunas fallas. Intente actualizar la p√°gina cuando est√© en el panel. ¬øLo que pasa?</p>
<p>Hay 3 problemas con el c√≥digo actual:</p>
<ul>
<li>El estado no persiste, ya que una actualizaci√≥n del navegador lo lleva de regreso a la p√°gina de inicio de sesi√≥n.</li>
<li>Hay m√∫ltiples funciones que modifican el estado. A medida que la aplicaci√≥n crece, puede dificultar el seguimiento de los cambios y es f√°cil olvidarse de actualizar uno.</li>
<li>El estado no se limpia, cuando hace clic en <em>Cerrar sesi√≥n</em>, los datos de la cuenta siguen ah√≠ aunque est√© en la p√°gina de inicio de sesi√≥n.</li>
</ul>
<p>Podr√≠amos actualizar nuestro c√≥digo para abordar estos problemas uno por uno, pero crear√≠a m√°s duplicaci√≥n de c√≥digo y har√≠a que la aplicaci√≥n sea m√°s compleja y dif√≠cil de mantener. O podr√≠amos hacer una pausa por unos minutos y repensar nuestra estrategia.</p>
<blockquote>
<p>¬øQu√© problemas estamos realmente tratando de resolver aqu√≠?</p>
</blockquote>
<p>La <a href="https://en.wikipedia.org/wiki/State_management">gesti√≥n del estado</a> se trata de encontrar un buen enfoque para resolver estos dos problemas particulares:</p>
<ul>
<li>¬øC√≥mo mantener los flujos de datos en una aplicaci√≥n f√°ciles de entender?</li>
<li>¬øC√≥mo mantener los datos de estado siempre sincronizados con la interfaz de usuario (y viceversa)?</li>
</ul>
<p>Una vez que se haya ocupado de esto, es posible que cualquier otro problema que pueda tener ya est√© solucionado o que sea m√°s f√°cil de solucionar. Hay muchos enfoques posibles para resolver estos problemas, pero optaremos por una soluci√≥n com√∫n que consiste en <strong>centralizar los datos y las formas de cambiarlos</strong>. Los flujos de datos ser√≠an as√≠:</p>
<p><img src="./images/data-flow.png" /></p>
<blockquote>
<p>No cubriremos aqu√≠ la parte en la que los datos activan autom√°ticamente la actualizaci√≥n de la vista, ya que est√° vinculada a conceptos m√°s avanzados de <a href="https://en.wikipedia.org/wiki/Reactive_programming">Programaci√≥n reactiva</a>. Es un buen tema de seguimiento si est√°s preparado para una inmersi√≥n profunda.</p>
</blockquote>
<p>‚úÖ Hay muchas bibliotecas con diferentes enfoques para la administraci√≥n del estado, <a href="https://redux.js.org">Redux</a> es una opci√≥n popular. Eche un vistazo a los conceptos y patrones utilizados, ya que a menudo es una buena manera de aprender qu√© problemas potenciales puede enfrentar en aplicaciones web grandes y c√≥mo se pueden resolver.</p>
<h3 id="tarea">Tarea</h3>
<p>Comenzaremos con un poco de refactorizaci√≥n. Reemplace la declaraci√≥n <code>account</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">let</span> account <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></a></code></pre></div>
<p>Con:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">let</span> state <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="dt">account</span><span class="op">:</span> <span class="kw">null</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="op">};</span></a></code></pre></div>
<p>La idea es <em>centralizar</em> todos los datos de nuestra aplicaci√≥n en un solo objeto de estado. Solo tenemos ‚Äúcuenta‚Äù por ahora en el estado, por lo que no cambia mucho, pero crea un camino f√°cil para las evoluciones.</p>
<p>Tambi√©n tenemos que actualizar las funciones us√°ndolo. En las funciones <code>register()</code> y <code>login()</code>, reemplace <code>account=...</code> con <code>state.account=...</code>;</p>
<p>En la parte superior de la funci√≥n <code>updateDashboard()</code>, agregue esta l√≠nea:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">const</span> account <span class="op">=</span> <span class="va">state</span>.<span class="at">account</span><span class="op">;</span></a></code></pre></div>
<p>Esta refactorizaci√≥n por s√≠ sola no trajo muchas mejoras, pero la idea era sentar las bases para los pr√≥ximos cambios.</p>
<h2 id="seguimiento-de-cambios-de-datos">Seguimiento de cambios de datos</h2>
<p>Ahora que hemos implementado el objeto <code>state</code> para almacenar nuestros datos, el siguiente paso es centralizar las actualizaciones. El objetivo es facilitar el seguimiento de los cambios y cu√°ndo ocurren.</p>
<p>Para evitar que se realicen cambios en el objeto <code>state</code>, tambi√©n es una buena pr√°ctica considerarlo <a href="https://en.wikipedia.org/wiki/Immutable_object"><em>inmutable</em></a>, lo que significa que no se puede modificar en absoluto. Tambi√©n significa que debe crear un nuevo objeto de estado si desea cambiar algo en √©l. Al hacer esto, crea una protecci√≥n contra <a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">efectos secundarios</a> potencialmente no deseados y abre posibilidades para nuevas funciones en su aplicaci√≥n, como implementar deshacer / rehacer, al mismo tiempo que facilita la depuraci√≥n. Por ejemplo, puede registrar todos los cambios realizados en el estado y mantener un historial de los cambios para comprender el origen de un error.</p>
<p>En JavaScript, puede usar <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze"><code>Object.freeze()</code></a> para crear una versi√≥n inmutable de un objeto. Si intenta realizar cambios en un objeto inmutable, se generar√° una excepci√≥n.</p>
<p>‚úÖ ¬øConoce la diferencia entre un objeto <em>superficial</em> y un objeto inmutable <em>profundo</em>? Puede leer sobre esto <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze#What_is_shallow_freeze">aqu√≠</a>.</p>
<h3 id="tarea-1">Tarea</h3>
<p>Creemos una nueva funci√≥n <code>updateState()</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">function</span> <span class="at">updateState</span>(property<span class="op">,</span> newData) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">  state <span class="op">=</span> <span class="va">Object</span>.<span class="at">freeze</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb5-3" title="3">    ...<span class="at">state</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-4" title="4">    [property]<span class="op">:</span> newData</a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="op">}</span></a></code></pre></div>
<p>En esta funci√≥n, estamos creando un nuevo objeto de estado y copiamos datos del estado anterior usando el operador <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Operators/Spread_syntax#Spread_in_object_literals"><em>spread (<code>...</code>)</em></a>. Luego anulamos una propiedad particular del objeto de estado con los nuevos datos usando la <a href="https://developer.mozilla.org/docs/Web/JavaScript/Guide/Working_with_Objects#Objects_and_properties">notaci√≥n de corchetes</a> <code>[property]</code> para asignaci√≥n. Finalmente, bloqueamos el objeto para evitar modificaciones usando <code>Object.freeze()</code>. Solo tenemos la propiedad <code>account</code> almacenada en el estado por ahora, pero con este enfoque puede agregar tantas propiedades como necesite en el estado.</p>
<p>Tambi√©n actualizaremos la inicializaci√≥n del <code>estado</code> para asegurarnos de que el estado inicial tambi√©n est√© congelado:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">let</span> state <span class="op">=</span> <span class="va">Object</span>.<span class="at">freeze</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="dt">account</span><span class="op">:</span> <span class="kw">null</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Despu√©s de eso, actualice la funci√≥n <code>register</code> reemplazando la asignaci√≥n <code>state.account = result;</code> con:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="at">updateState</span>(<span class="st">&#39;account&#39;</span><span class="op">,</span> result)<span class="op">;</span></a></code></pre></div>
<p>Haz lo mismo con la funci√≥n <code>login</code>, reemplazando <code>state.account = data;</code> con:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="at">updateState</span>(<span class="st">&#39;account&#39;</span><span class="op">,</span> data)<span class="op">;</span></a></code></pre></div>
<p>Ahora aprovecharemos la oportunidad para solucionar el problema de que los datos de la cuenta no se borran cuando el usuario hace clic en <em>Cerrar sesi√≥n</em>.</p>
<p>Cree una nueva funci√≥n <code>logout()</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">function</span> <span class="at">logout</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">  <span class="at">updateState</span>(<span class="st">&#39;account&#39;</span><span class="op">,</span> <span class="kw">null</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-3" title="3">  <span class="at">navigate</span>(<span class="st">&#39;/login&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>En <code>updateDashboard()</code>, reemplace la redirecci√≥n <code>return navigate('/login');</code> por <code>return logout()</code>;</p>
<p>Intente registrar una nueva cuenta, cierre la sesi√≥n y vuelva a iniciarla para comprobar que todo sigue funcionando correctamente.</p>
<blockquote>
<p>Consejo: puede echar un vistazo a todos los cambios de estado agregando <code>console.log(state)</code> en la parte inferior de <code>updateState()</code> y abriendo la consola en las herramientas de desarrollo de su navegador.</p>
</blockquote>
<h2 id="persiste-el-estado">Persiste el estado</h2>
<p>La mayor√≠a de las aplicaciones web necesitan conservar los datos para poder funcionar correctamente. Todos los datos cr√≠ticos generalmente se almacenan en una base de datos y se accede a ellos a trav√©s de una API de servidor, como los datos de la cuenta de usuario en nuestro caso. Pero a veces, tambi√©n es interesante conservar algunos datos en la aplicaci√≥n cliente que se ejecuta en su navegador, para una mejor experiencia de usuario o para mejorar el rendimiento de carga.</p>
<p>Cuando desee conservar los datos en su navegador, hay algunas preguntas importantes que debe hacerse:</p>
<ul>
<li><em>¬øSon los datos confidenciales?</em> Debe evitar almacenar datos confidenciales en el cliente, como contrase√±as de usuario.</li>
<li><em>¬øPor cu√°nto tiempo necesita conservar estos datos?</em> ¬øPlanea acceder a estos datos solo para la sesi√≥n actual o desea que se almacenen para siempre?</li>
</ul>
<p>Hay varias formas de almacenar informaci√≥n dentro de una aplicaci√≥n web, dependiendo de lo que desee lograr. Por ejemplo, puede utilizar las URL para almacenar una consulta de b√∫squeda y hacer que se pueda compartir entre los usuarios. Tambi√©n puede utilizar <a href="https://developer.mozilla.org/docs/Web/HTTP/Cookies">cookies HTTP</a> si los datos deben compartirse con el servidor, como <a href="https://en.wikipedia.org/wiki/Authentication">autenticaci√≥n</a> informaci√≥n.</p>
<p>Otra opci√≥n es utilizar una de las muchas API del navegador para almacenar datos. Dos de ellos son particularmente interesantes:</p>
<ul>
<li><a href="https://developer.mozilla.org/docs/Web/API/Window/localStorage"><code>localStorage</code></a>: un <a href="https://en.wikipedia.org/wiki/Key%E2%80%93value_database">almac√©n de claves / valores</a> que permite conservar datos espec√≠ficos del sitio web actual en diferentes sesiones. Los datos guardados en √©l nunca caducan.</li>
<li><a href="https://developer.mozilla.org/docs/Web/API/Window/sessionStorage"><code>sessionStorage</code></a>: este funciona igual que <code>localStorage</code> excepto que los datos almacenados en √©l son se borra cuando finaliza la sesi√≥n (cuando se cierra el navegador).</li>
</ul>
<p>Tenga en cuenta que estas dos API solo permiten almacenar <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String">cadenas</a>. Si desea almacenar objetos complejos, deber√° serializarlos al formato <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON">JSON</a> usando <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify"><code>JSON.stringify()</code></a>.</p>
<p>‚úÖ Si desea crear una aplicaci√≥n web que no funcione con un servidor, tambi√©n es posible crear una base de datos en el cliente usando la <a href="https://developer.mozilla.org/docs/Web/API/IndexedDB_API">API de IndexedDB</a>. Este est√° reservado para casos de uso avanzados o si necesita almacenar una cantidad significativa de datos, ya que es m√°s complejo de usar.</p>
<h3 id="tarea-2">Tarea</h3>
<p>Queremos que nuestros usuarios permanezcan conectados hasta que hagan clic expl√≠citamente en el bot√≥n <em>Cerrar sesi√≥n</em>, por lo que usaremos <code>localStorage</code> para almacenar los datos de la cuenta. Primero, definamos una clave que usaremos para almacenar nuestros datos.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">const</span> storageKey <span class="op">=</span> <span class="st">&#39;savedAccount&#39;</span><span class="op">;</span></a></code></pre></div>
<p>Luego agregue esta l√≠nea al final de la funci√≥n <code>updateState()</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="va">localStorage</span>.<span class="at">setItem</span>(storageKey<span class="op">,</span> <span class="va">JSON</span>.<span class="at">stringify</span>(<span class="va">state</span>.<span class="at">account</span>))<span class="op">;</span></a></code></pre></div>
<p>Con esto, los datos de la cuenta de usuario ser√°n persistentes y siempre actualizados ya que centralizamos previamente todas nuestras actualizaciones de estado. Aqu√≠ es donde comenzamos a beneficiarnos de todas nuestras refactorizaciones anteriores üôÇ.</p>
<p>A medida que se guardan los datos, tambi√©n tenemos que encargarnos de restaurarlos cuando se carga la aplicaci√≥n. Ya que comenzaremos a tener m√°s c√≥digo de inicializaci√≥n, puede ser una buena idea crear una nueva funci√≥n <code>init</code>, que tambi√©n incluya nuestro c√≥digo anterior al final de <code>app.js</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">function</span> <span class="at">init</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="kw">const</span> savedAccount <span class="op">=</span> <span class="va">localStorage</span>.<span class="at">getItem</span>(storageKey)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="cf">if</span> (savedAccount) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-4" title="4">    <span class="at">updateState</span>(<span class="st">&#39;account&#39;</span><span class="op">,</span> <span class="va">JSON</span>.<span class="at">parse</span>(savedAccount))<span class="op">;</span></a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7">  <span class="co">// Nuestro c√≥digo de inicializaci√≥n anterior</span></a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="va">window</span>.<span class="at">onpopstate</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="at">updateRoute</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb12-9" title="9">  <span class="at">updateRoute</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="op">}</span></a>
<a class="sourceLine" id="cb12-11" title="11"></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="at">init</span>()<span class="op">;</span></a></code></pre></div>
<p>Aqu√≠ recuperamos los datos guardados y, si hay alguno, actualizamos el estado en consecuencia. Es importante hacer esto <em>antes</em> de actualizar la ruta, ya que puede haber un c√≥digo que dependa del estado durante la actualizaci√≥n de la p√°gina.</p>
<p>Tambi√©n podemos hacer que la p√°gina <em>Panel de control</em> sea nuestra p√°gina predeterminada de la aplicaci√≥n, ya que ahora estamos conservando los datos de la cuenta. Si no se encuentran datos, el panel se encarga de redirigir a la p√°gina <em>Iniciar sesi√≥n</em> de todos modos. En <code>updateRoute()</code>, reemplace el respaldo <code>return navigate('/login');</code> con <code>return navigate('dashboard');</code>.</p>
<p>Ahora inicie sesi√≥n en la aplicaci√≥n e intente actualizar la p√°gina, debe permanecer en el tablero. Con esa actualizaci√≥n nos hemos ocupado de todos nuestros problemas iniciales ‚Ä¶</p>
<h2 id="actualizar-los-datos">Actualizar los datos</h2>
<p>‚Ä¶ Pero tambi√©n podr√≠amos haber creado uno nuevo. Oups.</p>
<p>Vaya al panel de control con la cuenta <code>test</code>, luego ejecute este comando en una terminal para crear una nueva transacci√≥n:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode sh"><code class="sourceCode bash"><a class="sourceLine" id="cb13-1" title="1"><span class="ex">curl</span> --request POST \</a>
<a class="sourceLine" id="cb13-2" title="2">     --header <span class="st">&quot;Content-Type: application/json&quot;</span> \</a>
<a class="sourceLine" id="cb13-3" title="3">     --data <span class="st">&quot;{ </span><span class="dt">\&quot;</span><span class="st">date</span><span class="dt">\&quot;</span><span class="st">: </span><span class="dt">\&quot;</span><span class="st">2020-07-24</span><span class="dt">\&quot;</span><span class="st">, </span><span class="dt">\&quot;</span><span class="st">object</span><span class="dt">\&quot;</span><span class="st">: </span><span class="dt">\&quot;</span><span class="st">Bought book</span><span class="dt">\&quot;</span><span class="st">, </span><span class="dt">\&quot;</span><span class="st">amount</span><span class="dt">\&quot;</span><span class="st">: -20 }&quot;</span> \</a>
<a class="sourceLine" id="cb13-4" title="4">     http://localhost:5000/api/accounts/test/transactions</a></code></pre></div>
<p>Intente actualizar la p√°gina del panel en el navegador ahora. ¬øLo que pasa? ¬øVes la nueva transacci√≥n?</p>
<p>El estado se conserva indefinidamente gracias al <code>localStorage</code>, pero eso tambi√©n significa que nunca se actualiza hasta que cierre la sesi√≥n de la aplicaci√≥n y vuelva a iniciarla.</p>
<p>Una posible estrategia para solucionarlo es volver a cargar los datos de la cuenta cada vez que se carga el panel, para evitar que se atasquen los datos.</p>
<h3 id="tarea-3">Tarea</h3>
<p>Cree una nueva funci√≥n <code>updateAccountData</code>:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">updateAccountData</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="kw">const</span> account <span class="op">=</span> <span class="va">state</span>.<span class="at">account</span><span class="op">;</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="cf">if</span> (<span class="op">!</span>account) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-4" title="4">    <span class="cf">return</span> <span class="at">logout</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb14-5" title="5">  <span class="op">}</span></a>
<a class="sourceLine" id="cb14-6" title="6"></a>
<a class="sourceLine" id="cb14-7" title="7">  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> <span class="at">getAccount</span>(<span class="va">account</span>.<span class="at">user</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-8" title="8">  <span class="cf">if</span> (<span class="va">data</span>.<span class="at">error</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-9" title="9">    <span class="cf">return</span> <span class="at">logout</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb14-10" title="10">  <span class="op">}</span></a>
<a class="sourceLine" id="cb14-11" title="11"></a>
<a class="sourceLine" id="cb14-12" title="12">  <span class="at">updateState</span>(<span class="st">&#39;account&#39;</span><span class="op">,</span> data)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-13" title="13"><span class="op">}</span></a></code></pre></div>
<p>Este m√©todo comprueba que estamos conectados actualmente y luego vuelve a cargar los datos de la cuenta desde el servidor.</p>
<p>Cree otro nombre de funci√≥n <code>refresh</code>:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">async</span> <span class="kw">function</span> <span class="at">refresh</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">  <span class="cf">await</span> <span class="at">updateAccountData</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-3" title="3">  <span class="at">updateDashboard</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>√âste actualiza los datos de la cuenta, luego se encarga de actualizar el HTML de la p√°gina del tablero. Es lo que necesitamos llamar cuando se carga la ruta del tablero. Actualice la definici√≥n de ruta con:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="kw">const</span> routes <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">  <span class="st">&#39;/login&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;login&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb16-3" title="3">  <span class="st">&#39;/dashboard&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;dashboard&#39;</span><span class="op">,</span> <span class="dt">init</span><span class="op">:</span> refresh <span class="op">}</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>Intente volver a cargar el panel ahora, deber√≠a mostrar los datos de la cuenta actualizados.</p>
<hr />
<h2 id="desaf√≠o">üöÄ Desaf√≠o</h2>
<p>Ahora que recargamos los datos de la cuenta cada vez que se carga el panel, ¬øcree que a√∫n necesitamos conservar <em>todos los datos de la cuenta</em>?</p>
<p>Intente trabajar juntos para cambiar lo que se guarda y carga desde <code>localStorage</code> para incluir solo lo que es absolutamente necesario para que la aplicaci√≥n funcione.</p>
<h2 id="post-lecture-prueba"><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/48">Post-lecture prueba</a></h2>
<h2 id="asignaci√≥n">Asignaci√≥n</h2>
<p><a href="assignment.es.md">Implementar el cuadro de di√°logo ‚ÄúAgregar transacci√≥n‚Äù</a></p>
<p>Aqu√≠ hay un ejemplo de resultado despu√©s de completar la tarea:</p>
<figure>
<img src="../images/dialog.png" alt="Captura de pantalla que muestra un ejemplo de di√°logo ‚ÄúAgregar transacci√≥n‚Äù" /><figcaption>Captura de pantalla que muestra un ejemplo de di√°logo ‚ÄúAgregar transacci√≥n‚Äù</figcaption>
</figure>
</body>
</html>
