<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes"
    />
    <title>3-async-redux</title>
    <style type="text/css">
      code {
        white-space: pre-wrap;
      }
      span.smallcaps {
        font-variant: small-caps;
      }
      span.underline {
        text-decoration: underline;
      }
      div.column {
        display: inline-block;
        vertical-align: top;
        width: 50%;
      }
    </style>
    <style type="text/css">
      a.sourceLine {
        display: inline-block;
        line-height: 1.25;
      }
      a.sourceLine {
        pointer-events: none;
        color: inherit;
        text-decoration: inherit;
      }
      a.sourceLine:empty {
        height: 1.2em;
      }
      .sourceCode {
        overflow: visible;
      }
      code.sourceCode {
        white-space: pre;
        position: relative;
      }
      div.sourceCode {
        margin: 1em 0;
      }
      pre.sourceCode {
        margin: 0;
      }
      @media screen {
        div.sourceCode {
          overflow: auto;
        }
      }
      @media print {
        code.sourceCode {
          white-space: pre-wrap;
        }
        a.sourceLine {
          text-indent: -1em;
          padding-left: 1em;
        }
      }
      pre.numberSource a.sourceLine {
        position: relative;
        left: -4em;
      }
      pre.numberSource a.sourceLine::before {
        content: attr(title);
        position: relative;
        left: -1em;
        text-align: right;
        vertical-align: baseline;
        border: none;
        pointer-events: all;
        display: inline-block;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        padding: 0 4px;
        width: 4em;
        color: #aaaaaa;
      }
      pre.numberSource {
        margin-left: 3em;
        border-left: 1px solid #aaaaaa;
        padding-left: 4px;
      }
      div.sourceCode {
      }
      @media screen {
        a.sourceLine::before {
          text-decoration: underline;
        }
      }
      code span.al {
        color: #ff0000;
        font-weight: bold;
      } /* Alert */
      code span.an {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Annotation */
      code span.at {
        color: #7d9029;
      } /* Attribute */
      code span.bn {
        color: #40a070;
      } /* BaseN */
      code span.bu {
      } /* BuiltIn */
      code span.cf {
        color: #007020;
        font-weight: bold;
      } /* ControlFlow */
      code span.ch {
        color: #4070a0;
      } /* Char */
      code span.cn {
        color: #880000;
      } /* Constant */
      code span.co {
        color: #60a0b0;
        font-style: italic;
      } /* Comment */
      code span.cv {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* CommentVar */
      code span.do {
        color: #ba2121;
        font-style: italic;
      } /* Documentation */
      code span.dt {
        color: #902000;
      } /* DataType */
      code span.dv {
        color: #40a070;
      } /* DecVal */
      code span.er {
        color: #ff0000;
        font-weight: bold;
      } /* Error */
      code span.ex {
      } /* Extension */
      code span.fl {
        color: #40a070;
      } /* Float */
      code span.fu {
        color: #06287e;
      } /* Function */
      code span.im {
      } /* Import */
      code span.in {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Information */
      code span.kw {
        color: #007020;
        font-weight: bold;
      } /* Keyword */
      code span.op {
        color: #666666;
      } /* Operator */
      code span.ot {
        color: #007020;
      } /* Other */
      code span.pp {
        color: #bc7a00;
      } /* Preprocessor */
      code span.sc {
        color: #4070a0;
      } /* SpecialChar */
      code span.ss {
        color: #bb6688;
      } /* SpecialString */
      code span.st {
        color: #4070a0;
      } /* String */
      code span.va {
        color: #19177c;
      } /* Variable */
      code span.vs {
        color: #4070a0;
      } /* VerbatimString */
      code span.wa {
        color: #60a0b0;
        font-weight: bold;
        font-style: italic;
      } /* Warning */
    </style>
  </head>
  <body>
    <h1 id="async-redux">Async Redux</h1>
    <h2 id="goals">Goals</h2>
    <ul>
      <li>
        describe the Finite State Machine pattern and it‚Äôs relationship to
        building Redux applications
      </li>
      <li>
        implement Redux Middleware libraries into a Redux Store using
        <code>applyMiddleware</code>
      </li>
      <li>
        effectively use <code>redux-thunk</code> and asynchronous action
        creators to consume data from external API‚Äôs
      </li>
      <li>
        (new) introduce React Redux hooks, a modern alternative to
        <code>connect</code>
      </li>
    </ul>
    <h2 id="a-visual-example">A visual example</h2>
    <p>
      Here‚Äôs the Redux data flow visualized, with the addition of asynchronous
      API calls: <img src="images/redux_async.gif" alt="async Redux gif" />
    </p>
    <h2 id="a-real-world-example-Ô∏è">A real-world example ‚òïÔ∏è</h2>
    <p>
      Back to our coffee shop. Let‚Äôs consider just the step where we actually
      make the coffee.
    </p>
    <h3 id="part-1-lets-get-thunky">Part 1: let‚Äôs get thunky</h3>
    <p>
      When we dispatch <code>'MAKE_COFFEE'</code>, we‚Äôre actually looking to
      trigger a sequence of coffee-making actions. We could of course break
      everything down into individual steps, but all actions in Redux are
      <strong>synchronous</strong> by default. This means that each step has to
      complete before the next one starts. But would we really want to just
      watch the beans grind when we could be getting things done more efficently
      with some multiasking?
    </p>
    <p>
      Enter <code>redux-thunk</code>, A <em>middleware</em> that extends the
      functionality of Redux, allowing our actions to dispatch actions of their
      own and introduce more advanced behavior like API calls.
    </p>
    <p>
      Rather than simply passing an action type and payload to the reducer, we
      can start multiple processes at once and set up some intelligent
      multitasking. Start the bean grinder, then steam some milk while the beans
      grind. Once the beans are ground, then we can start the espresso machine.
      Once the espresso is brewed and milk frothed, then we can put it all
      together and serve the drink. All of that work can be divided up in an
      efficient way, even split among multiple employees and several espresso
      machines to handle more than one order at once. A production-scale web app
      may look more like a complex factory than a coffee shop, so this
      organization and asynchronous behavior becomes essential.
    </p>
    <h3 id="part-2-an-artisanal-oat-milk-experience">
      Part 2: an artisanal oat milk experience
    </h3>
    <p>
      Here‚Äôs how that <code>'MAKE_COFFEE'</code> step might look, as a more
      complex ‚Äúasynchronous action‚Äù with the newfound power to dispatch actions
      of its own:
    </p>
    <ul>
      <li>Dispatch <code>'GRIND_BEANS'</code></li>
      <li>Dispatch <code>'FROTH_MILK'</code></li>
      <li>
        When bean grinding is complete, dispatch <code>'BREW_ESPRESSO'</code>
      </li>
      <li>
        when <code>'BREW_ESPRESSO'</code> and <code>'FROTH_MILK'</code> are
        complete, dispatch <code>'PREPARE_MACCHIATO'</code>
      </li>
      <li>
        when macchiato is complete, update application state with
        <code>status: "complete"</code>
      </li>
    </ul>
    <p>
      Note the inherent multitasking involved ‚Äì this approach allows
      optimization and higher customer volume, because no one is stopping to
      stare while the beans grind :)
    </p>
    <h3 id="part-3-asynchronous-multitasking">
      Part 3: ‚Äòasynchronous‚Äô = multitasking
    </h3>
    <p>
      Note that there‚Äôs a specific order of operations, with some actions
      requiring others to complete before they can begin (for example: you need
      to grind beans before brewing espresso). <em>Synchronous</em> behavior
      means that all actions take place in sequential order, each waiting for
      the previous action to complete before starting.
      <em>Asynchronous</em> actions, on the other hand, can take place
      simultaneously and only wait for others when absolutely necessary. This
      more nuanced order of operations is essential for any kind of efficient
      process, and we all do this every day without having to think about it. In
      software development, this is called
      <em>asynchronous / non-blocking</em> behavior, and it‚Äôs a
      <strong>major üîë</strong> for building fast, responsive applications
      backed by an API.
    </p>
    <p>
      This kind of thing is common with asynchronous actions like API calls in
      React applications ‚Äì start the process, go do something else, then come
      back to handle the response when it‚Äôs complete.
    </p>
    <h2 id="api-backed-react-app-as-a-state-machine">
      API-backed React app as a state machine
    </h2>
    <figure>
      <img src="images/api_states.png" alt="API states diagram" />
      <figcaption>API states diagram</figcaption>
    </figure>
    <p>
      When making calls to an API from our React app with Redux, we can use the
      finite state machine concept (traffic light, locking door, etc) as a
      mental model for how we think about state changes in the application. In
      the diagram above, each bubble coresponds to a specific state which we
      could model with state variables like <code>loading: boolean</code> and
      <code>error: string</code>. Each arrow represents a state change, achieved
      by dispatching an action to the reducer. Here are some typical actions
      that we might dispatch as part of an API call:
    </p>
    <ul>
      <li>FETCHING_START (‚Äúrefresh‚Äù and ‚Äúfetch‚Äù arrows above)</li>
      <li>FETCHING_SUCCESS (‚Äúsuccess‚Äù arrow above)</li>
      <li>FETCHING_FAILURE (‚Äúfailure‚Äù arrow above)</li>
    </ul>
    <p>
      If you‚Äôre curious how this is done in larger, more complex applications,
      feel free to check out options like RxJS and redux-saga. For our purposes
      here we‚Äôll be focusing on one of the simplest approaches, Redux with thunk
      middleware.
    </p>
    <h2 id="redux-middleware">Redux Middleware</h2>
    <p>
      In the context of Redux, middleware is a way to extend the standard
      functionality with additional behavior, Middleware provides a third-party
      extension point after an action is disaptched, before it reaches the
      reducer:
    </p>
    <p>
      Dispatching an action -&gt; middleware -&gt; Action reaching the reducer
    </p>
    <p>
      Redux middleware is often used for logging, crash reporting, talking to an
      asynchronous API, routing, and more. <code>redux-logger</code> and
      <code>redux-thunk</code> are common examples of middleware used with
      Redux.
    </p>
    <p>
      To apply middleware, Redux provides a function called, of course,
      <code>applyMiddleware</code>. Here‚Äôs how we use it:
    </p>
    <div class="sourceCode" id="cb1">
      <pre
        class="sourceCode javascript"
      ><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> logger <span class="op">=</span> <span class="va">reduxLogger</span>.<span class="at">createLogger</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> store <span class="op">=</span> <span class="at">createStore</span>(rootReducer<span class="op">,</span> <span class="at">applyMiddleware</span>(logger))<span class="op">;</span></a></code></pre>
    </div>
    <h2
      id="putting-it-all-together-redux-redux-thunk-middleware-asynchronous-actions"
    >
      Putting it all together: Redux + redux-thunk middleware + asynchronous
      actions
    </h2>
    <p>
      In Redux, our reducers are <em>synchronous</em> by default. If we need to
      perform asynchronous operations, they need to happen before the actions
      reach the reducers. So this is why we use middleware to handle
      asynchronous requests.
    </p>
    <p>
      ‚ÄúThunk‚Äù is a name for a function that‚Äôs returned by another function. In
      Redux, actions are normally just objects, but Redux-thunk allows us to
      return functions instead of objects from our action creators, enabling
      more dynamic behavior. Then those functions can handle side effects like
      api calls, and also return regular actions to be handled by the reducer.
    </p>
    <p>Here‚Äôs a typical setup:</p>
    <ul>
      <li>Use redux-thunk as a middleware, and define async action creators</li>
      <li>
        Within those async actions, use axios to make requests to an api
        endpoint
      </li>
    </ul>
    <h2 id="react-redux-hooks-an-alternative-to-connect">
      React Redux Hooks (an alternative to <code>connect</code>)
    </h2>
    <p>
      React Redux has been updated to include a simpler approach to connect
      components to the Redux store: hooks! Just like React Router includes the
      <code>useParams</code> and <code>useHistory</code> custom hooks as modern
      upgrades over the older way of doing things, the React Redux library has
      joined the hooks party. With the newer hooks syntax, every action creator
      is basically a ‚Äúdispatching function‚Äù like the ones you write in a
      longform <code>mapDispatchToProps</code> (or the ones generated by
      <code>bindActionCreators</code> if you write the shortform version). With
      dispatch available in that scope, everything is just a bit more clear to
      understand at a glance, and the functionality we‚Äôve achieved here with
      thunk is already built-in with no need for middleware!
    </p>
    <p>Here‚Äôs a quick rundown:</p>
    <ul>
      <li>
        <code>useSelector</code> üëÄ to read state values from the Redux store
        (similar to <code>mapStateToProps</code>)
      </li>
      <li>
        <code>useDispatch</code> üöÄ to update the store (similar to
        <code>mapDispatchToProps</code>).
      </li>
    </ul>
    <p>
      As of 2021, <code>connect</code> is still widely used but hooks are now
      recommended as the default approach. Learning both is a great way to
      deepen your knowledge! Just like class components and function components,
      you‚Äôll be likely to encounter both at some point in your journey. Remember
      that all these different approaches really just amount to different
      syntax, so don‚Äôt worry about the details too much. The functionality is
      the same, and the most useful thing to focus on at this stage is building
      a strong understanding of the underlying concepts.
    </p>
    <p>From the React Redux docs:</p>
    <blockquote>
      <p>
        We recommend using the React-Redux hooks API as the default approach in
        your React components. The existing connect API still works and will
        continue to be supported, but the hooks API is simpler and works better
        with TypeScript.
      </p>
    </blockquote>
    <h2 id="more-resources">More Resources</h2>
    <h3 id="videos">Videos</h3>
    <ul>
      <li>
        <a href="https://www.youtube.com/watch?v=z2XCUu2wIl0"
          >Codevolution - Redux Thunk Middleware</a
        >
      </li>
    </ul>
    <h3 id="articles">Articles</h3>
    <ul>
      <li>
        <a
          href="https://medium.com/better-programming/handling-asynchronous-actions-in-redux-86724ed87c6c"
          >Handling Asynchronous Actions in Redux</a
        >
      </li>
      <li>
        <a href="https://www.notion.so/Redux-3ac5db784a1e4a1dbe9ecc7c15bbd9fd"
          >Redux by TL Megan Miller</a
        >
      </li>
      <li>
        <a href="https://redux.js.org/api/applymiddleware"
          >Redux applyMiddleware docs</a
        >
      </li>
      <li>
        <a href="https://daveceddia.com/what-is-a-thunk/">What is a thunk?</a>
      </li>
      <li><a href="https://github.com/reduxjs/redux-thunk">Redux-thunk</a></li>
    </ul>
    <h3 id="react-redux-hooks-articles">React Redux hooks articles</h3>
    <ul>
      <li>
        <a href="https://react-redux.js.org/api/hooks"
          >React Redux docs - hooks API</a
        >
      </li>
      <li>
        <a href="https://thoughtbot.com/blog/using-redux-with-react-hooks"
          >Using Redux with React Hooks</a
        >
      </li>
    </ul>
  </body>
</html>
