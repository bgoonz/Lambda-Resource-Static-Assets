<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.es</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="proyecto-de-extensi√≥n-del-navegador-parte-2-llamar-a-una-api-usar-almacenamiento-local">Proyecto de extensi√≥n del navegador, parte 2: llamar a una API, usar almacenamiento local</h1>
<h2 id="pre-lecture-prueba"><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/25">Pre-lecture prueba</a></h2>
<h3 id="introducci√≥n">Introducci√≥n:</h3>
<p>En esta lecci√≥n, llamar√° a una API enviando el formulario de la extensi√≥n de su navegador y mostrar√° los resultados en la extensi√≥n de su navegador. Adem√°s, aprender√° c√≥mo puede almacenar datos en el almacenamiento local de su navegador para referencia y uso futuros.</p>
<p>‚úÖ Siga los segmentos numerados en los archivos correspondientes para saber d√≥nde colocar su c√≥digo</p>
<h3 id="configure-los-elementos-para-manipular-en-la-extensi√≥n">1. Configure los elementos para manipular en la extensi√≥n:</h3>
<p>En este momento, ha creado el HTML para el formulario y los resultados <code>&lt;div&gt;</code> para la extensi√≥n de su navegador. De ahora en adelante, necesitar√° trabajar en el archivo <code>/src/index.js</code> y construir su extensi√≥n poco a poco. Consulte la <a href="../about-browsers/%20README.md">lecci√≥n anterior</a> sobre c√≥mo configurar su proyecto y el proceso de compilaci√≥n.</p>
<p>Trabajando en su archivo <code>index.js</code>, comience creando algunas variables <code>const</code> para contener los valores asociados con varios campos:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="co">// form fields</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> form <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.form-data&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">const</span> region <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.region-name&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">const</span> apiKey <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.api-key&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">// results</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">const</span> errors <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.errors&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">const</span> loading <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.loading&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">const</span> results <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.result-container&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">const</span> usage <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.carbon-usage&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">const</span> fossilfuel <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.fossil-fuel&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">const</span> myregion <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.my-region&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="kw">const</span> clearBtn <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.clear-btn&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Todos estos campos est√°n referenciados por su clase css, como lo configur√≥ en el HTML en la lecci√≥n anterior.</p>
<h3 id="agregar-oyentes">2. Agregar oyentes</h3>
<p>A continuaci√≥n, agregue detectores de eventos al formulario y el bot√≥n de borrar que restablece el formulario, de modo que si un usuario env√≠a el formulario o hace clic en ese bot√≥n de restablecimiento, algo suceder√° y agregue la llamada para inicializar la aplicaci√≥n en la parte inferior del archivo:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">form</span>.<span class="at">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> <span class="at">handleSubmit</span>(e))<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="va">clearBtn</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> <span class="at">reset</span>(e))<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="at">init</span>()<span class="op">;</span></a></code></pre></div>
<p>‚úÖ Observe la abreviatura que se usa para escuchar un evento de env√≠o o clic, y c√≥mo el evento se pasa a las funciones handleSubmit o reset. ¬øPuedes escribir el equivalente de esta abreviatura en un formato m√°s largo? ¬øCual prefieres?</p>
<h3 id="desarrolle-la-init-y-reset-funci√≥n">3. Desarrolle la init() y reset() funci√≥n:</h3>
<p>Ahora vas a construir la funci√≥n que inicializa la extensi√≥n, que se llama <code>init()</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">function</span> <span class="at">init</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="co">//si hay algo en localStorage, rec√≥jalo</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="kw">const</span> storedApiKey <span class="op">=</span> <span class="va">localStorage</span>.<span class="at">getItem</span>(<span class="st">&#39;apiKey&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="kw">const</span> storedRegion <span class="op">=</span> <span class="va">localStorage</span>.<span class="at">getItem</span>(<span class="st">&#39;regionName&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="co">//establecer el icono en verde gen√©rico</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="co">//todo</span></a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="cf">if</span> (storedApiKey <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> storedRegion <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-10" title="10">        <span class="co">//si no tenemos las claves, mostrar el formulario</span></a>
<a class="sourceLine" id="cb3-11" title="11">        <span class="va">form</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-12" title="12">        <span class="va">results</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-13" title="13">        <span class="va">loading</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-14" title="14">        <span class="va">clearBtn</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-15" title="15">        <span class="va">errors</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-16" title="16">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-17" title="17">        <span class="co">//si hemos guardado claves / regiones en localStorage, mostrar los resultados cuando se cargan</span></a>
<a class="sourceLine" id="cb3-18" title="18">        <span class="at">displayCarbonUsage</span>(storedApiKey<span class="op">,</span> storedRegion)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-19" title="19">        <span class="va">results</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-20" title="20">        <span class="va">form</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-21" title="21">        <span class="va">clearBtn</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-23" title="23"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25"><span class="kw">function</span> <span class="at">reset</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-26" title="26">    <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-27" title="27">    <span class="co">//borrar almacenamiento local solo para la regi√≥n</span></a>
<a class="sourceLine" id="cb3-28" title="28">    <span class="va">localStorage</span>.<span class="at">removeItem</span>(<span class="st">&#39;regionName&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-29" title="29">    <span class="at">init</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="op">}</span></a></code></pre></div>
<p>En esta funci√≥n, hay una l√≥gica interesante. Al leerlo, ¬øpuedes ver lo que sucede?</p>
<ul>
<li>Se configuran dos <code>const</code> para verificar si el usuario ha almacenado una clave API y un c√≥digo de regi√≥n en el almacenamiento local.</li>
<li>si alguno de ellos es nulo, muestre el formulario cambiando su estilo para que se muestre como ‚Äòbloque‚Äô</li>
<li>ocultar los resultados, cargar y borrarBtn y establecer cualquier texto de error en una cadena vac√≠a</li>
<li>si existe una clave y una regi√≥n, inicie una rutina para:
<ul>
<li>llamar a la API para obtener datos de uso de carbono</li>
<li>ocultar el √°rea de resultados</li>
<li>ocultar el formulario</li>
<li>mostrar el bot√≥n de reinicio</li>
</ul></li>
</ul>
<p>Antes de continuar, es √∫til conocer un concepto muy importante disponible en los navegadores: <a href="https://developer.mozilla.org/docs/Web/API/Window/localStorage">LocalStorage</a>. LocalStorage es una forma √∫til de almacenar cadenas en el navegador como un par ‚Äúclave-valor‚Äù. Este tipo de almacenamiento web puede ser manipulado por JavaScript para administrar datos en el navegador. LocalStorage no caduca, mientras que SessionStorage, otro tipo de almacenamiento web, se borra cuando se cierra el navegador. Los distintos tipos de almacenamiento tienen ventajas y desventajas para su uso.</p>
<blockquote>
<p>Nota: la extensi√≥n de su navegador tiene su propio almacenamiento local; la ventana principal del navegador es una instancia diferente y se comporta por separado.</p>
</blockquote>
<p>Configura su APIKey para que tenga un valor de cadena, por ejemplo, y puede ver que est√° configurado en Edge ‚Äúinspeccionando‚Äù una p√°gina web (puede hacer clic con el bot√≥n derecho en un navegador para inspeccionar) y yendo a la pesta√±a Aplicaciones para ver el almacenamiento.</p>
<figure>
<img src="images/localstorage.png" alt="Panel de almacenamiento local" /><figcaption>Panel de almacenamiento local</figcaption>
</figure>
<p>‚úÖ Piense en situaciones en las que NO le gustar√≠a almacenar algunos datos en LocalStorage. En general, colocar claves API en LocalStorage es una mala idea. ¬øPuedes ver por qu√©? En nuestro caso, dado que nuestra aplicaci√≥n es puramente para aprender y no se implementar√° en una tienda de aplicaciones, usaremos este m√©todo.</p>
<p>Tenga en cuenta que utiliza la API web para manipular LocalStorage, ya sea utilizando <code>getItem()</code>, <code>setItem()</code> o <code>removeItem()</code>. Es ampliamente compatible con todos los navegadores.</p>
<p>Antes de construir la funci√≥n <code>displayCarbonUsage()</code> que se llama en <code>init()</code>, construyamos la funcionalidad para manejar el env√≠o inicial del formulario.</p>
<h3 id="manejar-el-env√≠o-del-formulario">4. Manejar el env√≠o del formulario</h3>
<p>Cree una funci√≥n llamada <code>handleSubmit</code> que acepte un argumento de evento <code>(e)</code>. Detenga la propagaci√≥n del evento (en este caso, queremos que el navegador no se actualice) y llame a una nueva funci√≥n, <code>setUpUser</code>, pasando los argumentos <code>apiKey.value</code> y <code>region.value</code>. De esta manera, utiliza los dos valores que se introducen a trav√©s del formulario inicial cuando se completan los campos correspondientes.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">function</span> <span class="at">handleSubmit</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="at">setUpUser</span>(<span class="va">apiKey</span>.<span class="at">value</span><span class="op">,</span> <span class="va">region</span>.<span class="at">value</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>‚úÖ Refresque su memoria: el HTML que configur√≥ en la √∫ltima lecci√≥n tiene dos campos de entrada cuyos <code>values</code> se capturan mediante la <code>const</code> que configur√≥ en la parte superior del archivo, y ambos son <code>required</code> para que el navegador detenga a los usuarios de ingresar valores nulos.</p>
<h3 id="configurar-el-usuario">5. Configurar el usuario</h3>
<p>Pasando a la funci√≥n <code>setUpUser</code>, aqu√≠ es donde configura los valores de almacenamiento local para apiKey y regionName. Agrega una nueva funci√≥n:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">function</span> <span class="at">setUpUser</span>(apiKey<span class="op">,</span> regionName) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">    <span class="va">localStorage</span>.<span class="at">setItem</span>(<span class="st">&#39;apiKey&#39;</span><span class="op">,</span> apiKey)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="va">localStorage</span>.<span class="at">setItem</span>(<span class="st">&#39;regionName&#39;</span><span class="op">,</span> regionName)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="va">loading</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="va">errors</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="va">clearBtn</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="co">//make initial call</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="at">displayCarbonUsage</span>(apiKey<span class="op">,</span> regionName)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="op">}</span></a></code></pre></div>
<p>Esta funci√≥n establece un mensaje de carga para mostrar mientras se llama a la API. ¬°En este punto, ha llegado a crear la funci√≥n m√°s importante de esta extensi√≥n de navegador!</p>
<h3 id="visualizaci√≥n-del-uso-de-carbono">6. Visualizaci√≥n del uso de carbono</h3>
<p>¬°Finalmente es hora de consultar la API!</p>
<p>Antes de continuar, deber√≠amos discutir las API. Las API, o <a href="https://www.webopedia.com/TERM/A/API.html">Interfaces de programaci√≥n de aplicaciones</a>, son un elemento fundamental de la caja de herramientas de un desarrollador web. Proporcionan formas est√°ndar para que los programas interact√∫en e interact√∫en entre s√≠. Por ejemplo, si est√° creando un sitio web que necesita consultar una base de datos, alguien podr√≠a haber creado una API para que la use. Si bien hay muchos tipos de API, una de las m√°s populares es una <a href="https://www.smashingmagazine.com/2018/01/understanding-using-rest-api/">API REST</a>.</p>
<p>‚úÖ El t√©rmino ‚ÄòREST‚Äô significa ‚ÄòTransferencia de estado representacional‚Äô y caracter√≠sticas que utilizan URL configuradas de diversas formas para obtener datos. Investigue un poco sobre los distintos tipos de API disponibles para los desarrolladores. ¬øQu√© formato te atrae?</p>
<p>Hay cosas importantes a tener en cuenta sobre esta funci√≥n. Primero observe la palabra clave <code>async</code>. Escribir sus funciones para que se ejecuten de forma asincr√≥nica significa que</p>
<p>Cree una nueva funci√≥n para consultar la API C02Signal:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="im">import</span> axios <span class="im">from</span> <span class="st">&#39;../node_modules/axios&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">async</span> <span class="kw">function</span> <span class="at">displayCarbonUsage</span>(apiKey<span class="op">,</span> region) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="cf">await</span> axios</a>
<a class="sourceLine" id="cb6-6" title="6">            .<span class="at">get</span>(<span class="st">&#39;https://api.co2signal.com/v1/latest&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">                <span class="dt">params</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-8" title="8">                    <span class="dt">countryCode</span><span class="op">:</span> region<span class="op">,</span></a>
<a class="sourceLine" id="cb6-9" title="9">                <span class="op">},</span></a>
<a class="sourceLine" id="cb6-10" title="10">                <span class="dt">headers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-11" title="11">                    <span class="st">&#39;auth-token&#39;</span><span class="op">:</span> apiKey<span class="op">,</span></a>
<a class="sourceLine" id="cb6-12" title="12">                <span class="op">},</span></a>
<a class="sourceLine" id="cb6-13" title="13">            <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-14" title="14">            .<span class="at">then</span>((response) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-15" title="15">                <span class="kw">let</span> CO2 <span class="op">=</span> <span class="va">Math</span>.<span class="at">floor</span>(<span class="va">response</span>.<span class="va">data</span>.<span class="va">data</span>.<span class="at">carbonIntensity</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17">                <span class="co">//calculateColor(CO2);</span></a>
<a class="sourceLine" id="cb6-18" title="18"></a>
<a class="sourceLine" id="cb6-19" title="19">                <span class="va">loading</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-20" title="20">                <span class="va">form</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-21" title="21">                <span class="va">myregion</span>.<span class="at">textContent</span> <span class="op">=</span> region<span class="op">;</span></a>
<a class="sourceLine" id="cb6-22" title="22">                <span class="va">usage</span>.<span class="at">textContent</span> <span class="op">=</span></a>
<a class="sourceLine" id="cb6-23" title="23">                    <span class="va">Math</span>.<span class="at">round</span>(<span class="va">response</span>.<span class="va">data</span>.<span class="va">data</span>.<span class="at">carbonIntensity</span>) <span class="op">+</span> <span class="st">&#39; grams (grams C02 emitted per kilowatt hour)&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-24" title="24">                <span class="va">fossilfuel</span>.<span class="at">textContent</span> <span class="op">=</span></a>
<a class="sourceLine" id="cb6-25" title="25">                    <span class="va">response</span>.<span class="va">data</span>.<span class="va">data</span>.<span class="va">fossilFuelPercentage</span>.<span class="at">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-26" title="26">                    <span class="st">&#39;% (percentage of fossil fuels used to generate electricity)&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-27" title="27">                <span class="va">results</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-28" title="28">            <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-29" title="29">    <span class="op">}</span> <span class="cf">catch</span> (error) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-30" title="30">        <span class="va">console</span>.<span class="at">log</span>(error)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-31" title="31">        <span class="va">loading</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-32" title="32">        <span class="va">results</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-33" title="33">        <span class="va">errors</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;Sorry, we have no data for the region you have requested.&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-34" title="34">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-35" title="35"><span class="op">}</span></a></code></pre></div>
<p>Esta es una gran funci√≥n. ¬øQue est√° pasando aqui?</p>
<ul>
<li>siguiendo las mejores pr√°cticas, utiliza una palabra clave <code>async</code> para hacer que esta funci√≥n se comporte de forma as√≠ncrona. La funci√≥n contiene un bloque <code>try / catch</code> ya que devolver√° una promesa cuando la API devuelva datos. Debido a que no tiene control sobre la velocidad a la que responder√° la API (¬°es posible que no responda en absoluto!), Debe manejar esta incertidumbre llam√°ndola de forma asincr√≥nica.</li>
<li>est√° consultando la API co2signal para obtener los datos de su regi√≥n, utilizando su clave API. Para usar esa clave, debe usar un tipo de autenticaci√≥n en los par√°metros de su encabezado.</li>
<li>una vez que la API responde, asigna varios elementos de sus datos de respuesta a las partes de su pantalla que configura para mostrar estos datos.</li>
<li>si hay un error o si no hay ning√∫n resultado, muestra un mensaje de error.</li>
</ul>
<p>‚úÖ El uso de patrones de programaci√≥n as√≠ncronos es otra herramienta muy √∫til en su caja de herramientas. Lea <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function">acerca de las diversas formas</a> puede configurar este tipo de c√≥digo.</p>
<p>¬°Felicidades! Si construye su extensi√≥n (<code>npm run build</code>) y la actualiza en su panel de extensiones, ¬°tiene una extensi√≥n que funciona! Lo √∫nico que no funciona es el √≠cono, y lo solucionar√° en la pr√≥xima lecci√≥n.</p>
<hr />
<p>üöÄ Desaf√≠o: hemos discutido varios tipos de API hasta ahora en estas lecciones. Elija una API web e investigue en profundidad lo que ofrece. Por ejemplo, eche un vistazo a las API disponibles en los navegadores, como la <a href="https://developer.mozilla.org/docs/Web/API/HTML_Drag_and_Drop_API">API HTML de arrastrar y soltar</a>. En tu opini√≥n, ¬øqu√© hace que una API sea excelente?</p>
<h2 id="post-lecture-prueba"><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/26">Post-lecture prueba</a></h2>
<h2 id="revisi√≥n-y-autoestudio">Revisi√≥n y autoestudio</h2>
<p>Aprendi√≥ sobre LocalStorage y las API en esta lecci√≥n, ambos muy √∫tiles para el desarrollador web profesional. ¬øPuedes pensar en c√≥mo funcionan estas dos cosas juntas? Piense en c√≥mo dise√±ar√≠a un sitio web que almacenar√≠a elementos para ser utilizados por una API.</p>
<p><strong>Tarea</strong>: <a href="assignment.md">Adopte una API</a></p>
</body>
</html>
