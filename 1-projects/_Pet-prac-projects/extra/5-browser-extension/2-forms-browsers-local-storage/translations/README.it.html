<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.it</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="progetto-di-estensione-del-browser-parte-2-chiamare-unapi-utilizzare-local-storage">Progetto di Estensione del Browser Parte 2: Chiamare un‚ÄôAPI, utilizzare Local Storage</h1>
<h2 id="quiz-pre-lezione">Quiz Pre-Lezione</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/25?loc=it">Quiz Pre-Lezione</a></p>
<h3 id="introduzione">Introduzione</h3>
<p>In questa lezione, si chiamer√† un‚ÄôAPI inviando il form dell‚Äôestensione del browser e si visualizzeranno i risultati nell‚Äôestensione del browser. Inoltre, si imparer√† come archiviare i dati nella memoria locale del browser per riferimento e utilizzo futuri.</p>
<p>‚úÖ Seguire i segmenti numerati nei file appropriati per sapere dove posizionare il codice</p>
<h3 id="impostare-gli-elementi-da-manipolare-nellestensione">Impostare gli elementi da manipolare nell‚Äôestensione:</h3>
<p>A questo punto √® stato creato l‚ÄôHTML per il form e i risultati <code>&lt;div&gt;</code> per l‚Äôestensione del browser. D‚Äôora in poi, si dovr√† lavorare nel file <code>/src/index.js</code> e costruire la propria estensione un po ‚Äôalla volta. Si faccia riferimento alla <a href="../../1-about-browsers/translations/README.it.md">lezione precedente</a> su come impostare il progetto e sul processo di compilazione.</p>
<p>Lavorando nel file <code>index.js</code> , si inizia creando alcune variabili <code>const</code> per contenere i valori associati ai vari campi:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="co">// campi del form</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">const</span> form <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.form-data&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">const</span> region <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.region-name&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">const</span> apiKey <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.api-key&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="co">// risultati</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">const</span> errors <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.errors&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">const</span> loading <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.loading&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw">const</span> results <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.result-container&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw">const</span> usage <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.carbon-usage&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">const</span> fossilfuel <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.fossil-fuel&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-12" title="12"><span class="kw">const</span> myregion <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.my-region&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-13" title="13"><span class="kw">const</span> clearBtn <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;.clear-btn&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>Tutti questi campi sono referenziati dalla loro classe CSS, cos√¨ come √® stata impostata nell‚ÄôHTML nella lezione precedente.</p>
<h3 id="aggiungere-event-listener">Aggiungere event listener</h3>
<p>Successivamente, andranno aggiungi gli event listener al form e il pulsante di cancellazione che reimposta il form, in modo che se un utente invia il form o fa clic su quel pulsante di ripristino, accadr√† qualcosa; aggiungere la chiamata per inizializzare l‚Äôapp alla fine del file:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1"><span class="va">form</span>.<span class="at">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> <span class="at">handleSubmit</span>(e))<span class="op">;</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="va">clearBtn</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> (e) <span class="kw">=&gt;</span> <span class="at">reset</span>(e))<span class="op">;</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="at">init</span>()<span class="op">;</span></a></code></pre></div>
<p>‚úÖ Notare l‚Äôabbreviazione utilizzata per ascoltare un evento submit o click e come l‚Äôevento viene passato alle funzioni handleSubmit o reset. Si pu√≤ scrivere l‚Äôequivalente di questa scorciatoia in un formato pi√π lungo? Quale si preferisce?</p>
<h3 id="costruire-la-funzione-init-e-la-funzione-reset">Costruire la funzione init() e la funzione reset():</h3>
<p>Ora si creer√† la funzione che inizializza l‚Äôestensione, che si chiama init():</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">function</span> <span class="at">init</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="co">//se c&#39;√® qulacosa in localStorage si recupera</span></a>
<a class="sourceLine" id="cb3-3" title="3">    <span class="kw">const</span> storedApiKey <span class="op">=</span> <span class="va">localStorage</span>.<span class="at">getItem</span>(<span class="st">&#39;apiKey&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="kw">const</span> storedRegion <span class="op">=</span> <span class="va">localStorage</span>.<span class="at">getItem</span>(<span class="st">&#39;regionName&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-5" title="5"></a>
<a class="sourceLine" id="cb3-6" title="6">    <span class="co">//imposta icona a un verde generico</span></a>
<a class="sourceLine" id="cb3-7" title="7">    <span class="co">//da fare</span></a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9">    <span class="cf">if</span> (storedApiKey <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> storedRegion <span class="op">===</span> <span class="kw">null</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-10" title="10">        <span class="co">//se non si hanno le chiavi si mostra il form</span></a>
<a class="sourceLine" id="cb3-11" title="11">        <span class="va">form</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-12" title="12">        <span class="va">results</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-13" title="13">        <span class="va">loading</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-14" title="14">        <span class="va">clearBtn</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-15" title="15">        <span class="va">errors</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-16" title="16">    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-17" title="17">        <span class="co">//se si sono salvate chiave/regioni in localStorage, si mostrano i risultati al caricamento</span></a>
<a class="sourceLine" id="cb3-18" title="18">        <span class="at">displayCarbonUsage</span>(storedApiKey<span class="op">,</span> storedRegion)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-19" title="19">        <span class="va">results</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-20" title="20">        <span class="va">form</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-21" title="21">        <span class="va">clearBtn</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb3-22" title="22">    <span class="op">}</span></a>
<a class="sourceLine" id="cb3-23" title="23"><span class="op">};</span></a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25"><span class="kw">function</span> <span class="at">reset</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-26" title="26">    <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-27" title="27">    <span class="co">//pulisce local storage solo per la regione</span></a>
<a class="sourceLine" id="cb3-28" title="28">    <span class="va">localStorage</span>.<span class="at">removeItem</span>(<span class="st">&#39;regionName&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb3-29" title="29">    <span class="at">init</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb3-30" title="30"><span class="op">}</span></a></code></pre></div>
<p>In questa funzione c‚Äô√® una logica interessante. Leggendola, si riesce a vedere cosa succede?</p>
<ul>
<li>due <code>const</code> vengono impostate per verificare se l‚Äôutente ha memorizzato una chiave APIKey e il codice regionale nella memoria del browser.</li>
<li>se uno di queste √® nullo, si mostra il form cambiando il suo stile in modo che venga visualizzato come blocco</li>
<li>nascondere i div che mostrano risultati, caricamento e il pulsante clearBtn e impostare qualsiasi testo di errore su una stringa vuota</li>
<li>se esiste una chiave e una regione, avviare una routine per:
<ul>
<li>chiamare l‚ÄôAPI per ottenere i dati sull‚Äôutilizzo del carbonio</li>
<li>nascondere l‚Äôarea dei risultati</li>
<li>nascondere il form</li>
<li>mostrare il pulsante di reset</li>
</ul></li>
</ul>
<p>Prima di proseguire, √® utile conoscere un concetto molto importante disponibile nei browser: <a href="https://developer.mozilla.org/it/docs/Web/API/Window/localStorage">LocalStorage</a>. LocalStorage √® un modo utile per memorizzare le stringhe nel browser come coppia <code>chiave-valore</code> . Questo tipo di archiviazione web pu√≤ essere manipolato da JavaScript per gestire i dati nel browser. LocalStorage non scade, mentre il contenuto di SessionStorage, un altro tipo di archiviazione web, viene cancellato alla chiusura del browser. I vari tipi di archiviazione hanno vantaggi e svantaggi per il loro utilizzo.</p>
<blockquote>
<p>Nota: l‚Äôestensione del browser ha la propria memoria locale; la finestra principale del browser √® un‚Äôistanza diversa e si comporta separatamente.</p>
</blockquote>
<p>Ad esempio, si pu√≤ impostare il proprio apiKey in modo che abbia un valore di stringa e si pu√≤ vedere come √® impostato su Edge ‚Äúispezionando‚Äù una pagina web (si pu√≤ fare clic con il pulsante destro del mouse sul browser per farlo) e andando alla scheda Applicazioni per vedere il i dati di conservazione.</p>
<figure>
<img src="../images/localstorage.png" alt="Pannello di Memorizzazione Locale" /><figcaption>Pannello di Memorizzazione Locale</figcaption>
</figure>
<p>‚úÖ Si pensi a situazioni in cui NON si vorrebbero memorizzare alcuni dati in LocalStorage. In generale, posizionare le chiavi API in LocalStorage √® una cattiva idea! Si pu√≤ intuire perch√©? In questo caso, poich√© l‚Äôapp √® esclusivamente per l‚Äôapprendimento e non verr√† distribuita in un app store, si utilizzer√† questo metodo.</p>
<p>Si noti che si utilizza l‚ÄôAPI Web per manipolare LocalStorage, utilizzando <code>getItem()</code>, <code>setItem()</code> o <code>removeItem()</code>. √à ampiamente supportata sui vari tipi di browser.</p>
<p>Prima di costruire la funzione <code>displayCarbonUsage()</code> chiamata in <code>init()</code>, si costruir√† la funzionalit√† per gestire l‚Äôinvio iniziale del form.</p>
<h3 id="gestire-linvio-del-form">Gestire l‚Äôinvio del form</h3>
<p>Creare una funzione chiamata <code>handleSubmit</code> che accetta un evento come argomento <code>(e)</code>. Fermare la propagazione dell‚Äôevento (in questo caso, si vuole fermare l‚Äôaggiornamento del browser) e chiamare una nuova funzione, <code>setUpUser</code>, passando gli argomenti <code>apiKey.value</code> e <code>region.value</code>. In questo modo, si utilizzano i due valori che vengono inseriti tramite il form iniziale quando vengono compilati i campi appropriati.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">function</span> <span class="at">handleSubmit</span>(e) <span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="va">e</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="at">setUpUser</span>(<span class="va">apiKey</span>.<span class="at">value</span><span class="op">,</span> <span class="va">region</span>.<span class="at">value</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>‚úÖ Per rinfrescarsi la memoria: l‚ÄôHTML impostato nell‚Äôultima lezione ha due campi di input i cui attributi <code>value</code> vengono catturati tramite <code>const</code> che si √® impostata all‚Äôinizio del file e sono entrambi obbligatori (<code>required</code>) in modo che il browser impedisca agli utenti di inserire valori nulli.</p>
<h3 id="configurare-lutente">Configurare l‚Äôutente</h3>
<p>Passando alla funzione <code>setUpUser</code>, qui √® dove si impostano i valori di archiviazione locale per apiKey e regionName. Aggiungere una nuova funzione</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">function</span> <span class="at">setUpUser</span>(apiKey<span class="op">,</span> regionName) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">    <span class="va">localStorage</span>.<span class="at">setItem</span>(<span class="st">&#39;apiKey&#39;</span><span class="op">,</span> apiKey)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-3" title="3">    <span class="va">localStorage</span>.<span class="at">setItem</span>(<span class="st">&#39;regionName&#39;</span><span class="op">,</span> regionName)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-4" title="4">    <span class="va">loading</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-5" title="5">    <span class="va">errors</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-6" title="6">    <span class="va">clearBtn</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb5-7" title="7">    <span class="co">//esecuzione della chiamata iniziale</span></a>
<a class="sourceLine" id="cb5-8" title="8">    <span class="at">displayCarbonUsage</span>(apiKey<span class="op">,</span> regionName)<span class="op">;</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="op">}</span></a></code></pre></div>
<p>Questa funzione imposta un messaggio di caricamento da mostrare mentre viene chiamata l‚ÄôAPI. A questo punto si √® arrivati a creare la funzione pi√π importante di questa estensione per browser!</p>
<h3 id="visualizzare-il-consumo-di-carbonio">Visualizzare il consumo di carbonio</h3>
<p>Finalmente √® il momento di interrogare l‚ÄôAPI!</p>
<p>Prima di andare oltre, si dovrebbe parlare delle API. Le API, o <a href="https://www.webopedia.com/TERM/A/API.html">Application Programming Interface</a> (interfacce di programmazione dell‚Äôapplicazione), sono un elemento critico della cassetta degli attrezzi di uno sviluppatore web. Forniscono modi standard per i programmi per interagire e interfacciarsi tra loro. Ad esempio, se si sta costruendo un sito web che deve interrogare un database, qualcuno potrebbe aver creato un‚ÄôAPI da usare. Sebbene esistano molti tipi di API, uno dei tipi pi√π popolari √® un‚Äô <a href="https://www.smashingmagazine.com/2018/01/understanding-using-rest-api/">API REST</a>.</p>
<p>‚úÖ Il termine ‚ÄúREST‚Äù sta per ‚ÄúRepresentational State Transfer‚Äù e prevede l‚Äôutilizzo di URL variamente configurati per recuperare dati. Fare una piccola ricerca sui vari tipi di API disponibili per gli sviluppatori. Quale formato piace?</p>
<p>Ci sono cose importanti da notare su questa funzione. Per prima cosa nota la <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function">parola chiave <code>async</code></a>. Scrivere le funzioni in modo che vengano eseguite in modo asincrono significa che attendono il completamento di un‚Äôazione, come la restituzione dei dati, prima di continuare.</p>
<p>Ecco un breve video su <code>async</code>:</p>
<p>[<img src="https://img.youtube.com/vi/YwmlRkrxvkk/0.jpg" alt="Async e Await per la" />](https://youtube.com/watch?v=YwmlRkrxvkk " gestione di promesse")</p>
<blockquote>
<p>Fare clic sull‚Äôimmagine sopra per un video su async/await.</p>
</blockquote>
<p>Creare una nuova funzione per interrogare l‚ÄôAPI C02Signal:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="im">import</span> axios <span class="im">from</span> <span class="st">&#39;../node_modules/axios&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-2" title="2"></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="kw">async</span> <span class="kw">function</span> <span class="at">displayCarbonUsage</span>(apiKey<span class="op">,</span> region) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-4" title="4">    <span class="cf">try</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">        <span class="cf">await</span> axios</a>
<a class="sourceLine" id="cb6-6" title="6">            .<span class="at">get</span>(<span class="st">&#39;https://api.co2signal.com/v1/latest&#39;</span><span class="op">,</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-7" title="7">                <span class="dt">params</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-8" title="8">                    <span class="dt">countryCode</span><span class="op">:</span> region<span class="op">,</span></a>
<a class="sourceLine" id="cb6-9" title="9">                <span class="op">},</span></a>
<a class="sourceLine" id="cb6-10" title="10">                <span class="dt">headers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-11" title="11">                    <span class="st">&#39;auth-token&#39;</span><span class="op">:</span> apiKey<span class="op">,</span></a>
<a class="sourceLine" id="cb6-12" title="12">                <span class="op">},</span></a>
<a class="sourceLine" id="cb6-13" title="13">            <span class="op">}</span>)</a>
<a class="sourceLine" id="cb6-14" title="14">            .<span class="at">then</span>((response) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb6-15" title="15">                <span class="kw">let</span> CO2 <span class="op">=</span> <span class="va">Math</span>.<span class="at">floor</span>(<span class="va">response</span>.<span class="va">data</span>.<span class="va">data</span>.<span class="at">carbonIntensity</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-16" title="16"></a>
<a class="sourceLine" id="cb6-17" title="17">                <span class="co">//calculateColor(CO2);</span></a>
<a class="sourceLine" id="cb6-18" title="18"></a>
<a class="sourceLine" id="cb6-19" title="19">                <span class="va">loading</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-20" title="20">                <span class="va">form</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-21" title="21">                <span class="va">myregion</span>.<span class="at">textContent</span> <span class="op">=</span> region<span class="op">;</span></a>
<a class="sourceLine" id="cb6-22" title="22">                <span class="va">usage</span>.<span class="at">textContent</span> <span class="op">=</span></a>
<a class="sourceLine" id="cb6-23" title="23">                    <span class="va">Math</span>.<span class="at">round</span>(<span class="va">response</span>.<span class="va">data</span>.<span class="va">data</span>.<span class="at">carbonIntensity</span>) <span class="op">+</span> <span class="st">&#39; grammi (grammi di C02 emessi per kilowatt/ora)&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-24" title="24">                <span class="va">fossilfuel</span>.<span class="at">textContent</span> <span class="op">=</span></a>
<a class="sourceLine" id="cb6-25" title="25">                    <span class="va">response</span>.<span class="va">data</span>.<span class="va">data</span>.<span class="va">fossilFuelPercentage</span>.<span class="at">toFixed</span>(<span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-26" title="26">                    <span class="st">&#39;% (percentuale di combustibile fossile usato per generare elettricit√†)&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-27" title="27">                <span class="va">results</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;block&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-28" title="28">            <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-29" title="29">    <span class="op">}</span> <span class="cf">catch</span> (error) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-30" title="30">        <span class="va">console</span>.<span class="at">log</span>(error)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-31" title="31">        <span class="va">loading</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-32" title="32">        <span class="va">results</span>.<span class="va">style</span>.<span class="at">display</span> <span class="op">=</span> <span class="st">&#39;none&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-33" title="33">        <span class="va">errors</span>.<span class="at">textContent</span> <span class="op">=</span> <span class="st">&#39;Spiacente, non ci sono dati per la regione richiesta.&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-34" title="34">    <span class="op">}</span></a>
<a class="sourceLine" id="cb6-35" title="35"><span class="op">}</span></a></code></pre></div>
<p>Questa √® una grande funzione. Cosa sta succedendo qui?</p>
<ul>
<li>seguendo le migliori pratiche, si utilizza la parola chiave <code>async</code> per fare in modo che questa funzione si comporti in modo asincrono. La funzione contiene un blocco <code>try/catch</code> poich√© restituir√† una promessa quando l‚ÄôAPI restituir√† i dati. Poich√© non si ha il controllo sulla velocit√† con cui l‚ÄôAPI risponder√† (potrebbe non rispondere affatto!), si devi gestire questa incertezza chiamandola in modo asincrono.</li>
<li>si sta interrogando l‚ÄôAPI co2signal per ottenere i dati della propria regione, utilizzando la propria chiave API. Per utilizzare quella chiave, si deve utilizzare un tipo di autenticazione nei parametri dell‚Äôintestazione della richiesta (header)</li>
<li>una volta che l‚ÄôAPI risponde, si assegnano i vari elementi dei suoi dati di risposta alle parti dello schermo che sono state impostate per mostrare questi dati.</li>
<li>se c‚Äô√® un errore, o se non c‚Äô√® risultato, viene mostrato un messaggio di errore.</li>
</ul>
<p>‚úÖ L‚Äôutilizzo di schemi di programmazione asincrona √® un altro strumento molto utile nella propria cassetta degli attrezzi. Informarsi <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/async_function">sui vari modi in</a> cui si pu√≤ configurare questo tipo di codice.</p>
<p>Complimenti! Se si compila la propria estensione<code>(npm run build</code>) e la si aggiorna nel pannello delle estensioni, si avr√† un‚Äôestensione funzionante! L‚Äôunica cosa che non funziona √® l‚Äôicona, verr√† risolto nella prossima lezione.</p>
<hr />
<h2 id="sfida">üöÄ Sfida</h2>
<p>Finora si √® discusso sui diversi tipi di API in queste lezioni. Scegliere un‚ÄôAPI web e cercare in profondit√† cosa offre. Ad esempio, dare un‚Äôocchiata alle API disponibili nei browser come l‚Äô <a href="https://developer.mozilla.org/docs/Web/API/HTML_Drag_and_Drop_API">API HTML Drag and Drop</a>. Cosa si ritiene renda grande un‚ÄôAPI?</p>
<h2 id="quiz-post-lezione">Quiz Post-Lezione</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/26?loc=it">Quiz post-lezione</a></p>
<h2 id="revisione-e-auto-apprendimento">Revisione e Auto Apprendimento</h2>
<p>In questa lezione si √® imparato a conoscere LocalStorage e le API, entrambi molto utili per lo sviluppatore web professionista. Si riesce a pensare come funzionano queste due cose insieme? Si pensi come progettare un sito web che memorizza gli elementi per essere utilizzati da un‚ÄôAPI.</p>
<h2 id="compito">Compito</h2>
<p><a href="assignment.it.md">Adottare un‚ÄôAPI</a></p>
</body>
</html>
