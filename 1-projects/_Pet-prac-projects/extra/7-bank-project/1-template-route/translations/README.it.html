<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>README.it</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
</head>
<body>
<h1 id="creazione-di-unapp-bancaria-parte-1-modelli-html-e-rotte-in-unapp-web">Creazione di unâ€™App Bancaria Parte 1: Modelli HTML e Rotte in unâ€™app web</h1>
<h2 id="quiz-pre-lezione">Quiz Pre-Lezione</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/41?loc=it">Quiz Pre-Lezione</a></p>
<h3 id="introduzione">Introduzione</h3>
<p>Dallâ€™avvento di JavaScript nei browser, i siti web stanno diventando piÃ¹ interattivi e complessi che mai. Le tecnologie web sono ora comunemente utilizzate per creare applicazioni completamente funzionali che vengono eseguite direttamente in un browser che vengono chiamate <a href="https://it.wikipedia.org/wiki/Applicazione_web">applicazioni web</a>. PoichÃ© le app web sono altamente interattive, gli utenti non desiderano attendere il ricaricamento di una pagina intera ogni volta che viene eseguita unâ€™azione. Ecco perchÃ© JavaScript viene utilizzato per aggiornare lâ€™HTML direttamente utilizzando il DOM, per fornire unâ€™esperienza utente piÃ¹ fluida.</p>
<p>In questa lezione, getteremo le basi per creare unâ€™app web bancaria, utilizzando modelli HTML per creare piÃ¹ schermate che possono essere visualizzate e aggiornate senza dover ricaricare lâ€™intera pagina HTML.</p>
<h3 id="prerequisito">Prerequisito</h3>
<p>Ãˆ necessario un server web locale per testare lâ€™app web che verrÃ  creata in questa lezione. Se non ne ha uno, si puÃ² installare <a href="https://nodejs.org">Node.js</a> e utilizzare il comando <code>npx lite-server</code> dalla cartella del progetto. CreerÃ  un server web locale e aprirÃ  la propria app in un browser.</p>
<h3 id="preparazione">Preparazione</h3>
<p>Sul proprio computer, creare una cartella denominata <code>bank</code> con un file denominato <code>index.html</code> al suo interno. Si inizierÃ  da questo codice <a href="https://en.wikipedia.org/wiki/Boilerplate_code">boilerplate</a> HTML:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb1-1" title="1"><span class="dt">&lt;!DOCTYPE </span>html<span class="dt">&gt;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;en&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="kw">&lt;head&gt;</span></a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;UTF-8&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-5" title="5">    <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1.0&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb1-6" title="6">    <span class="kw">&lt;title&gt;</span>Bank App<span class="kw">&lt;/title&gt;</span></a>
<a class="sourceLine" id="cb1-7" title="7">  <span class="kw">&lt;/head&gt;</span></a>
<a class="sourceLine" id="cb1-8" title="8">  <span class="kw">&lt;body&gt;</span></a>
<a class="sourceLine" id="cb1-9" title="9">    <span class="co">&lt;!-- Qui Ã¨ dove si lavorerÃ  --&gt;</span></a>
<a class="sourceLine" id="cb1-10" title="10">  <span class="kw">&lt;/body&gt;</span></a>
<a class="sourceLine" id="cb1-11" title="11"><span class="kw">&lt;/html&gt;</span></a></code></pre></div>
<hr />
<h2 id="modelli-html.">Modelli HTML.</h2>
<p>Se si desidera creare piÃ¹ schermate per una pagina Web, una soluzione potrebbe essere la creazione di un file HTML per ogni schermata che si desidera visualizzare. Tuttavia, questa soluzione presenta alcuni inconvenienti:</p>
<ul>
<li>Ãˆ necessario ricaricare lâ€™intero HTML quando si cambia schermata, il che puÃ² essere lento.</li>
<li>Ãˆ difficile condividere i dati tra le diverse schermate.</li>
</ul>
<p>Un altro approccio consiste nellâ€™avere un solo file HTML e definire piÃ¹ <a href="https://developer.mozilla.org/docs/Web/HTML/Element/template">modelli HTML</a> utilizzando lâ€™elemento <code>&lt;template&gt;</code>. Un modello Ã¨ un blocco HTML riutilizzabile che non viene visualizzato dal browser e deve essere istanziato in fase di esecuzione utilizzando JavaScript.</p>
<h3 id="attivitÃ ">AttivitÃ </h3>
<p>VerrÃ  creata unâ€™app bancaria con due schermate: la pagina di accesso e il cruscotto. Innanzitutto, si aggiunge nel corpo dellâ€™HTML un elemento segnaposto che si utilizzerÃ  per istanziare le diverse schermate dellâ€™app:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;app&quot;</span><span class="kw">&gt;</span>Loading...<span class="kw">&lt;/div&gt;</span></a></code></pre></div>
<p>Viene fornito un <code>ID</code> allâ€™elemento per renderlo piÃ¹ facilmente individuabile con JavaScript in seguito.</p>
<blockquote>
<p>Suggerimento: poichÃ© il contenuto di questo elemento verrÃ  sostituito, si puÃ² inserire un messaggio di caricamento o un indicatore che verrÃ  mostrato durante il caricamento dellâ€™app.</p>
</blockquote>
<p>Successivamente, si aggiunge il modello HTML seguente per la pagina di accesso. Per ora si inserirÃ  solo un titolo e una sezione contenente un collegamento che si utilizzerÃ  per eseguire la navigazione.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">&lt;template</span><span class="ot"> id=</span><span class="st">&quot;login&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb3-2" title="2">  <span class="kw">&lt;h1&gt;</span>Bank App<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb3-3" title="3">  <span class="kw">&lt;section&gt;</span></a>
<a class="sourceLine" id="cb3-4" title="4">    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/dashboard&quot;</span><span class="kw">&gt;</span>Login<span class="kw">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="kw">&lt;/section&gt;</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="kw">&lt;/template&gt;</span></a></code></pre></div>
<p>Quindi si aggiungerÃ  un altro modello HTML per la pagina del cruscotto. Questa pagina conterrÃ  diverse sezioni:</p>
<ul>
<li>Unâ€™intestazione con un titolo e un collegamento di disconnessione</li>
<li>Saldo corrente del conto bancario</li>
<li>Un elenco di transazioni, visualizzato in una tabella</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">&lt;template</span><span class="ot"> id=</span><span class="st">&quot;dashboard&quot;</span><span class="kw">&gt;</span></a>
<a class="sourceLine" id="cb4-2" title="2">  <span class="kw">&lt;header&gt;</span></a>
<a class="sourceLine" id="cb4-3" title="3">    <span class="kw">&lt;h1&gt;</span>Bank App<span class="kw">&lt;/h1&gt;</span></a>
<a class="sourceLine" id="cb4-4" title="4">    <span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/login&quot;</span><span class="kw">&gt;</span>Logout<span class="kw">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb4-5" title="5">  <span class="kw">&lt;/header&gt;</span></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="kw">&lt;section&gt;</span></a>
<a class="sourceLine" id="cb4-7" title="7">    Balance: 100$</a>
<a class="sourceLine" id="cb4-8" title="8">  <span class="kw">&lt;/section&gt;</span></a>
<a class="sourceLine" id="cb4-9" title="9">  <span class="kw">&lt;section&gt;</span></a>
<a class="sourceLine" id="cb4-10" title="10">    <span class="kw">&lt;h2&gt;</span>Transactions<span class="kw">&lt;/h2&gt;</span></a>
<a class="sourceLine" id="cb4-11" title="11">    <span class="kw">&lt;table&gt;</span></a>
<a class="sourceLine" id="cb4-12" title="12">      <span class="kw">&lt;thead&gt;</span></a>
<a class="sourceLine" id="cb4-13" title="13">        <span class="kw">&lt;tr&gt;</span></a>
<a class="sourceLine" id="cb4-14" title="14">          <span class="kw">&lt;th&gt;</span>Date<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb4-15" title="15">          <span class="kw">&lt;th&gt;</span>Object<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb4-16" title="16">          <span class="kw">&lt;th&gt;</span>Amount<span class="kw">&lt;/th&gt;</span></a>
<a class="sourceLine" id="cb4-17" title="17">        <span class="kw">&lt;/tr&gt;</span></a>
<a class="sourceLine" id="cb4-18" title="18">      <span class="kw">&lt;/thead&gt;</span></a>
<a class="sourceLine" id="cb4-19" title="19">      <span class="kw">&lt;tbody&gt;&lt;/tbody&gt;</span></a>
<a class="sourceLine" id="cb4-20" title="20">    <span class="kw">&lt;/table&gt;</span></a>
<a class="sourceLine" id="cb4-21" title="21">  <span class="kw">&lt;/section&gt;</span></a>
<a class="sourceLine" id="cb4-22" title="22"><span class="kw">&lt;/template&gt;</span></a></code></pre></div>
<blockquote>
<p>Suggerimento: durante la creazione di modelli HTML, se si vuole vedere come apparirÃ , si possono commentare le righe tra <code>&lt;template&gt;</code> <code>&lt;/template&gt;</code> racchiudendole <code>tra &lt;!- -&gt;--&gt;</code>.</p>
</blockquote>
<p>âœ… PerchÃ© si pensa che vengano utilizzati gli attributi <code>id</code> sui modelli? Si potrebbe usare qualcosâ€™altro come le classi?</p>
<h2 id="visualizzazione-di-modelli-con-javascript">Visualizzazione di modelli con JavaScript</h2>
<p>Se si prova il proprio file HTML corrente in un browser, si vedrÃ  che si blocca visualizzando <code>Loading ...</code> Questo perchÃ© si deve aggiungere del codice JavaScript per istanziare e visualizzare i modelli HTML.</p>
<p>Lâ€™istanza di un modello viene solitamente eseguita in 3 passaggi:</p>
<ol type="1">
<li>Recuperare lâ€™elemento del modello nel DOM, ad esempio utilizzando <a href="https://developer.mozilla.org/it/docs/Web/API/Document/getElementById"><code>document.getElementById</code></a>.</li>
<li>Clonare lâ€™elemento template, usando <a href="https://developer.mozilla.org/docs/Web/API/Node/cloneNode"><code>cloneNode</code></a>.</li>
<li>Collegarlo al DOM sotto un elemento visibile, ad esempio utilizzando <a href="https://developer.mozilla.org/it/docs/Web/API/Node/appendChild"><code>appendChild</code></a>.</li>
</ol>
<p>âœ… PerchÃ© Ã¨ necessario clonare il modello prima di collegarlo al DOM? Cosa si pensa che accadrebbe se venisse saltato questo passaggio?</p>
<h3 id="attivitÃ -1">AttivitÃ </h3>
<p>Creare un nuovo file denominato <code>app.js</code> nella cartella del progetto e importare quel file nella sezione <code>&lt;head&gt;</code> del proprio HTML:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">&lt;script</span><span class="ot"> src=</span><span class="st">&quot;app.js&quot;</span><span class="ot"> defer</span><span class="kw">&gt;&lt;/script&gt;</span></a></code></pre></div>
<p>Ora in <code>app.js</code>, verrÃ  creata una nuova funzione <code>updateRoute</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">function</span> <span class="at">updateRoute</span>(templateId) <span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">  <span class="kw">const</span> template <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(templateId)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="kw">const</span> view <span class="op">=</span> <span class="va">template</span>.<span class="va">content</span>.<span class="at">cloneNode</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="kw">const</span> app <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-5" title="5">  <span class="va">app</span>.<span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6">  <span class="va">app</span>.<span class="at">appendChild</span>(view)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="op">}</span></a></code></pre></div>
<p>Quello che si fa qui sono esattamente i 3 passaggi descritti sopra. Si istanza il modello con lâ€™id <code>templateId</code> e si inserisce il suo contenuto clonato nel segnaposto dellâ€™app. Notare che si deve usare <code>cloneNode (true)</code> per copiare lâ€™intero sottoalbero del modello.</p>
<p>Ora chiamare questa funzione con uno dei template e guardare il risultato.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="at">updateRoute</span>(<span class="st">&#39;login&#39;</span>)<span class="op">;</span></a></code></pre></div>
<p>âœ… Qual Ã¨ lo scopo di questo codice <code>app.innerHTML = '';</code>? Cosa succede senza di essa?</p>
<h2 id="creazione-di-rotte">Creazione di rotte</h2>
<p>Quando si parla di unâ€™app web, si definisce <em>Routing</em> (instradamento) lâ€™intento di mappare gli <strong>URL</strong> a schermate specifiche che dovrebbero essere visualizzate. Su un sito web con piÃ¹ file HTML, questa operazione viene eseguita automaticamente poichÃ© i percorsi dei file si riflettono sullâ€™URL. Ad esempio, con questi file nella cartella del progetto:</p>
<pre><code>mywebsite/index.html
mywebsite/login.html
mywebsite/admin/index.html</code></pre>
<p>Se si crea un server web con <code>mywebsite</code> come radice, la mappatura dellâ€™URL sarÃ :</p>
<pre><code>https://site.com            --&gt; mywebsite/index.html
https://site.com/login.html --&gt; mywebsite/login.html
https://site.com/admin/     --&gt; mywebsite/admin/index.html</code></pre>
<p>Tuttavia, per lâ€™app web in costruzione si utilizza un singolo file HTML contenente tutte le schermate, quindi questo comportamento predefinito non sarÃ  di aiuto. Si deve creare questa mappa manualmente ed eseguire lâ€™aggiornamento del modello visualizzato utilizzando JavaScript.</p>
<h3 id="attivitÃ -2">AttivitÃ </h3>
<p>Si userÃ  un semplice oggetto per implementare una <a href="https://it.wikipedia.org/wiki/Array_associativo">mappa</a> tra i percorsi degli URL e i propri modelli. Aggiungere questo oggetto allâ€™inizio del file <code>app.js</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">const</span> routes <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">  <span class="st">&#39;/login&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;login&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="st">&#39;/dashboard&#39;</span><span class="op">:</span> <span class="op">{</span> <span class="dt">templateId</span><span class="op">:</span> <span class="st">&#39;dashboard&#39;</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="op">};</span></a></code></pre></div>
<p>Ora modificare un poâ€™ la funzione <code>updateRoute</code>. Invece di passare direttamente il <code>templateId</code> come argomento, lo si vuole recuperare guardando prima lâ€™URL corrente, quindi utilizzndo la mappa per ottenere il valore dellâ€™ID del modello corrispondente. Si puÃ² usare <a href="https://developer.mozilla.org/docs/Web/API/Location/pathname"><code>window.location.pathname</code></a> per ottenere solo la sezione del percorso dallâ€™URL.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1"><span class="kw">function</span> <span class="at">updateRoute</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="kw">const</span> path <span class="op">=</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="kw">const</span> route <span class="op">=</span> routes[path]<span class="op">;</span></a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="kw">const</span> template <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="va">route</span>.<span class="at">templateId</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">const</span> view <span class="op">=</span> <span class="va">template</span>.<span class="va">content</span>.<span class="at">cloneNode</span>(<span class="kw">true</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="kw">const</span> app <span class="op">=</span> <span class="va">document</span>.<span class="at">getElementById</span>(<span class="st">&#39;app&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="va">app</span>.<span class="at">innerHTML</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb11-9" title="9">  <span class="va">app</span>.<span class="at">appendChild</span>(view)<span class="op">;</span></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="op">}</span></a></code></pre></div>
<p>Qui sono state mappato le rotte che sono state dichiarate al modello corrispondente. Si puÃ² provare se funziona correttamente modificando manualmente lâ€™URL nel proprio browser.</p>
<p>âœ… Cosa succede se si inserisce un percorso sconosciuto nellâ€™URL? Come potrebbe essere risolto questo problema?</p>
<h2 id="aggiungere-navigazione">Aggiungere navigazione</h2>
<p>Il prossimo passo per la costruzione dellâ€™app Ã¨ aggiungere la possibilitÃ  di navigare tra le pagine senza dover modificare manualmente lâ€™URL. Questo implica due cose:</p>
<ol type="1">
<li>Aggiornamento dellâ€™URL corrente</li>
<li>Aggiornamento del modello visualizzato in base al nuovo URL</li>
</ol>
<p>Eâ€™ giÃ  stata trattata la seconda parte con la funzione <code>updateRoute</code>, quindi occorre capire come aggiornare lâ€™URL corrente.</p>
<p>Si dovrÃ  utilizzare JavaScript e piÃ¹ precisamente <a href="https://developer.mozilla.org/docs/Web/API/History/pushState">history.pushState</a> che permette di aggiornare lâ€™URL e creare una nuova voce nella cronologia di navigazione, senza ricaricare lâ€™HTML.</p>
<blockquote>
<p>Nota: Sebbene lâ€™elemento HTML ancora <a href="https://developer.mozilla.org/it/docs/Web/HTML/Element/a"><code>&lt;a href&gt;</code></a> possa essere usato da solo per creare collegamenti ipertestuali a diversi URL, Ã¨ anche in grado di fare ricaricare al browser lâ€™HTML nella modalitÃ  predefinita. Ãˆ necessario prevenire questo comportamento quando si gestisce il routing con javascript personalizzato, utilizzando la funzione preventDefault() sullâ€™evento click.</p>
</blockquote>
<h3 id="attivitÃ -3">AttivitÃ </h3>
<p>Si crea una nuova funzione da utilizzare per navigare nellâ€™app:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">function</span> <span class="at">navigate</span>(path) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="va">window</span>.<span class="va">history</span>.<span class="at">pushState</span>(<span class="op">{},</span> path<span class="op">,</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">origin</span> <span class="op">+</span> path)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="at">updateRoute</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>Questo metodo aggiorna prima lâ€™URL corrente in base al percorso fornito, quindi aggiorna il modello. La proprietÃ  <code>window.location.origin</code> restituisce lâ€™URL radice, permettendo di ricostruire un URL completo da un dato percorso.</p>
<p>Ora che si ha questa funzione, ci si puÃ² occupare del problema che si verifica se un percorso non corrisponde a nessuna rotta definita. Si modificherÃ  la funzione <code>updateRoute</code> aggiungendo una soluzione di contingenza per indirizzare verso una delle rotte esistenti se non viene trovata una corrispondenza.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1"><span class="kw">function</span> <span class="at">updateRoute</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">  <span class="kw">const</span> path <span class="op">=</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">pathname</span><span class="op">;</span></a>
<a class="sourceLine" id="cb13-3" title="3">  <span class="kw">const</span> route <span class="op">=</span> routes[path]<span class="op">;</span></a>
<a class="sourceLine" id="cb13-4" title="4"></a>
<a class="sourceLine" id="cb13-5" title="5">  <span class="cf">if</span> (<span class="op">!</span>route) <span class="op">{</span></a>
<a class="sourceLine" id="cb13-6" title="6">    <span class="cf">return</span> <span class="at">navigate</span>(<span class="st">&#39;/login&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb13-7" title="7">  <span class="op">}</span></a>
<a class="sourceLine" id="cb13-8" title="8"></a>
<a class="sourceLine" id="cb13-9" title="9">  ...</a></code></pre></div>
<p>Se non Ã¨ possibile trovare una rotta, si esegue un reindirizzamento alla pagina <code>login</code>.</p>
<p>Ora si crea una funzione per ottenere lâ€™URL quando si fa clic su un collegamento e per impedire il comportamento predefinito del browser per un collegamento:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1"><span class="kw">function</span> <span class="at">onLinkClick</span>(event) <span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">  <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb14-3" title="3">  <span class="at">navigate</span>(<span class="va">event</span>.<span class="va">target</span>.<span class="at">href</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb14-4" title="4"><span class="op">}</span></a></code></pre></div>
<p>Si completa il sistema di navigazione aggiungendo collegamenti ai link di accesso (<em>Login</em>) e di disconnessione (<em>Logout</em>) nellâ€™HTML.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode html"><code class="sourceCode html"><a class="sourceLine" id="cb15-1" title="1"><span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/dashboard&quot;</span><span class="ot"> onclick=</span><span class="st">&quot;onLinkClick()&quot;</span><span class="kw">&gt;</span>Login<span class="kw">&lt;/a&gt;</span></a>
<a class="sourceLine" id="cb15-2" title="2">...</a>
<a class="sourceLine" id="cb15-3" title="3"><span class="kw">&lt;a</span><span class="ot"> href=</span><span class="st">&quot;/login&quot;</span><span class="ot"> onclick=</span><span class="st">&quot;onLinkClick()&quot;</span><span class="kw">&gt;</span>Logout<span class="kw">&lt;/a&gt;</span></a></code></pre></div>
<p>Utilizzando l â€™attributo <a href="https://developer.mozilla.org/docs/Web/API/GlobalEventHandlers/onclick"><code>onclick</code></a> associare lâ€™evento <code>click</code> al codice JavaScript, in questo caso la chiamata alla funzione <code>navigate()</code> .</p>
<p>Provare a fare clic su questi collegamenti, ora si dovrebbe essere in grado di navigare tra le diverse schermate dellâ€™app.</p>
<p>âœ… Il metodo <code>history.pushState</code> fa parte dello standard HTML5 e implementato in <a href="https://caniuse.com/?search=pushState">tutti i browser moderni</a>. Se si sta creando unâ€™app web per browser meno recenti, câ€™Ã¨ un trucco che si puÃ² usare al posto di questa API: usando un <a href="https://en.wikipedia.org/wiki/URI_fragment">hash (<code>#</code>)</a> prima del percorso si puÃ² implementare un instradatamento che funziona con la normale navigazione dellâ€™elemento ancora e non ricarica la pagina, poichÃ© il suo scopo era creare collegamenti allâ€™interno di una pagina.</p>
<h2 id="gestione-dei-pulsanti-avanti-e-indietro-del-browser">Gestione dei pulsanti Avanti e Indietro del browser</h2>
<p>Lâ€™utilizzo di <code>history.pushState</code> crea nuove voci nella cronologia di navigazione del browser. Si puÃ² verificare tenendo premuto il <em>pulsante Indietro</em> del proprio browser, dovrebbe visualizzare qualcosa del genere:</p>
<figure>
<img src="../history.png" alt="Videata della cronologia di navigazione" /><figcaption>Videata della cronologia di navigazione</figcaption>
</figure>
<p>Se si prova a fare clic sul pulsante Indietro alcune volte, si vedrÃ  che lâ€™URL corrente cambia e la cronologia viene aggiornata, ma lo stesso modello continua a essere visualizzato.</p>
<p>Questo perchÃ© il browser non sa che si deve chiamare <code>updateRoute()</code> ogni volta che cambia la cronologia. Se si dÃ  unâ€™occhiata alla documentazione di <a href="https://developer.mozilla.org/docs/Web/API/History/pushState"><code>history.pushState</code></a> si puÃ² vedere che se lo stato cambia, vale a dire che si Ã¨ passati a un URL diverso, viene attivato lâ€™<a href="https://developer.mozilla.org/docs/Web/API/Window/popstate_event">evento</a> <code>popstate</code>. VerrÃ  usato per risolvere quel problema.</p>
<h3 id="attivitÃ -4">AttivitÃ </h3>
<p>Per assicurarsi che il modello visualizzato venga aggiornato quando la cronologia del browser cambia, si aggiungerÃ  una nuova funzione che chiama <code>updateRoute()</code>. VerrÃ  fatto in fondo al file <code>app.js</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode js"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1"><span class="va">window</span>.<span class="at">onpopstate</span> <span class="op">=</span> () <span class="kw">=&gt;</span> <span class="at">updateRoute</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb16-2" title="2"><span class="at">updateRoute</span>()<span class="op">;</span></a></code></pre></div>
<blockquote>
<p>Nota: Ã¨ stata usata una <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Functions/Arrow_functions">funzione freccia</a> qui per dichiarare il gestore di eventi <code>popstate</code> per concisione, ma una funzione normale andrebbe bene allo stesso modo.</p>
</blockquote>
<p>Ecco un video di aggiornamento sulle funzioni freccia:</p>
<p><a href="https://youtube.com/watch?v=OP6eEbOj2sc"><img src="https://img.youtube.com/vi/OP6eEbOj2sc/0.jpg" alt="Funzionifreccia" /></a></p>
<blockquote>
<p>Fare clic sullâ€™immagine sopra per un video sulle funzioni freccia</p>
</blockquote>
<p>Ora provare a utilizzare i pulsanti Indietro e Avanti del proprio browser e controllare che il percorso visualizzato sia aggiornato correttamente questa volta.</p>
<hr />
<h2 id="sfida">ðŸš€ Sfida</h2>
<p>Aggiungere un nuovo modello e instradare per una terza pagina che mostra i crediti per questa app.</p>
<h2 id="quiz-post-lezione">Quiz Post-Lezione</h2>
<p><a href="https://nice-beach-0fe9e9d0f.azurestaticapps.net/quiz/42?loc=it">Quiz post-lezione</a></p>
<h2 id="revisione-e-auto-apprendimento">Revisione e Auto Apprendimento</h2>
<p>Il routing (instradamento) Ã¨ una delle parti sorprendentemente complicate dello sviluppo web, soprattutto perchÃ© il web passa dai comportamenti di aggiornamento della pagina allâ€™aggiornamento della pagina dellâ€™applicazione a pagina singola. Leggere alcune informazioni su <a href="https://docs.microsoft.com/azure/static-web-apps/routes?WT.mc_id=academic-4621-cxa">come il servizio App Web Static di Azure</a> gestisce il routing. Si puÃ² spiegare perchÃ© alcune delle decisioni descritte in quel documento sono necessarie?</p>
<h2 id="compito">Compito</h2>
<p><a href="assignment.it.md">Migliorare lâ€™instradamento</a></p>
</body>
</html>
