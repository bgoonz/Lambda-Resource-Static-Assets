<!DOCTYPE html>
<html>
    <head>
        <title>DevOps : Eligibility Rules Implementation</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body class="theme-default aui-theme-default">
        <div id="page">
            <div id="main" class="aui-page-panel">
                <div id="main-header">
                    <div id="breadcrumb-section">
                        <ol id="breadcrumbs">
                            <li class="first">
                                <span><a href="index.html">DevOps</a></span>
                            </li>
                                                    <li>
                                <span><a href="DevOps-Home_603226548.html">DevOps Home</a></span>
                            </li>
                                                    <li>
                                <span><a href="Tutorials_278921431.html">Tutorials</a></span>
                            </li>
                                                    <li>
                                <span><a href="Spring-Boot_278888737.html">Spring Boot</a></span>
                            </li>
                                                    <li>
                                <span><a href="Eligibility_289898573.html">Eligibility</a></span>
                            </li>
                                                </ol>
                    </div>
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            DevOps : Eligibility Rules Implementation
                        </span>
                    </h1>
                </div>

                <div id="content" class="view">
                    <div class="page-metadata">
                        
        
    
        
    
        
        
            Created by <span class='author'> Nicholas Guner</span> on Apr 18, 2020
                        </div>
                    <div id="main-content" class="wiki-content group">
                    <h1 id="EligibilityRulesImplementation-POM.XMLFile">POM.XML File</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;
   &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
   &lt;parent&gt;
      &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
      &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
      &lt;version&gt;2.1.9.RELEASE&lt;/version&gt;
      &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
   &lt;/parent&gt;
   &lt;groupId&gt;com.springboot.eligibility&lt;/groupId&gt;
   &lt;artifactId&gt;eligibility-rules&lt;/artifactId&gt;
   &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
   &lt;name&gt;eligibility-rules&lt;/name&gt;
   &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;

   &lt;properties&gt;
      &lt;java.version&gt;1.8&lt;/java.version&gt;
   &lt;/properties&gt;

   &lt;dependencies&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
         &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
         &lt;artifactId&gt;spring-boot-starter-data-rest&lt;/artifactId&gt;
      &lt;/dependency&gt;

      &lt;dependency&gt;
         &lt;groupId&gt;com.h2database&lt;/groupId&gt;
         &lt;artifactId&gt;h2&lt;/artifactId&gt;
         &lt;scope&gt;runtime&lt;/scope&gt;
      &lt;/dependency&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
         &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
         &lt;scope&gt;test&lt;/scope&gt;
      &lt;/dependency&gt;
      &lt;!--
      &lt;dependency&gt;
         &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
         &lt;artifactId&gt;spring-security-core&lt;/artifactId&gt;
         &lt;version&gt;5.2.0.RELEASE&lt;/version&gt;
      &lt;/dependency&gt;
      --&gt;
      &lt;dependency&gt;
         &lt;groupId&gt;com.gs.spring&lt;/groupId&gt;
         &lt;artifactId&gt;gs-spring-boot-security&lt;/artifactId&gt;
         &lt;version&gt;2.1.4&lt;/version&gt;
      &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.gs.opstech.common&lt;/groupId&gt;
            &lt;artifactId&gt;gsknex-security&lt;/artifactId&gt;
            &lt;version&gt;3.8.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.gs.spring&lt;/groupId&gt;
            &lt;artifactId&gt;gs-spring-boot-authenticator&lt;/artifactId&gt;
            &lt;version&gt;2.1.4&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.ibm.db2&lt;/groupId&gt;
            &lt;artifactId&gt;db2jcc4&lt;/artifactId&gt;
            &lt;version&gt;10.5.7.3.69.49&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.gs.spring&lt;/groupId&gt;
            &lt;artifactId&gt;gs-spring-boot-credential-vault&lt;/artifactId&gt;
            &lt;version&gt;2.1.7&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.vaadin.external.google&lt;/groupId&gt;
            &lt;artifactId&gt;android-json&lt;/artifactId&gt;
            &lt;version&gt;RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;

</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h1 id="EligibilityRulesImplementation-EntityClasses">Entity Classes</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@MappedSuperclass
@EntityListeners(AuditingEntityListener.class)
public class BaseEntity extends ResourceSupport
{

    public static ZonedDateTime DATE_INFINITY = ZonedDateTime.parse(&quot;9999-12-31T00:00:00Z&quot;);

    @Column(name = &quot;in_utc&quot;, nullable = false, updatable = false)
    @CreatedDate
    //@JsonIgnore
    @CreationTimestamp
    @Temporal(TemporalType.TIMESTAMP)
    private Date inUtc;

    @Column(name = &quot;out_utc&quot;)
    private ZonedDateTime outUtc = DATE_INFINITY;

    @CreatedBy
    //@JsonIgnore
    @Column(name = &quot;created_by&quot;)
    private String createdBy;

    @LastModifiedBy
    //@JsonIgnore
    @Column(name = &quot;last_modified_by&quot;)
    private String lastModifiedBy;


    public Date getInUtc()
    {
        return inUtc;
    }

    public void setInUtc(Date inUtc)
    {
        this.inUtc = inUtc;
    }

    public ZonedDateTime getOutUtc()
    {
        return outUtc;
    }

    public void setOutUtc(ZonedDateTime outUtc)
    {
        this.outUtc = outUtc;
    }

    public String getCreatedBy()
    {
        return createdBy;
    }

    public void setCreatedBy(String createdBy)
    {
        this.createdBy = createdBy;
    }

    public String getLastModifiedBy()
    {
        return lastModifiedBy;
    }

    public void setLastModifiedBy(String lastModifiedBy)
    {
        this.lastModifiedBy = lastModifiedBy;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;KEY_STORE&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
        })
public class KeyStore extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    private String key;
    private String value;

    public KeyStore(String keyStoreId, String key, String value)
    {
        this.biTemporalId = keyStoreId;
        this.key = key;
        this.value = value;
    }

    //  Copy constructor to create Audit Trail
    public KeyStore(KeyStore other)
    {
        super();
        this.biTemporalId = other.biTemporalId;
        this.key = other.key;
        this.value = other.value;
        this.setOutUtc(ZonedDateTime.now());
    }

    public KeyStore() {}

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public String getKey()
    {
        return key;
    }

    public void setKey(String key)
    {
        this.key = key;
    }

    public String getValue()
    {
        return value;
    }

    public void setValue(String value)
    {
        this.value = value;
    }


    @Override
    public String toString()
    {
        return &quot;KeyStore{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, biTemporalId=&#39;&quot; + biTemporalId + &#39;\&#39;&#39; +
                &quot;, key=&#39;&quot; + key + &#39;\&#39;&#39; +
                &quot;, value=&#39;&quot; + value + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        KeyStore keyStore = (KeyStore) o;
        return ID == keyStore.ID &amp;&amp;
                Objects.equals(biTemporalId, keyStore.biTemporalId) &amp;&amp;
                Objects.equals(key, keyStore.key) &amp;&amp;
                Objects.equals(value, keyStore.value);
    }

    @Override
    public int hashCode()
    {
        return Objects.hash(super.hashCode(), ID, biTemporalId, key, value);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;PROPERTIES&quot;,
        uniqueConstraints={
        @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
})
public class Properties extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    private int propertiesId;
    private int keyStoreId;

    public Properties(String biTemporalId, int ruleSetId, int keyStoreId)
    {
        this.biTemporalId = biTemporalId;
        this.propertiesId = ruleSetId;
        this.keyStoreId = keyStoreId;
    }

    protected Properties() {}

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public int getPropertiesId()
    {
        return propertiesId;
    }

    public void setPropertiesId(int propertiesId)
    {
        this.propertiesId = propertiesId;
    }

    public int getKeyStoreId()
    {
        return keyStoreId;
    }

    public void setKeyStoreId(int keyStoreId)
    {
        this.keyStoreId = keyStoreId;
    }


    @Override
    public String toString()
    {
        return &quot;Properties{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, biTemporalId=&#39;&quot; + biTemporalId + &#39;\&#39;&#39; +
                &quot;, propertiesId=&quot; + propertiesId +
                &quot;, keyStoreId=&quot; + keyStoreId +
                &#39;}&#39;;
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        Properties properties = (Properties) o;
        return ID == properties.ID &amp;&amp;
                propertiesId == properties.propertiesId &amp;&amp;
                keyStoreId == properties.keyStoreId &amp;&amp;
                Objects.equals(biTemporalId, properties.biTemporalId);
    }

    @Override
    public int hashCode()
    {
        return Objects.hash(super.hashCode(), ID, biTemporalId, propertiesId, keyStoreId);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;RULE_PROPERTIES_MAP&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
        })
public class RulePropertiesMap extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    private int ruleId;
    private int propertiesId;

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public int getRuleId()
    {
        return ruleId;
    }

    public void setRuleId(int ruleId)
    {
        this.ruleId = ruleId;
    }

    public int getPropertiesId()
    {
        return propertiesId;
    }

    public void setPropertiesId(int propertiesId)
    {
        this.propertiesId = propertiesId;
    }

    @Override
    public String toString()
    {
        return &quot;RulePropertiesMap{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, biTemporalId=&#39;&quot; + biTemporalId + &#39;\&#39;&#39; +
                &quot;, ruleId=&quot; + ruleId +
                &quot;, propertiesId=&quot; + propertiesId +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;RULE&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
        })
public class Rule extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    private String name;
    private String type;
    private String state;

    @OneToMany(mappedBy = &quot;rule&quot;)
    private List&lt;DutyRulePair&gt; dutyRulePair = new ArrayList&lt;&gt;();

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public String getName()
    {
        return name;
    }

    public void setName(String name)
    {
        this.name = name;
    }

    public String getType()
    {
        return type;
    }

    public void setType(String type)
    {
        this.type = type;
    }

    public String getState()
    {
        return state;
    }

    public void setState(String state)
    {
        this.state = state;
    }

    public List&lt;DutyRulePair&gt; getDutyRulePair()
    {
        return dutyRulePair;
    }

    public void setDutyRulePair(List&lt;DutyRulePair&gt; dutyRulePair)
    {
        this.dutyRulePair = dutyRulePair;
    }

    public void addDutyRuleMap(DutyRulePair dutyRulePair)
    {
        this.dutyRulePair.add(dutyRulePair);
    }

    public void removeDutyRuleMap(DutyRulePair dutyRulePair)
    {
        this.dutyRulePair.remove(dutyRulePair);
    }

    @Override
    public String toString()
    {
        return &quot;Rule{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, biTemporalId=&#39;&quot; + biTemporalId + &#39;\&#39;&#39; +
                &quot;, name=&#39;&quot; + name + &#39;\&#39;&#39; +
                &quot;, type=&#39;&quot; + type + &#39;\&#39;&#39; +
                &quot;, state=&#39;&quot; + state + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        Rule rule = (Rule) o;
        return ID == rule.ID &amp;&amp;
                Objects.equals(biTemporalId, rule.biTemporalId) &amp;&amp;
                Objects.equals(name, rule.name) &amp;&amp;
                Objects.equals(type, rule.type) &amp;&amp;
                Objects.equals(state, rule.state);
    }

    @Override
    public int hashCode()
    {
        return Objects.hash(super.hashCode(), ID, biTemporalId, name, type, state);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;DUTY&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
        })
public class Duty extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    private String dutyName;

    @OneToMany(mappedBy = &quot;duty&quot;)
    private List&lt;DutyRulePair&gt; dutyRulePair = new ArrayList&lt;&gt;();

    @OneToMany(mappedBy = &quot;duty&quot;)
    private List&lt;DutyPrivilegePair&gt; dutyPrivilegePair = new ArrayList&lt;&gt;();

    //  Copy constructor to create Audit Trail
    public Duty(Duty other)
    {
        super();
        this.biTemporalId = other.biTemporalId;
        this.dutyName = other.dutyName;
        this.setOutUtc(ZonedDateTime.now());
    }

    public Duty()
    {
        super();
    }


    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public String getDutyName()
    {
        return dutyName;
    }

    public void setDutyName(String dutyName)
    {
        this.dutyName = dutyName;
    }

    public List&lt;DutyRulePair&gt; getDutyRulePair()
    {
        return dutyRulePair;
    }

    public void setDutyRulePair(List&lt;DutyRulePair&gt; dutyRulePair)
    {
        this.dutyRulePair = dutyRulePair;
    }

    public void addDutyRuleMap(DutyRulePair dutyRulePair)
    {
        this.dutyRulePair.add(dutyRulePair);
    }

    public void removeDutyRuleMap(DutyRulePair dutyRulePair)
    {
        this.dutyRulePair.remove(dutyRulePair);
    }

    public List&lt;DutyPrivilegePair&gt; getDutyPrivilegePair()
    {
        return dutyPrivilegePair;
    }

    public void setDutyPrivilegePair(List&lt;DutyPrivilegePair&gt; dutyPrivilegePair)
    {
        this.dutyPrivilegePair = dutyPrivilegePair;
    }

    public void addDutyPrivilegeMap(DutyPrivilegePair dutyPrivilegePair)
    {
        this.dutyPrivilegePair.add(dutyPrivilegePair);
    }

    public void removeDutyPrivilegeMap(DutyPrivilegePair dutyPrivilegePair)
    {
        this.dutyPrivilegePair.remove(dutyPrivilegePair);
    }

    @Override
    public String toString()
    {
        return &quot;Duty{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, biTemporalId=&#39;&quot; + biTemporalId + &#39;\&#39;&#39; +
                &quot;, dutyName=&#39;&quot; + dutyName + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        Duty duty = (Duty) o;
        return ID == duty.ID &amp;&amp;
                Objects.equals(biTemporalId, duty.biTemporalId) &amp;&amp;
                Objects.equals(dutyName, duty.dutyName);
    }

    @Override
    public int hashCode()
    {
        return Objects.hash(super.hashCode(), ID, biTemporalId, dutyName);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@Table(name = &quot;DUTY_RULE_MAP&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
        })
public class DutyRulePair extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    @ManyToOne
    @JoinColumn(name = &quot;duty_id&quot;)
    private Duty duty;
    @ManyToOne
    @JoinColumn(name = &quot;rule_id&quot;)
    private Rule rule;

    public DutyRulePair(Duty duty, Rule rule)
    {
        this.duty = duty;
        this.rule = rule;
    }

    protected DutyRulePair()
    {}


    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public Duty getDuty()
    {
        return duty;
    }

    public void setDuty(Duty duty)
    {
        this.duty = duty;
    }

    public Rule getRule()
    {
        return rule;
    }

    public void setRule(Rule rule)
    {
        this.rule = rule;
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        DutyRulePair that = (DutyRulePair) o;
        return Objects.equals(duty, that.duty) &amp;&amp;
                Objects.equals(rule, that.rule);
    }

    @Override
    public int hashCode()
    {
        return Objects.hash(super.hashCode(), duty, rule);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;PRIVILEGE&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
        })
public class Privilege extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    private String privilegeName;
    @OneToMany(mappedBy = &quot;privilege&quot;)
    private List&lt;DutyPrivilegePair&gt; dutyPrivilegePair = new ArrayList&lt;&gt;();
    @OneToMany(mappedBy = &quot;privilege&quot;)
    private List&lt;UserPrivilegePair&gt; userPrivilegePair = new ArrayList&lt;&gt;();

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public String getPrivilegeName()
    {
        return privilegeName;
    }

    public void setPrivilegeName(String privilegeName)
    {
        this.privilegeName = privilegeName;
    }

    public List&lt;DutyPrivilegePair&gt; getDutyPrivilegePair()
    {
        return dutyPrivilegePair;
    }

    public void setDutyPrivilegePair(List&lt;DutyPrivilegePair&gt; dutyPrivilegePair)
    {
        this.dutyPrivilegePair = dutyPrivilegePair;
    }

    public void addDutyPrivilegeMap(DutyPrivilegePair dutyPrivilegePair)
    {
        this.dutyPrivilegePair.add(dutyPrivilegePair);
    }

    public void removeDutyPrivilegeMap(DutyPrivilegePair dutyPrivilegePair)
    {
        this.dutyPrivilegePair.remove(dutyPrivilegePair);
    }

    public List&lt;UserPrivilegePair&gt; getUserPrivilegePair()
    {
        return userPrivilegePair;
    }

    public void setUserPrivilegePair(List&lt;UserPrivilegePair&gt; userPrivilegePair)
    {
        this.userPrivilegePair = userPrivilegePair;
    }

    public void addUserPrivilegeMap(UserPrivilegePair userPrivilegePair)
    {
        this.userPrivilegePair.add(userPrivilegePair);
    }

    public void removeUserPrivilegeMap(UserPrivilegePair userPrivilegePair)
    {
        this.userPrivilegePair.remove(userPrivilegePair);
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        Privilege privilege = (Privilege) o;
        return ID == privilege.ID &amp;&amp;
                Objects.equals(biTemporalId, privilege.biTemporalId) &amp;&amp;
                Objects.equals(privilegeName, privilege.privilegeName);
    }

    @Override
    public int hashCode()
    {

        return Objects.hash(super.hashCode(), ID, biTemporalId, privilegeName);
    }

    @Override
    public String toString()
    {
        return &quot;Privilege{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, biTemporalId=&#39;&quot; + biTemporalId + &#39;\&#39;&#39; +
                &quot;, privilegeName=&#39;&quot; + privilegeName + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;DUTY_PRIVILEGE_MAP&quot;,
        uniqueConstraints={
        @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
})
public class DutyPrivilegePair extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    @ManyToOne
    @JoinColumn(name = &quot;duty_id&quot;)
    private Duty duty;
    @ManyToOne
    @JoinColumn(name = &quot;privilege_id&quot;)
    private Privilege privilege;

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public Duty getDuty()
    {
        return duty;
    }

    public void setDuty(Duty duty)
    {
        this.duty = duty;
    }

    public Privilege getPrivilege()
    {
        return privilege;
    }

    public void setPrivilege(Privilege privilege)
    {
        this.privilege = privilege;
    }


    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        DutyPrivilegePair that = (DutyPrivilegePair) o;
        return ID == that.ID &amp;&amp;
                Objects.equals(biTemporalId, that.biTemporalId) &amp;&amp;
                Objects.equals(duty, that.duty) &amp;&amp;
                Objects.equals(privilege, that.privilege);
    }

    @Override
    public int hashCode()
    {
        return Objects.hash(super.hashCode(), ID, biTemporalId, duty, privilege);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;USER&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
        })
public class User extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    private String name;
    private String location;
    private String department;
    private String level;
    @OneToMany(mappedBy = &quot;user&quot;)
    private List&lt;UserPrivilegePair&gt; userPrivilegePair = new ArrayList&lt;&gt;();

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public String getName()
    {
        return name;
    }

    public void setName(String name)
    {
        this.name = name;
    }

    public String getLocation()
    {
        return location;
    }

    public void setLocation(String location)
    {
        this.location = location;
    }

    public String getDepartment()
    {
        return department;
     }

    public void setDepartment(String department)
    {
        this.department = department;
    }

    public String getLevel()
    {
        return level;
    }

    public void setLevel(String level)
    {
        this.level = level;
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        User user = (User) o;
        return ID == user.ID &amp;&amp;
                Objects.equals(biTemporalId, user.biTemporalId) &amp;&amp;
                Objects.equals(name, user.name) &amp;&amp;
                Objects.equals(location, user.location) &amp;&amp;
                Objects.equals(department, user.department) &amp;&amp;
                Objects.equals(level, user.level);
    }

    @Override
    public int hashCode()
    {
        return Objects.hash(super.hashCode(), ID, biTemporalId, name, location, department, level);
    }

    @Override
    public String toString()
    {
        return &quot;User{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, biTemporalId=&#39;&quot; + biTemporalId + &#39;\&#39;&#39; +
                &quot;, name=&#39;&quot; + name + &#39;\&#39;&#39; +
                &quot;, location=&#39;&quot; + location + &#39;\&#39;&#39; +
                &quot;, department=&#39;&quot; + department + &#39;\&#39;&#39; +
                &quot;, level=&#39;&quot; + level + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Entity
@EntityListeners(AuditingEntityListener.class)
@Table(name = &quot;USER_PRIVILEGE_MAP&quot;,
        uniqueConstraints={
                @UniqueConstraint(columnNames = {&quot;biTemporalId&quot;, &quot;out_utc&quot;})
        })
public class UserPrivilegePair extends BaseEntity
{
    @Id
    @GeneratedValue(strategy = GenerationType.SEQUENCE)
    @Column(name=&quot;ID&quot;, updatable = false, nullable = false)
    private int ID;
    private String biTemporalId = UUID.randomUUID().toString();
    @ManyToOne
    @JoinColumn(name = &quot;user_id&quot;)
    private User user;
    @ManyToOne
    @JoinColumn(name = &quot;privilege_id&quot;)
    private Privilege privilege;

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getBiTemporalId()
    {
        return biTemporalId;
    }

    public void setBiTemporalId(String biTemporalId)
    {
        this.biTemporalId = biTemporalId;
    }

    public User getUser()
    {
        return user;
    }

    public void setUser(User user)
    {
        this.user = user;
    }

    public Privilege getPrivilege()
    {
        return privilege;
    }

    public void setPrivilege(Privilege privilege)
    {
        this.privilege = privilege;
    }

    @Override
    public boolean equals(Object o)
    {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        if (!super.equals(o)) return false;
        UserPrivilegePair that = (UserPrivilegePair) o;
        return ID == that.ID &amp;&amp;
                Objects.equals(biTemporalId, that.biTemporalId) &amp;&amp;
                Objects.equals(user, that.user) &amp;&amp;
                Objects.equals(privilege, that.privilege);
    }

    @Override
    public int hashCode()
    {
        return Objects.hash(super.hashCode(), ID, biTemporalId, user, privilege);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h1 id="EligibilityRulesImplementation-RepositoryClasses">Repository Classes</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface KeyStoreRepository extends JpaRepository&lt;KeyStore, Integer&gt;
{
    @Query(&quot;select k from KeyStore k where k.ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;KeyStore&gt; findById(@Param(&quot;id&quot;) int id);

    @Query(&quot;select k from KeyStore k where KEY = &#39;Location&#39; and  VALUE = :val and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;KeyStore&gt; findByLocation(@Param(&quot;val&quot;) String val);

    @Query(&quot;select k from KeyStore k where KEY = &#39;Department&#39; and  VALUE = :val and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;KeyStore&gt; findByDepartment(@Param(&quot;val&quot;) String val);

    @Query(&quot;select k from KeyStore k where KEY = &#39;Level&#39; and  VALUE = :val and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;KeyStore&gt; findByLevel(@Param(&quot;val&quot;) String val);

    @Query(&quot;select k from KeyStore k where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;KeyStore&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface PropertiesRepository extends JpaRepository&lt;Properties, Integer&gt;
{
    @Query(&quot;select p from Properties p where p.propertiesId = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;Properties&gt; findByPropertiesId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select p from Properties p where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;Properties&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface RulePropertiesMapRepository extends JpaRepository&lt;RulePropertiesMap, Integer&gt;
{
    @Query(&quot;select r from RulePropertiesMap r where RULE_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;RulePropertiesMap&gt; findByRuleId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select r from RulePropertiesMap r where PROPERTIES_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;RulePropertiesMap&gt; findByPropertiesId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select r from RulePropertiesMap r where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;RulePropertiesMap&gt; findAll();
}
</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface RulePropertiesMapRepository extends JpaRepository&lt;RulePropertiesMap, Integer&gt;
{
    @Query(&quot;select r from RulePropertiesMap r where RULE_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;RulePropertiesMap&gt; findByRuleId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select r from RulePropertiesMap r where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;RulePropertiesMap&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface DutyRepository extends JpaRepository&lt;Duty, Integer&gt;
{
    @Query(&quot;select d from Duty d where d.ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;Duty&gt; findById(@Param(&quot;id&quot;) int id);

    @Query(&quot;select d from Duty d where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;Duty&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface PrivilegeRepository extends JpaRepository&lt;Privilege, Integer&gt;
{
    @Query(&quot;select p from Privilege p where p.ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;Privilege&gt; findById(@Param(&quot;id&quot;) int id);

    @Query(&quot;select p from Privilege p where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;Privilege&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface DutyPrivilegeMapRepository extends JpaRepository&lt;DutyPrivilegePair, Integer&gt;
{
    @Query(&quot;select m from DutyPrivilegePair m where DUTY_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyPrivilegePair&gt; findByDutyId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select m from DutyPrivilegePair m where PRIVILEGE_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyPrivilegePair&gt; findByPrivilegeId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select m from DutyPrivilegePair m where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyPrivilegePair&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface DutyRuleMapRepository extends JpaRepository&lt;DutyRulePair, Integer&gt;
{
    @Query(&quot;select m from DutyRulePair m where DUTY_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyRulePair&gt; findByDutyId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select m from DutyRulePair m where RULE_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyRulePair&gt; findByRuleId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select m from DutyRulePair m where DUTY_ID = :id and out_utc &lt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyRulePair&gt; findByAuditDutyId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select m from DutyRulePair m where RULE_ID = :id and out_utc &lt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyRulePair&gt; findByAuditRuleId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select m from DutyRulePair m where RULE_ID = :ruleId and DUTY_ID = :dutyId and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;DutyRulePair&gt; findByRuleDutyId(@Param(&quot;ruleId&quot;) int ruleId, @Param(&quot;dutyId&quot;) int dutyId);

    @Query(&quot;select m from DutyRulePair m where RULE_ID = :ruleId and DUTY_ID = :dutyId and out_utc &lt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyRulePair&gt; findHistoryByRuleDutyId(@Param(&quot;ruleId&quot;) int ruleId, @Param(&quot;dutyId&quot;) int dutyId);

    @Query(&quot;select m from DutyRulePair m where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;DutyRulePair&gt; findAll();

    @Query(&quot;select m from DutyRulePair m&quot;)
    List&lt;DutyRulePair&gt; findAllWithAudit();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface UserRepository extends JpaRepository&lt;User, Integer&gt;
{
    @Query(&quot;select u from User u where u.ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    Optional&lt;User&gt; findById(@Param(&quot;id&quot;) int id);

    @Query(&quot;select u from User u where LOCATION = :val and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;User&gt; findByLocation(@Param(&quot;val&quot;) String val);

    @Query(&quot;select u from User u where DEPARTMENT = :val and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;User&gt; findByDepartment(@Param(&quot;val&quot;) String val);

    @Query(&quot;select u from User u where LEVEL = :val and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;User&gt; findByLevel(@Param(&quot;val&quot;) String val);

    @Query(&quot;select u from User u where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;User&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public interface UserPrivilegeMapRepository extends JpaRepository&lt;UserPrivilegePair, Integer&gt;
{
    @Query(&quot;select m from UserPrivilegePair m where USER_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;UserPrivilegePair&gt; findByUserId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select m from UserPrivilegePair m where PRIVILEGE_ID = :id and out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;UserPrivilegePair&gt; findByPrivilegeId(@Param(&quot;id&quot;) int id);

    @Query(&quot;select m from UserPrivilegePair m where out_utc &gt; CURRENT_TIMESTAMP&quot;)
    List&lt;UserPrivilegePair&gt; findAll();
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><p><br/></p><h1 id="EligibilityRulesImplementation-PresentationClasses">Presentation Classes</h1><p>Database tables provides mapping between values in theÂ <code>Key-Store, Properties, RulePropertiesMap</code>, etc. However, these mappings are expressed in terms of ID values. Presenting information on the UI in terms of ID values would not be very informative. Thus, we employ &quot;Presentation&quot; objects which would be rendered on the UI. Controllers will return responses in terms of &quot;Presentation&quot; objects.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class DutyPresentation extends ResourceSupport
{
    private int ID;
    private String dutyName;
    private List&lt;PrivilegePresentation&gt; privilegePresentations;


    public DutyPresentation(Duty duty, List&lt;PrivilegePresentation&gt; privilegePresentations)
    {
        this.ID = duty.getID();
        this.dutyName = duty.getDutyName();
        this.privilegePresentations = privilegePresentations;
    }

    protected DutyPresentation()
    {
    }

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getDutyName()
    {
        return dutyName;
    }

    public void setDutyName(String dutyName)
    {
        this.dutyName = dutyName;
    }

    public List&lt;PrivilegePresentation&gt; getPrivilegePresentations()
    {
        return privilegePresentations;
    }

    public void setPrivilegePresentations(List&lt;PrivilegePresentation&gt; privilegePresentations)
    {
        this.privilegePresentations = privilegePresentations;
    }

    @Override
    public String toString()
    {
        return &quot;DutyPresentation{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, dutyName=&#39;&quot; + dutyName + &#39;\&#39;&#39; +
                &quot;, privilegePresentations=&quot; + privilegePresentations +
                &#39;}&#39;;
    }
}
</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class PrivilegePresentation
{
    private int ID;
    private String privilegeName;

    public PrivilegePresentation(Privilege privilege)
    {
        this.privilegeName = privilege.getPrivilegeName();
        this.ID = privilege.getID();
    }

    protected PrivilegePresentation()
    {
    }

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getPrivilegeName()
    {
        return privilegeName;
    }

    public void setPrivilegeName(String privilegeName)
    {
        this.privilegeName = privilegeName;
    }

    @Override
    public String toString()
    {
        return &quot;PrivilegePresentation{&quot; +
                &quot;privilegeName=&#39;&quot; + privilegeName + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class PropertiesPresentation
{
    private int propertiesId;
    private Map&lt;String,String&gt; keyStore = new HashMap&lt;&gt;();

    public PropertiesPresentation(int ruleId)
    {
        this.propertiesId = ruleId;
    }

    public int getPropertiesId()
    {
        return propertiesId;
    }

    public void setPropertiesId(int propertiesId)
    {
        this.propertiesId = propertiesId;
    }

    public Map&lt;String, String&gt; getKeyStore()
    {
        return keyStore;
    }

    public void setKeyStore(Map&lt;String, String&gt; keyStore)
    {
        this.keyStore = keyStore;
    }

    public void addKeyValue(String key, String value)
    {
        keyStore.put(key, value);
    }

    @Override
    public String toString()
    {
        return &quot;PropertiesPresentation{&quot; +
                &quot;propertiesId=&quot; + propertiesId +
                &quot;, keyStore=&quot; + keyStore +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class RulePresentation extends ResourceSupport
{
    private int ID;
    private String ruleName;
    private String ruleType;
    private String ruleState;

    private List&lt;PropertiesPresentation&gt; propertiesPresentations;

    public RulePresentation(Rule rule, List&lt;PropertiesPresentation&gt; propertiesPresentations)
    {
        this.ID = rule.getID();
        this.ruleName = rule.getName();
        this.ruleType = rule.getType();
        this.ruleState = rule.getState();
        this.propertiesPresentations = propertiesPresentations;
    }

    protected RulePresentation()
    {}

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getRuleName()
    {
        return ruleName;
    }

    public void setRuleName(String ruleName)
    {
        this.ruleName = ruleName;
    }

    public String getRuleType()
    {
        return ruleType;
    }

    public void setRuleType(String ruleType)
    {
        this.ruleType = ruleType;
    }

    public String getRuleState()
    {
        return ruleState;
    }

    public void setRuleState(String ruleState)
    {
        this.ruleState = ruleState;
    }

    public List&lt;PropertiesPresentation&gt; getPropertiesPresentation()
    {
        return propertiesPresentations;
    }

    public void setPropertiesPresentation(List&lt;PropertiesPresentation&gt; propertiesPresentations)
    {
        this.propertiesPresentations = propertiesPresentations;
    }

    @Override
    public String toString()
    {
        return &quot;RulePresentation{&quot; +
                &quot;ID=&quot; + ID +
                &quot;, ruleName=&#39;&quot; + ruleName + &#39;\&#39;&#39; +
                &quot;, ruleType=&#39;&quot; + ruleType + &#39;\&#39;&#39; +
                &quot;, ruleState=&#39;&quot; + ruleState + &#39;\&#39;&#39; +
                &quot;, propertiesPresentations=&quot; + propertiesPresentations +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class UserPresentation extends ResourceSupport
{
    private String userName;
    private String userLocation;
    private String userDepartment;
    private String userLevel;
    private int ID;

    public UserPresentation(User user)
    {
        this.ID = user.getID();
        this.userName = user.getName();
        this.userLocation = user.getLocation();
        this.userDepartment = user.getDepartment();
        this.userLocation = user.getLevel();
    }

    protected UserPresentation()
    {
    }

    public int getID()
    {
        return ID;
    }

    public void setID(int ID)
    {
        this.ID = ID;
    }

    public String getUserName()
    {
        return userName;
    }

    public void setUserName(String userName)
    {
        this.userName = userName;
    }

    public String getUserLocation()
    {
        return userLocation;
    }

    public void setUserLocation(String userLocation)
    {
        this.userLocation = userLocation;
    }

    public String getUserDepartment()
    {
        return userDepartment;
    }

    public void setUserDepartment(String userDepartment)
    {
        this.userDepartment = userDepartment;
    }

    public String getUserLevel()
    {
        return userLevel;
    }

    public void setUserLevel(String userLevel)
    {
        this.userLevel = userLevel;
    }

    @Override
    public String toString()
    {
        return &quot;UserPresentation{&quot; +
                &quot;userName=&#39;&quot; + userName + &#39;\&#39;&#39; +
                &quot;, userLocation=&#39;&quot; + userLocation + &#39;\&#39;&#39; +
                &quot;, userDepartment=&#39;&quot; + userDepartment + &#39;\&#39;&#39; +
                &quot;, userLevel=&#39;&quot; + userLevel + &#39;\&#39;&#39; +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class ViolationPresentation extends ResourceSupport
{
    private User user;
    private Rule rule;
    private Duty duty;
    private String privilegeName;
    private int privilegeId;

    public ViolationPresentation(Privilege privilege, User user, Rule rule, Duty duty)
    {
        this.privilegeName = privilege.getPrivilegeName();
        this.privilegeId = privilege.getID();
        this.user = user;
        this.rule = rule;
        this.duty = duty;
    }

    public String getPrivilegeName()
    {
        return privilegeName;
    }

    public void setPrivilegeName(String privilegeName)
    {
        this.privilegeName = privilegeName;
    }

    public int getPrivilegeId()
    {
        return privilegeId;
    }

    public void setPrivilegeId(int privilegeId)
    {
        this.privilegeId = privilegeId;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class UserRulePresentation extends ResourceSupport
{
    private String userName;
    private String userLocation;
    private String userDepartment;
    private String userLevel;
    private int userId;

    private List&lt;RulePresentation&gt; rulePresentations = new ArrayList&lt;&gt;();

    public UserRulePresentation(User user, RulePresentation... rules)
    {
        this.userName = user.getName();
        this.userLocation = user.getLocation();
        this.userDepartment = user.getDepartment();
        this.userLevel = user.getLevel();
        this.userId = user.getID();

        this.rulePresentations = Arrays.asList(rules);
    }

    protected UserRulePresentation()
    {
    }

    public String getUserName()
    {
        return userName;
    }

    public void setUserName(String userName)
    {
        this.userName = userName;
    }

    public String getUserLocation()
    {
        return userLocation;
    }

    public void setUserLocation(String userLocation)
    {
        this.userLocation = userLocation;
    }

    public String getUserDepartment()
    {
        return userDepartment;
    }

    public void setUserDepartment(String userDepartment)
    {
        this.userDepartment = userDepartment;
    }

    public String getUserLevel()
    {
        return userLevel;
    }

    public void setUserLevel(String userLevel)
    {
        this.userLevel = userLevel;
    }

    public int getUserId()
    {
        return userId;
    }

    public void setUserId(int userId)
    {
        this.userId = userId;
    }

    public RulePresentation[] getRulePresentations()
    {
        return rulePresentations.toArray(new RulePresentation[0]);
    }


    @Override
    public String toString()
    {
        return &quot;UserRulePresentation{&quot; +
                &quot;userName=&#39;&quot; + userName + &#39;\&#39;&#39; +
                &quot;, userLocation=&#39;&quot; + userLocation + &#39;\&#39;&#39; +
                &quot;, userDepartment=&#39;&quot; + userDepartment + &#39;\&#39;&#39; +
                &quot;, userLevel=&#39;&quot; + userLevel + &#39;\&#39;&#39; +
                &quot;, userId=&quot; + userId +
                &quot;, rules=&quot; + rulePresentations +
                &#39;}&#39;;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h1 id="EligibilityRulesImplementation-ExceptionHandling">Exception Handling</h1><p>We provide custom exceptions to report conditions when users request objects by incorrect ID and when certain business rules are violated.</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@ControllerAdvice
@RestController
public class CustomizedResponseEntityExceptionHandler extends ResponseEntityExceptionHandler
{

    @ExceptionHandler(Exception.class)
    public final ResponseEntity&lt;Object&gt; handleAllExceptions(Exception ex, WebRequest request)
    {
        ExceptionResponse exceptionResponse = new ExceptionResponse(ZonedDateTime.now(), ex.getMessage(), request.getDescription(false));
        return new ResponseEntity(exceptionResponse, HttpStatus.INTERNAL_SERVER_ERROR);
    }

    @ExceptionHandler(RuleViolationException.class)
    public final ResponseEntity&lt;Object&gt; handleRuleViolationException(RuleViolationException ex, WebRequest request)
    {
        ExceptionResponse exceptionResponse = new ExceptionResponse(ZonedDateTime.now(), ex.getMessage(),
                request.getDescription(false));
        return new ResponseEntity(exceptionResponse, HttpStatus.FAILED_DEPENDENCY);
    }


    @ExceptionHandler(NotFoundException.class)
    public final ResponseEntity&lt;Object&gt; handleReaderNotFoundException(NotFoundException ex, WebRequest request)
    {
        ExceptionResponse exceptionResponse = new ExceptionResponse(ZonedDateTime.now(), ex.getMessage(),
                request.getDescription(false));
        return new ResponseEntity(exceptionResponse, HttpStatus.NOT_FOUND);
    }

    @Override
    protected ResponseEntity&lt;Object&gt; handleMethodArgumentNotValid(MethodArgumentNotValidException ex,
                                                                  HttpHeaders headers, HttpStatus status, WebRequest request)
    {
        ExceptionResponse exceptionResponse = new ExceptionResponse(ZonedDateTime.now(), &quot;Validation Failed&quot;,
                ex.getBindingResult().toString());
        return new ResponseEntity(exceptionResponse, HttpStatus.BAD_REQUEST);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class ExceptionResponse
{
    private ZonedDateTime timestamp;
    private String message;
    private String details;

    public ExceptionResponse(ZonedDateTime timestamp, String message, String details) {
        this.timestamp = timestamp;
        this.message = message;
        this.details = details;
    }

    public ZonedDateTime getTimestamp() {
        return timestamp;
    }

    public String getMessage() {
        return message;
    }

    public String getDetails() {
        return details;
    }
}


</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@ResponseStatus(HttpStatus.NOT_FOUND)
public class NotFoundException extends RuntimeException
{
    public NotFoundException(String message)
    {
        super(message);
    }
}


</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@ResponseStatus(HttpStatus.FAILED_DEPENDENCY)
public class RuleViolationException extends RuntimeException
{
    public RuleViolationException(String message)
    {
        super(message);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h1 id="EligibilityRulesImplementation-Audit&amp;SecurityandDefaultTimeZone">Audit &amp; Security and Default TimeZone</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">public class AuditorAwareImpl implements AuditorAware&lt;String&gt;
{
    @Override
    public Optional&lt;String&gt; getCurrentAuditor()
    {
        return Optional.of(System.getProperty(&quot;user.name&quot;));
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Configuration
@EnableJpaAuditing(auditorAwareRef = &quot;auditorAware&quot;)
public class JpaConfig
{
    @Bean
    public AuditorAware&lt;String&gt; auditorAware()
    {
        return new AuditorAwareImpl();
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Configuration
public class LocaleConfig
{
    @PostConstruct
    public void changeTimeZone()
    {
        TimeZone.setDefault(TimeZone.getTimeZone(&quot;UTC&quot;));
    }
}


</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Configuration
@Profile({&quot;db2&quot;})
public class DataSourceConfig
{
    @Value(&quot;${datasource.driver-class-name}&quot;)
    String dataSourceDriverClass;

    @Value(&quot;${datasource.url}&quot;)
    String dataSourceUrl;

    @Value(&quot;${datasource.system.account.credref}&quot;)
    String credRef;

    @Bean
    public DataSource getDataSource()
    {
        CredentialLookUp&lt;SystemAccount&gt; credentialLookUp = new CredentialLookUp&lt;&gt;();
        SystemAccount systemAccount = credentialLookUp.getCredentialObject(credRef);
        String systemAccountPassword = systemAccount.getPassword();
        String systemAccountName = systemAccount.getAccountName();
        String[] systemAccountParts = systemAccountName.split(&quot;\\\\&quot;);
        return DataSourceBuilder
                .create()
                .username(systemAccountParts[1])
                .password(systemAccountPassword)
                .url(dataSourceUrl)
                .driverClassName(dataSourceDriverClass)
                .build();
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Service(&quot;AuthenticationService&quot;)
public class GSSSOToken
{
    @Value(&quot;${datasource.system.account.credref}&quot;)
    String credRef;

    public String getCookie()
    {
        CredentialLookUp&lt;SystemAccount&gt; credentialLookUp = new CredentialLookUp&lt;&gt;();
        SystemAccount systemAccount = credentialLookUp.getCredentialObject(credRef);
        String systemAccountPassword = systemAccount.getPassword();
        String systemAccountName = systemAccount.getAccountName();
        String[] systemAccountParts = systemAccountName.split(&quot;\\\\&quot;);
        GSSSOTokenProvider tokenProvider = new GSSSOTokenProvider(systemAccountParts[1], systemAccountPassword);
        tokenProvider.init();
        return tokenProvider.getCurrentAuthenticationToken();
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Component
@Profile({&quot;h2&quot;, &quot;db2&quot;})
public class HttpServer
{
    @Bean
    public ServletWebServerFactory servletContainer(@Value(&quot;${server.http.port}&quot;) int httpPort)
    {
        Connector connector = new Connector(TomcatServletWebServerFactory.DEFAULT_PROTOCOL);
        connector.setPort(httpPort);

        TomcatServletWebServerFactory tomcat = new TomcatServletWebServerFactory();
        tomcat.addAdditionalTomcatConnectors(connector);
        return tomcat;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Component
@Profile({&quot;h2&quot;, &quot;db2&quot;})
public class SSLConfig  implements WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt;
{
    @Value(&quot;${server.ssl.key-store}&quot;)
    private  String keyStore;

    @Value(&quot;${server.ssl.key-store-type}&quot;)
    private  String keyStoreType;

    @Value(&quot;${server.ssl.system.account.credref}&quot;)
    String credRef;

    @Value(&quot;${server.ssl.system.account.name}&quot;)
    String systemAccountName;

    @Override
    public void customize(ConfigurableServletWebServerFactory serverFactory)
    {
        CredentialLookUp&lt;SystemAccount&gt; credentialLookUp = new CredentialLookUp&lt;&gt;();
        SystemAccount systemAccount = credentialLookUp.getCredentialObject(credRef);
        String password = systemAccount.getPassword();

        Ssl ssl = new Ssl();
        ssl.setKeyStore(keyStore);
        ssl.setKeyStoreType(keyStoreType);
        ssl.setKeyPassword(password);
        ssl.setKeyStorePassword(password);
        serverFactory.setSsl(ssl);
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h1 id="EligibilityRulesImplementation-In-MemoryDatabase">In-Memory Database</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">--  KEY_STORE
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Location&#39;, &#39;Singapore&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Location&#39;, &#39;Moscow&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Department&#39;, &#39;T123&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;Department&#39;, &#39;T999&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, &#39;Level&#39;, &#39;MD&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, &#39;Level&#39;, &#39;VP&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, &#39;Location&#39;, &#39;New-York&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, &#39;Department&#39;, &#39;T567&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, &#39;Level&#39;, &#39;Assoc&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, &#39;Level&#39;, &#39;Contingent&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)


--  PROPERTIES
-- Location=&#39;Singapore&#39;, Dept = &#39;T123&#39;, Level = &#39;VP&#39;
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 1, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 1, 3, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 1, 6, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Location=&#39;Singapore&#39;, Dept = &#39;T123&#39;, Level = &#39;MD&#39;
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 2, 1, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, 2, 3, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, 2, 5, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Location=&#39;Moscow&#39;, Dept = &#39;T999&#39;, Level = &#39;MD&#39;
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, 3, 2, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, 3, 4, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, 3, 5, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Location=&#39;New-York&#39;, Dept = &#39;T567&#39;, Level = &#39;Assoc&#39;
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, 4, 7, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(11, &#39;0011&#39;, 4, 8, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(12, &#39;0012&#39;, 4, 9, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Location=&#39;New-York&#39;, Dept = &#39;T567&#39;, Level = &#39;VP&#39;
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(13, &#39;0013&#39;, 5, 7, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(14, &#39;0014&#39;, 5, 8, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(15, &#39;0015&#39;, 5, 6, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Level = &#39;MD&#39;
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(16, &#39;0016&#39;, 6, 5, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Level = &#39;Contingent&#39;
INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(17, &#39;0017&#39;, 7, 10, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)


-- RULE Definitions
INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Refreshments-Rule&#39;, &#39;Allow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Transport-Rule&#39;, &#39;Allow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Unassigned-Rule&#39;, &#39;Allow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;BigPerks-Rule&#39;, &#39;Allow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, &#39;Training-Rule&#39;, &#39;Disallow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)

-- RULE_PROPERTIES_MAP
-- Refreshments-Rule - Allow:
-- Location=&#39;Singapore&#39;, Dept = &#39;T123&#39;, Level = &#39;VP&#39;
-- Location=&#39;Singapore&#39;, Dept = &#39;T123&#39;, Level = &#39;MD&#39;
INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 1, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 1, 2, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Transport-Rule - Allow:
-- Location=&#39;Moscow&#39;, Dept = &#39;T999&#39;, Level = &#39;MD&#39;
INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 2, 3, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Unassigned-Rule - Allow:
-- Location=&#39;New-York&#39;, Dept = &#39;T567&#39;, Level = &#39;Assoc&#39;
-- Location=&#39;New-York&#39;, Dept = &#39;T567&#39;, Level = &#39;VP&#39;
INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 3, 4, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, 3, 5, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- BigPerks-Rule - Allow
-- Level = &#39;MD&#39;
INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, 4, 6, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Training-Rule - Disallow:
-- Level = &#39;Contingent&#39;
INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, 5, 7, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)



-- PRIVILEGE
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Free coffee&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Free milk&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Free sugar&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;Free car&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, &#39;Free gas&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, &#39;Free tolls&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, &#39;Fat bonus&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, &#39;Extended vacation&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, &#39;Golden parachute&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, &#39;Online courses&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(11, &#39;0011&#39;, &#39;Pluralsight subscription&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(12, &#39;0012&#39;, &#39;Coursera subscription&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)

-- DUTIES
INSERT INTO DUTY(ID, BI_TEMPORAL_ID, DUTY_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Refreshments&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY(ID, BI_TEMPORAL_ID, DUTY_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Transport&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY(ID, BI_TEMPORAL_ID, DUTY_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Big Perks&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY(ID, BI_TEMPORAL_ID, DUTY_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;Training&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)

--  DUTY_PRIVILEGE_MAP
--  Duty: Refreshments [Free coffee, Free milk, Free sugar]
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 1, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 1, 2, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 1, 3, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Duty: Transport [Free car, Free gas, Free tolls]
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 2, 4, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, 2, 5, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, 2, 6, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Duty: Big Perks [Fat bonus, Extended vacation, Golden parachute]
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, 3, 7, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, 3, 8, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, 3, 9, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Duty: Training [Online courses, Pluralsight subscription, Coursera subscription]
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, 4, 10, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(11, &#39;0011&#39;, 4, 11, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(12, &#39;0012&#39;, 4, 12, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)


-- DUTY_RULE_MAP
-- Refreshments-Rule
INSERT INTO DUTY_RULE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, RULE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 1, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Transport-Rule
INSERT INTO DUTY_RULE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, RULE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 2, 2, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  BigPerks-Rule
INSERT INTO DUTY_RULE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, RULE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 3, 4, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Training-Rule
INSERT INTO DUTY_RULE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, RULE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 4, 5, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)

-- USERS
--  Qualifies for Refreshments-Rule
INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Nick&#39;, &#39;Singapore&#39;, &#39;T123&#39;, &#39;VP&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Alex&#39;, &#39;Singapore&#39;, &#39;T123&#39;, &#39;MD&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Qualifies for Transport-Rule
INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Ivan&#39;, &#39;Moscow&#39;, &#39;T999&#39;, &#39;MD&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Qualifies for BigPerks-Rule
INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;Andy&#39;, &#39;New-York&#39;, &#39;T111&#39;, &#39;MD&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Qualifies for Training
INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, &#39;Joe&#39;, &#39;Jersey City&#39;, &#39;T888&#39;, &#39;Contingent&#39;, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)


-- USER_PRIVILEGE
--  Nick - &#39;Free milk&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 2, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Alex - &#39;Free sugar&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 2, 3, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Ivan - &#39;Free milk&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 3, 2, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Andy - &#39;Free coffee&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 4, 1, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Joe - &#39;Free milk&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, 5, 2, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Nick - &#39;Free car&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, 1, 4, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Nick - &#39;Coursera subscription&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, 1, 12, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Andy - &#39;Free gas&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, 4, 5, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Nick - &#39;Extended vacation&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, 1, 8, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Ivan - &#39;online courses&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, 3, 10, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
-- Joe - &#39;Pluralsight subscription&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(11, &#39;0011&#39;, 5, 11, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Alex - &#39;Fat Bonus&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(12, &#39;0012&#39;, 2, 7, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Ivan - &#39;Golden Parachute&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(13, &#39;0013&#39;, 3, 9, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)
--  Ivan - &#39;Free gas&#39;
INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(14, &#39;0014&#39;, 3, 5, CURRENT_TIMESTAMP, &#39;9999-12-31&#39;, &#39;unknown&#39;, &#39;unknown&#39;)


--SEQUENCE
alter sequence HIBERNATE_SEQUENCE restart with 100

------------------------------------------------------------------------------------------------
----------------------------  SQL Commands for DB2 database ------------------------------------
------------------------------------------------------------------------------------------------
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Location&#39;, &#39;Singapore&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Location&#39;, &#39;Moscow&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Department&#39;, &#39;T123&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;Department&#39;, &#39;T999&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, &#39;Level&#39;, &#39;MD&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, &#39;Level&#39;, &#39;VP&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, &#39;Location&#39;, &#39;New-York&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, &#39;Department&#39;, &#39;T567&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, &#39;Level&#39;, &#39;Assoc&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO KEY_STORE(ID, BI_TEMPORAL_ID, KEY, VALUE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, &#39;Level&#39;, &#39;Contingent&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 1, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 1, 3, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 1, 6, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 2, 1, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, 2, 3, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, 2, 5, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, 3, 2, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, 3, 4, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, 3, 5, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, 4, 7, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(11, &#39;0011&#39;, 4, 8, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(12, &#39;0012&#39;, 4, 9, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(13, &#39;0013&#39;, 5, 7, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(14, &#39;0014&#39;, 5, 8, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(15, &#39;0015&#39;, 5, 6, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(16, &#39;0016&#39;, 6, 5, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PROPERTIES(ID, BI_TEMPORAL_ID, PROPERTIES_ID, KEY_STORE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(17, &#39;0017&#39;, 7, 10, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
-- INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Refreshments-Rule&#39;, &#39;Allow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Transport-Rule&#39;, &#39;Allow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Unassigned-Rule&#39;, &#39;Allow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;BigPerks-Rule&#39;, &#39;Allow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE(ID, BI_TEMPORAL_ID, NAME, TYPE, STATE, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, &#39;Training-Rule&#39;, &#39;Disallow&#39;, &#39;Draft&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
-- INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 1, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 1, 2, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 2, 3, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 3, 4, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, 3, 5, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, 4, 6, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO RULE_PROPERTIES_MAP(ID, BI_TEMPORAL_ID, RULE_ID, PROPERTIES_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, 5, 7, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
--
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Free coffee&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Free milk&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Free sugar&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;Free car&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, &#39;Free gas&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, &#39;Free tolls&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, &#39;Fat bonus&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, &#39;Extended vacation&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, &#39;Golden parachute&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, &#39;Online courses&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(11, &#39;0011&#39;, &#39;Pluralsight subscription&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO PRIVILEGE(ID, BI_TEMPORAL_ID, PRIVILEGE_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(12, &#39;0012&#39;, &#39;Coursera subscription&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
-- INSERT INTO DUTY(ID, BI_TEMPORAL_ID, DUTY_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Refreshments&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY(ID, BI_TEMPORAL_ID, DUTY_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Transport&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY(ID, BI_TEMPORAL_ID, DUTY_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Big Perks&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY(ID, BI_TEMPORAL_ID, DUTY_NAME, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;Training&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 1, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 1, 2, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 1, 3, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 2, 4, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, 2, 5, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, 2, 6, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, 3, 7, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, 3, 8, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, 3, 9, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, 4, 10, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(11, &#39;0011&#39;, 4, 11, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(12, &#39;0012&#39;, 4, 12, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
-- INSERT INTO DUTY_RULE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, RULE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 1, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_RULE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, RULE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 2, 2, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_RULE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, RULE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 3, 4, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO DUTY_RULE_MAP(ID, BI_TEMPORAL_ID, DUTY_ID, RULE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 4, 5, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
-- INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, &#39;Nick&#39;, &#39;Singapore&#39;, &#39;T123&#39;, &#39;VP&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, &#39;Alex&#39;, &#39;Singapore&#39;, &#39;T123&#39;, &#39;MD&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, &#39;Ivan&#39;, &#39;Moscow&#39;, &#39;T999&#39;, &#39;MD&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, &#39;Andy&#39;, &#39;New-York&#39;, &#39;T111&#39;, &#39;MD&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER(ID, BI_TEMPORAL_ID, NAME, LOCATION, DEPARTMENT, LEVEL, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, &#39;Joe&#39;, &#39;Jersey City&#39;, &#39;T888&#39;, &#39;Contingent&#39;, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
--
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(1, &#39;0001&#39;, 1, 2, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(2, &#39;0002&#39;, 2, 3, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(3, &#39;0003&#39;, 3, 2, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(4, &#39;0004&#39;, 4, 1, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(5, &#39;0005&#39;, 5, 2, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(6, &#39;0006&#39;, 1, 4, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(7, &#39;0007&#39;, 1, 12, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(8, &#39;0008&#39;, 4, 5, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(9, &#39;0009&#39;, 1, 8, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(10, &#39;0010&#39;, 3, 10, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(11, &#39;0011&#39;, 5, 11, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(12, &#39;0012&#39;, 2, 7, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(13, &#39;0013&#39;, 3, 9, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)
-- INSERT INTO USER_PRIVILEGE_MAP(ID, BI_TEMPORAL_ID, USER_ID, PRIVILEGE_ID, IN_UTC, OUT_UTC, created_by, last_modified_by) VALUES(14, &#39;0014&#39;, 3, 5, CURRENT_TIMESTAMP - CURRENT_TIMEZONE, TO_DATE(&#39;9999-12-31&#39;, &#39;YYYY-MM-DD&#39;) - CURRENT_TIMEZONE, &#39;unknown&#39;, &#39;unknown&#39;)


</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.jpa.show-sql=true
spring.h2.console.enabled=true
spring.datasource.url=jdbc:h2:mem:db

spring.data.rest.defaultMediaType=application/json
spring.jackson.default-property-inclusion=NON_NULL

# Enable following 4 lines to generate DDL statements (dialect may not be required)
#spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.DB2Dialect
#spring.jpa.properties.javax.persistence.schema-generation.create-source=metadata
#spring.jpa.properties.javax.persistence.schema-generation.scripts.action=create
#spring.jpa.properties.javax.persistence.schema-generation.scripts.create-target=create.sql

#logging.level.org.springframework=debug</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">peoplesearchByGuid.url=http://peoplesearch.web.gs.com:6119/GSPeopleSearch/GSPeopleSearch?gsguid=%s&amp;StrictSearch=true&amp;lang=json
peoplesearchByKerberos.url=http://peoplesearch.web.gs.com:6119/GSPeopleSearch/GSPeopleSearch?kerberos=%s&amp;lang=json
camp-entitlements.url=https://dev.services.camp.site.gs.com:8086/api/people/entitlements/%s
camp-privileges.url=https://dev.services.camp.site.gs.com:8086/api/EntCatalog/privileges/SOURCE_SYSTEM_PRIVILEGE_ID/%s
es-privileges.url=https://dev.services.camp.site.gs.com:8086/api/es/privileges/%d

datasource.system.account.credref=d0276c30462d4e3c99d7fc2be92a8c69</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.profiles.include=ssl


spring.jpa.properties.hibernate.default_schema=SOD_TEST2
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.DB2Dialect

datasource.url=jdbc:db2://nyg13qi8-vip.ny.fw.gs.com:56834/ntrkdi02
datasource.driver-class-name=com.ibm.db2.jcc.DB2Driver</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">spring.profiles.include=ssl</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">server.http.port=8081
server.port=8443
server.ssl.key-store-type=JKS
server.ssl.key-store=classpath:sod-test.jks
server.ssl.system.account.name=sod_build_test
server.ssl.system.account.credref=9264f331180146bdb758b34369a76f95

</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><h1 id="EligibilityRulesImplementation-Controller">Controller</h1><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
@RepositoryRestController
public class DutyController
{
    @Autowired
    private DutyRepository dutyRepository;
    @Autowired
    private DutyPrivilegeMapRepository dutyPrivilegeMapRepository;
    @Autowired
    private DutyRuleMapRepository dutyRuleMapRepository;
    @Autowired
    private PrivilegeRepository privilegeRepository;

    @GetMapping(&quot;/duties&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;DutyPresentation&gt;&gt;&gt; getDuties()
    {
        List&lt;Resource&lt;DutyPresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        List&lt;Duty&gt; duties = dutyRepository.findAll();
        for(Duty duty : duties)
        {
            DutyPresentation dutyPresentation = getDutyPresentation(duty.getID());
            Resource&lt;DutyPresentation&gt; dutyPresentationResource = new Resource&lt;&gt;(dutyPresentation, createSelfLink(duty.getID()));

            addLinksToDutyPresentationResource(duty.getID(), dutyPresentationResource);

            resourceResult.add(dutyPresentationResource);
        }
        Resources&lt;Resource&lt;DutyPresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult);
        resources.add(linkTo(methodOn(getClass()).getDuties()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    // Note package visibility
    ResponseEntity&lt;Resources&lt;DutyPresentation&gt;&gt; getDutiesInternal()
    {
        List&lt;DutyPresentation&gt; dutyPresentations = new ArrayList&lt;&gt;();

        List&lt;Duty&gt; duties = dutyRepository.findAll();
        for(Duty duty : duties)
        {
            DutyPresentation dutyPresentation = getDutyPresentation(duty.getID());
            dutyPresentations.add(dutyPresentation);
        }
        Resources&lt;DutyPresentation&gt; resources = new Resources&lt;&gt;(dutyPresentations);
        resources.add(linkTo(methodOn(getClass()).getDuties()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/duties/{id}&quot;)
    public ResponseEntity&lt;Resource&lt;DutyPresentation&gt;&gt; getDuties(@PathVariable(&quot;id&quot;) int id)
    {
        DutyPresentation dutyPresentation = getDutyPresentation(id);
        Resource&lt;DutyPresentation&gt; dutyPresentationResource = getDutyPresentationResource(dutyPresentation);

        addLinksToDutyPresentationResource(id, dutyPresentationResource);

        return ResponseEntity.ok(dutyPresentationResource);
    }

    @PostMapping(&quot;/duties&quot;)
    public ResponseEntity&lt;?&gt; createDuty(@RequestBody Duty duty)
    {
        dutyRepository.save(duty);

        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .path(&quot;/{id}&quot;)
                .buildAndExpand(duty.getID()).toUri();

        return ResponseEntity.created(location).build();
    }

    @PutMapping(&quot;/duties/{id}&quot;)
    public ResponseEntity&lt;?&gt; updateDuty(@PathVariable(&quot;id&quot;) int id, @RequestBody Duty duty)
    {
        Optional&lt;Duty&gt; existingDutyOptional = dutyRepository.findById(id);
        if(!existingDutyOptional.isPresent())
        {
            throwNotFoundException(duty.getID());
        }

        Duty existingDuty = existingDutyOptional.get();
        //  Create data for audit record
        Duty auditDuty = new Duty(existingDuty);

        //  Modify existing record with new values
        if(StringUtils.hasText(duty.getDutyName()))
        {
            existingDuty.setDutyName(duty.getDutyName());
        }
        dutyRepository.save(existingDuty);


        //  Create Audit record
        dutyRepository.save(auditDuty);

        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .buildAndExpand(existingDuty).toUri();

        return ResponseEntity.created(location).build();
    }

    @DeleteMapping(&quot;/duties/{id}&quot;)
    public ResponseEntity&lt;?&gt; deleteDuty(@PathVariable(&quot;id&quot;) int id)
    {
        List&lt;DutyRulePair&gt; dutyRulePairs = dutyRuleMapRepository.findByDutyId(id);
        if(!dutyRulePairs.isEmpty())
        {
            throw new RuleViolationException(&quot;mapping to rules exists for dutyId-&quot; + id);
        }

        List&lt;DutyPrivilegePair&gt; dutyPrivilegePairs = dutyPrivilegeMapRepository.findByDutyId(id);
        if(!dutyPrivilegePairs.isEmpty())
        {
            throw new RuleViolationException(&quot;mapping to privileges exists for dutyId-&quot; + id);
        }

        Optional&lt;Duty&gt; existingDutyOptional = dutyRepository.findById(id);
        if(!existingDutyOptional.isPresent())
        {
            throwNotFoundException(id);
        }

        Duty duty = existingDutyOptional.get();
        duty.setOutUtc(ZonedDateTime.now());
        dutyRepository.save(duty);

        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .buildAndExpand().toUri();

        return ResponseEntity.created(location).build();
    }


    private Resource&lt;DutyPresentation&gt; getDutyPresentationResource(DutyPresentation dutyPresentation)
    {
        Resource&lt;DutyPresentation&gt; resource = new Resource&lt;&gt;(dutyPresentation);
        ControllerLinkBuilder link = linkTo(methodOn(getClass()).getDuties());
        resource.add(link.withRel(&quot;all&quot;));
        return resource;
    }

    private DutyPresentation getDutyPresentation(int dutyId)
    {
        Optional&lt;Duty&gt; dutyOptional = dutyRepository.findById(dutyId);
        if (!dutyOptional.isPresent())
        {
            throw new NotFoundException(&quot;Not found: id=&quot; + dutyId);
        }
        Duty duty = dutyOptional.get();
        DutyPresentation dutyPresentation = new DutyPresentation(duty, getDutyPrivileges(duty.getID()));
        dutyPresentation.add(linkTo(methodOn(getClass()).getDuties(dutyId)).withSelfRel());
        return dutyPresentation;
    }

    private List&lt;PrivilegePresentation&gt; getDutyPrivileges(int dutyId)
    {
        List&lt;PrivilegePresentation&gt; privilegePresentations = new ArrayList&lt;&gt;();

        List&lt;DutyPrivilegePair&gt; dutyPrivilegePairs = dutyPrivilegeMapRepository.findByDutyId(dutyId);
        for(DutyPrivilegePair dutyPrivilegePair : dutyPrivilegePairs)
        {
            int privilegeId = dutyPrivilegePair.getPrivilege().getID();
            Optional&lt;Privilege&gt; privilegeOptional = privilegeRepository.findById(privilegeId);
            if(!privilegeOptional.isPresent())
            {
                throw new NotFoundException(&quot;id-&quot; + privilegeId);
            }
            privilegePresentations.add(new PrivilegePresentation(privilegeOptional.get()));
        }
        return privilegePresentations;
    }

    private void addLinksToDutyPresentationResource(int id, Resource&lt;DutyPresentation&gt; dutyPresentationResource)
    {
        List&lt;DutyRulePair&gt; dutyRulePairList = dutyRuleMapRepository.findByDutyId(id);
        for(DutyRulePair dutyRulePair : dutyRulePairList)
        {
            Rule rule = dutyRulePair.getRule();
            dutyPresentationResource.add(createRuleLink(rule));
        }
        List&lt;DutyPrivilegePair&gt; dutyPrivilegePairList = dutyPrivilegeMapRepository.findByDutyId(id);
        for(DutyPrivilegePair dutyPrivilegePair : dutyPrivilegePairList)
        {
            Privilege privilege = dutyPrivilegePair.getPrivilege();
            dutyPresentationResource.add(createPrivilegeLink(privilege));
        }
    }

    //  Helper Methods
    private Link createRuleLink(Rule rule)
    {
        return linkTo(methodOn(RuleController.class).getRules(rule.getID())).withRel(&quot;rule&quot;).withTitle(rule.getName());
    }

    private Link createPrivilegeLink(Privilege privilege)
    {
        return linkTo(methodOn(PrivilegeController.class).getPrivileges(privilege.getID())).withRel(&quot;privilege&quot;).withTitle(privilege.getPrivilegeName());
    }

    private Link createSelfLink(int dutyId)
    {
        return linkTo(methodOn(getClass()).getDuties(dutyId)).withRel(&quot;self&quot;);
    }

    private void throwNotFoundException(int dutyId)
    {
        throw new NotFoundException(&quot;duty-&quot; + dutyId);
    }

}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
@RepositoryRestController
public class PrivilegeController
{
    @Autowired
    private PrivilegeRepository privilegeRepository;

    @GetMapping(&quot;/privileges&quot;)
    public ResponseEntity&lt;Resources&lt;PrivilegePresentation&gt;&gt; getPrivileges()
    {
        List&lt;PrivilegePresentation&gt; privilegePresentations = new ArrayList&lt;&gt;();

        List&lt;Privilege&gt; privileges = privilegeRepository.findAll();
        for(Privilege privilege : privileges)
        {
            PrivilegePresentation privilegePresentation = getPrivilegePresentation(privilege.getID());
            privilegePresentations.add(privilegePresentation);
        }

        Resources&lt;PrivilegePresentation&gt; resources = new Resources&lt;&gt;(privilegePresentations);
        resources.add(linkTo(methodOn(getClass()).getPrivileges()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/privileges/{id}&quot;)
    public ResponseEntity&lt;Resource&lt;PrivilegePresentation&gt;&gt; getPrivileges(@PathVariable(&quot;id&quot;) int id)
    {
        PrivilegePresentation privilegePresentation = getPrivilegePresentation(id);
        return ResponseEntity.ok(getPrivilegePresentationResource(privilegePresentation));
    }

    private PrivilegePresentation getPrivilegePresentation(int privilegeId)
    {
        Optional&lt;Privilege&gt; privilegeOptional = privilegeRepository.findById(privilegeId);
        if(!privilegeOptional.isPresent())
        {
            throw new NotFoundException(&quot;privilege-id&quot; + privilegeId);
        }

        Privilege privilege = privilegeOptional.get();
        PrivilegePresentation privilegePresentation = new PrivilegePresentation(privilege);

        return privilegePresentation;
    }

    private Resource&lt;PrivilegePresentation&gt; getPrivilegePresentationResource(PrivilegePresentation privilegePresentation)
    {
        Resource&lt;PrivilegePresentation&gt; resource = new Resource&lt;&gt;(privilegePresentation);
        ControllerLinkBuilder link = linkTo(methodOn(getClass()).getPrivileges());
        resource.add(link.withRel(&quot;all&quot;));
        return resource;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
@RepositoryRestController
public class RuleController
{
    @Autowired
    private RuleRepository ruleRepository;
    @Autowired
    private PropertiesRepository propertiesRepository;
    @Autowired
    private KeyStoreRepository keyStoreRepository;
    @Autowired
    private RulePropertiesMapRepository rulePropertiesMapRepository;

    @GetMapping(&quot;/rules&quot;)
    public ResponseEntity&lt;Resources&lt;RulePresentation&gt;&gt; getRules()
    {
        List&lt;RulePresentation&gt; rulePresentations = new ArrayList&lt;&gt;();

        List&lt;Rule&gt; rules = ruleRepository.findAll();
        for(Rule rule : rules)
        {
            RulePresentation rulePresentation = getRulePresentation(rule.getID());
            rulePresentations.add(rulePresentation);
        }
        Resources&lt;RulePresentation&gt; resources = new Resources&lt;&gt;(rulePresentations);
        resources.add(linkTo(methodOn(getClass()).getRules()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/rules/{id}&quot;)
    public ResponseEntity&lt;Resource&lt;RulePresentation&gt;&gt; getRules(@PathVariable(&quot;id&quot;) int id)
    {
        RulePresentation rulePresentation = getRulePresentation(id);
        return ResponseEntity.ok(getRulePresentationResource(rulePresentation));
    }

    private RulePresentation getRulePresentation(int ruleId)
    {
        Optional&lt;Rule&gt; ruleOptional = ruleRepository.findById(ruleId);
        if (!ruleOptional.isPresent())
        {
            throw new NotFoundException(&quot;rule-id&quot; + ruleId);
        }
        Rule rule = ruleOptional.get();
        RulePresentation rulePresentation = new RulePresentation(rule, getRuleProperties(rule.getID()));
        rulePresentation.add(linkTo(methodOn(getClass()).getRules(ruleId)).withSelfRel());
        return rulePresentation;
    }

    private Resource&lt;RulePresentation&gt; getRulePresentationResource(RulePresentation rulePresentation)
    {
        Resource&lt;RulePresentation&gt; resource = new Resource&lt;&gt;(rulePresentation);
        ControllerLinkBuilder link = linkTo(methodOn(getClass()).getRules());
        resource.add(link.withRel(&quot;all&quot;));
        return resource;
    }


    private List&lt;PropertiesPresentation&gt; getRuleProperties(int ruleId)
    {
        List&lt;PropertiesPresentation&gt; propertiesPresentations = new ArrayList&lt;&gt;();

        List&lt;RulePropertiesMap&gt; rulePropertiesMaps = rulePropertiesMapRepository.findByRuleId(ruleId);
        for(RulePropertiesMap rulePropertiesMap : rulePropertiesMaps)
        {
            int propertiesId = rulePropertiesMap.getPropertiesId();
            List&lt;Properties&gt; properties = propertiesRepository.findByPropertiesId(propertiesId);
            if(properties.isEmpty())
            {
                throw new NotFoundException(&quot;id-&quot; + propertiesId);
            }
            propertiesPresentations.add(getPropertiesPresentation(propertiesId, properties));
        }
        return propertiesPresentations;
    }

    private PropertiesPresentation getPropertiesPresentation(int propertiesId, List&lt;Properties&gt; propertiesList)
    {
        PropertiesPresentation propertiesPresentation = new PropertiesPresentation(propertiesId);
        for(Properties properties : propertiesList)
        {
            Optional&lt;KeyStore&gt; keyStoreOptional = keyStoreRepository.findById(properties.getKeyStoreId());
            if(keyStoreOptional.isPresent())
            {
                KeyStore keyStore = keyStoreOptional.get();
                propertiesPresentation.addKeyValue(keyStore.getKey(), keyStore.getValue());
            }
        }
        return propertiesPresentation;
    }

}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
@RepositoryRestController
public class UserController
{
    @Autowired
    private UserRepository userRepository;

    @GetMapping(&quot;/users&quot;)
    public ResponseEntity&lt;Resources&lt;UserPresentation&gt;&gt; getUsers()
    {
        List&lt;UserPresentation&gt; userPresentations = new ArrayList&lt;&gt;();

        List&lt;User&gt; users = userRepository.findAll();
        for(User user : users)
        {
            UserPresentation userPresentation = getUserPresentation(user.getID());
            userPresentations.add(userPresentation);
        }

        Resources&lt;UserPresentation&gt; resources = new Resources&lt;&gt;(userPresentations);
        resources.add(linkTo(methodOn(getClass()).getUsers()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/users/{id}&quot;)
    public ResponseEntity&lt;Resource&lt;UserPresentation&gt;&gt; getUsers(@PathVariable(&quot;id&quot;) int id)
    {
        UserPresentation userPresentation = getUserPresentation(id);
        return ResponseEntity.ok(getUserPresentationResource(userPresentation));
    }

    private UserPresentation getUserPresentation(int userId)
    {
        Optional&lt;User&gt; userOptional = userRepository.findById(userId);
        if(!userOptional.isPresent())
        {
            throw new NotFoundException(&quot;user-id&quot; + userId);
        }

        User user = userOptional.get();
        UserPresentation userPresentation = new UserPresentation(user);
        userPresentation.add(linkTo(methodOn(getClass()).getUsers(userId)).withSelfRel());

        return userPresentation;
    }

    private Resource&lt;UserPresentation&gt; getUserPresentationResource(UserPresentation userPresentation)
    {
        Resource&lt;UserPresentation&gt; resource = new Resource&lt;&gt;(userPresentation);
        ControllerLinkBuilder link = linkTo(methodOn(getClass()).getUsers());
        resource.add(link.withRel(&quot;all&quot;));
        return resource;
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
@RepositoryRestController
public class EligibilityController
{
    @Autowired
    private UserPrivilegeMapRepository userPrivilegeMapRepository;
    @Autowired
    private DutyPrivilegeMapRepository dutyPrivilegeMapRepository;
    @Autowired
    private DutyRuleMapRepository dutyRuleMapRepository;
    @Autowired
    private RulePropertiesMapRepository rulePropertiesMapRepository;
    @Autowired
    private PropertiesRepository propertiesRepository;
    @Autowired
    private KeyStoreRepository keyStoreRepository;
    @Autowired
    private UserRepository userRepository;
    @Autowired
    private RuleRepository ruleRepository;


    @GetMapping(&quot;/rules/users&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;RulePresentation&gt;&gt;&gt; getRulesUsers()
    {
        List&lt;Resource&lt;RulePresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        List&lt;Rule&gt; rules = ruleRepository.findAll();
        for(Rule rule : rules)
        {
            List&lt;RulePropertiesMap&gt; rulePropertiesMaps = rulePropertiesMapRepository.findByRuleId(rule.getID());

            Map&lt;String, Set&lt;String&gt;&gt; keyStoreMap = getKeyStoreMapFromRuleProperties(rulePropertiesMaps);

            List&lt;User&gt; users = getUsersForKeyStoreMap(keyStoreMap);
            if(!users.isEmpty())
            {
                RulePresentation rulePresentation = new RulePresentation(rule);
                Resource&lt;RulePresentation&gt; rulePresentationResource = new Resource&lt;&gt;(rulePresentation);
                for(User user : users)
                {
                    rulePresentationResource.add(createUserLink(user));
                }
                resourceResult.add(rulePresentationResource);
            }
        }

        Resources&lt;Resource&lt;RulePresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult);
        resources.add(linkTo(methodOn(getClass()).getRulesUsers()).withSelfRel());

        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/users/rules&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;UserPresentation&gt;&gt;&gt; getUsersRules()
    {
        List&lt;Resource&lt;UserPresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();


        List&lt;User&gt; users = userRepository.findAll();
        for(User user : users)
        {
            Optional&lt;KeyStore&gt; userByLocationOptional = keyStoreRepository.findByLocation(user.getLocation());
            Optional&lt;KeyStore&gt; userByDepartmentOptional = keyStoreRepository.findByDepartment(user.getDepartment());
            Optional&lt;KeyStore&gt; userByLevelOptional = keyStoreRepository.findByLevel(user.getLevel());

            //  Find all applicable Properties
            List&lt;Properties&gt; properties = propertiesRepository.findAll();
            Map&lt;Integer, Set&lt;Integer&gt;&gt; propertyKeyStoreMap = properties.stream()
                    .collect(Collectors
                            .groupingBy(Properties::getPropertiesId, Collectors.mapping(Properties::getKeyStoreId, Collectors.toSet())));

            List&lt;Integer&gt; matchedPropertiesList = new ArrayList&lt;&gt;();
            for(Map.Entry&lt;Integer, Set&lt;Integer&gt;&gt; e : propertyKeyStoreMap.entrySet())
            {
                int matchedCount = 0;
                for(int keyStoreId : e.getValue())
                {
                    if(keyStoreId == userByLocationOptional.orElse(new KeyStore()).getID() ||
                            keyStoreId == userByDepartmentOptional.orElse(new KeyStore()).getID() ||
                            keyStoreId == userByLevelOptional.orElse(new KeyStore()).getID())
                    {
                        matchedCount++;
                    }
                }
                if(matchedCount == e.getValue().size())
                {
                    matchedPropertiesList.add(e.getKey());
                }
            }

            //  Find Rules for matched properties
            if(!matchedPropertiesList.isEmpty())
            {
                UserPresentation userPresentation = new UserPresentation(user);
                Resource&lt;UserPresentation&gt; userPresentationResource = new Resource&lt;&gt;(userPresentation);

                for(int propertiesId : matchedPropertiesList)
                {
                    Optional&lt;RulePropertiesMap&gt; rulePropertiesMapOptional = rulePropertiesMapRepository.findByPropertiesId(propertiesId);
                    if(rulePropertiesMapOptional.isPresent())
                    {
                        Optional&lt;Rule&gt; ruleOptional = ruleRepository.findById(rulePropertiesMapOptional.get().getRuleId());
                        if(ruleOptional.isPresent())
                        {
                            userPresentationResource.add(createRuleLink(ruleOptional.get()));
                        }
                    }
                }
                userPresentationResource.add(createUserLink(user));
                resourceResult.add(userPresentationResource);
            }
        }

        Resources&lt;Resource&lt;UserPresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult);
        resources.add(linkTo(methodOn(getClass()).getUsersRules()).withSelfRel());

        return ResponseEntity.ok(resources);
    }

    @GetMapping(&quot;/users2/rules&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;UserRulePresentation&gt;&gt;&gt; getUsers2Rules()
    {
        List&lt;Resource&lt;UserRulePresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();


        List&lt;User&gt; users = userRepository.findAll();
        for(User user : users)
        {
            Optional&lt;KeyStore&gt; userByLocationOptional = keyStoreRepository.findByLocation(user.getLocation());
            Optional&lt;KeyStore&gt; userByDepartmentOptional = keyStoreRepository.findByDepartment(user.getDepartment());
            Optional&lt;KeyStore&gt; userByLevelOptional = keyStoreRepository.findByLevel(user.getLevel());

            //  Find all applicable Properties
            List&lt;Properties&gt; properties = propertiesRepository.findAll();
            Map&lt;Integer, Set&lt;Integer&gt;&gt; propertyKeyStoreMap = properties.stream()
                    .collect(Collectors
                            .groupingBy(Properties::getPropertiesId, Collectors.mapping(Properties::getKeyStoreId, Collectors.toSet())));

            List&lt;Integer&gt; matchedPropertiesList = new ArrayList&lt;&gt;();
            for(Map.Entry&lt;Integer, Set&lt;Integer&gt;&gt; e : propertyKeyStoreMap.entrySet())
            {
                int matchedCount = 0;
                for(int keyStoreId : e.getValue())
                {
                    if(keyStoreId == userByLocationOptional.orElse(new KeyStore()).getID() ||
                            keyStoreId == userByDepartmentOptional.orElse(new KeyStore()).getID() ||
                            keyStoreId == userByLevelOptional.orElse(new KeyStore()).getID())
                    {
                        matchedCount++;
                    }
                }
                if(matchedCount == e.getValue().size())
                {
                    matchedPropertiesList.add(e.getKey());
                }
            }

            //  Find Rules for matched properties
            if(!matchedPropertiesList.isEmpty())
            {
                List&lt;Rule&gt; rules = new ArrayList&lt;&gt;();
                for(int propertiesId : matchedPropertiesList)
                {
                    Optional&lt;RulePropertiesMap&gt; rulePropertiesMapOptional = rulePropertiesMapRepository.findByPropertiesId(propertiesId);
                    if(rulePropertiesMapOptional.isPresent())
                    {
                        Optional&lt;Rule&gt; ruleOptional = ruleRepository.findById(rulePropertiesMapOptional.get().getRuleId());
                        if(ruleOptional.isPresent())
                        {
                            rules.add(ruleOptional.get());
                        }
                    }
                }

                RulePresentation[] rulePresentations = rules.stream().map(RulePresentation::new).map(r -&gt; {r.add(createRuleLink(r)); return r;}).toArray(RulePresentation[]::new);


                UserRulePresentation userRulePresentation = new UserRulePresentation(user, rulePresentations);
                Resource&lt;UserRulePresentation&gt; userRulePresentationResource = new Resource&lt;&gt;(userRulePresentation);
                userRulePresentationResource.add(createUserLink(user));
                resourceResult.add(userRulePresentationResource);
            }
        }

        Resources&lt;Resource&lt;UserRulePresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult);
        resources.add(linkTo(methodOn(getClass()).getUsers2Rules()).withSelfRel());

        return ResponseEntity.ok(resources);
    }


    @GetMapping(&quot;/users/violations&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;ViolationPresentation&gt;&gt;&gt; getUsersViolations()
    {
        List&lt;UserPrivilegePair&gt; userPrivilegePairs = userPrivilegeMapRepository.findAll();
        return getViolations(userPrivilegePairs);
    }


    @GetMapping(&quot;/users/{id}/violations&quot;)
    public  ResponseEntity&lt;Resources&lt;Resource&lt;ViolationPresentation&gt;&gt;&gt;  getViolationsForUser(@PathVariable(&quot;id&quot;) int id)
    {
        List&lt;UserPrivilegePair&gt; userPrivilegePairs = userPrivilegeMapRepository.findByUserId(id);
        return getViolations(userPrivilegePairs);
    }


    private ResponseEntity&lt;Resources&lt;Resource&lt;ViolationPresentation&gt;&gt;&gt; getViolations(List&lt;UserPrivilegePair&gt; userPrivilegePairs)
    {
        List&lt;Resource&lt;ViolationPresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        for(UserPrivilegePair userPrivilegePair : userPrivilegePairs)
        {
            User user = userPrivilegePair.getUser();

            Privilege privilege = userPrivilegePair.getPrivilege();
            List&lt;DutyPrivilegePair&gt; dutyPrivilegePairs = dutyPrivilegeMapRepository.findByPrivilegeId(privilege.getID());
            for(DutyPrivilegePair dutyPrivilegePair : dutyPrivilegePairs)
            {
                Duty duty = dutyPrivilegePair.getDuty();
                List&lt;DutyRulePair&gt; dutyRulePairs = dutyRuleMapRepository.findByDutyId(duty.getID());
                for(DutyRulePair dutyRulePair : dutyRulePairs)
                {
                    Rule rule = dutyRulePair.getRule();

                    List&lt;RulePropertiesMap&gt; rulePropertiesMaps = rulePropertiesMapRepository.findByRuleId(rule.getID());
                    Map&lt;String, Set&lt;String&gt;&gt; keyStoreMap = getKeyStoreMapFromRuleProperties(rulePropertiesMaps);

                    Optional&lt;ViolationPresentation&gt; violationPresentationOptional = checkEligibility(privilege, user, rule, duty, keyStoreMap);
                    if (!violationPresentationOptional.isPresent())
                    {
                        break;
                    }
                    else
                    {
                        ViolationPresentation violationPresentation = violationPresentationOptional.get();
                        Resource&lt;ViolationPresentation&gt; violationPresentationResource = new Resource&lt;&gt;(violationPresentation,
                                createViolationsForUserLink(user.getID()),
                                createUserLink(user),
                                createRuleLink(rule),
                                createDutyLink(duty));
                        resourceResult.add(violationPresentationResource);
                    }
                }
            }
        }

        Resources&lt;Resource&lt;ViolationPresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult);
        resources.add(linkTo(methodOn(getClass()).getUsersViolations()).withSelfRel());
        return ResponseEntity.ok(resources);
    }

    private Optional&lt;ViolationPresentation&gt; checkEligibility(Privilege privilege,
                                                             User user, Rule rule, Duty duty,
                                                             Map&lt;String,Set&lt;String&gt;&gt; keyStoreMap)
    {
        boolean locationCheck = !keyStoreMap.containsKey(Constants.LOCATION) ? true : keyStoreMap.get(Constants.LOCATION).contains(user.getLocation());
        boolean departmentCheck = !keyStoreMap.containsKey(Constants.DEPARTMENT) ? true : keyStoreMap.get(Constants.DEPARTMENT).contains(user.getDepartment());
        boolean levelCheck = !keyStoreMap.containsKey(Constants.LEVEL) ? true : keyStoreMap.get(Constants.LEVEL).contains(user.getLevel());

        if(rule.getType().equals(&quot;Allow&quot;))
        {
            if(!(locationCheck &amp;&amp; departmentCheck &amp;&amp; levelCheck))
            {
                return Optional.of(new ViolationPresentation(privilege, user, rule, duty));
            }
            else
            {
                return Optional.empty();
            }
        }
        else if(rule.getType().equals(&quot;Disallow&quot;))
        {
            if(!(locationCheck &amp;&amp; departmentCheck &amp;&amp; levelCheck))
            {
                return Optional.empty();
            }
            else
            {
                return Optional.of(new ViolationPresentation(privilege, user, rule, duty));
            }
        }
        else
        {
            throw new RuntimeException(&quot;Unrecognized rule type: &quot; + rule.getType());
        }
   }

    private List&lt;User&gt; getUsersForKeyStoreMap(Map&lt;String, Set&lt;String&gt;&gt; keyStoreMap)
    {
        List&lt;User&gt; matchedUsers = new ArrayList&lt;&gt;();
        for(Map.Entry&lt;String,Set&lt;String&gt;&gt; e : keyStoreMap.entrySet())
        {
            String key = e.getKey();
            if(key.equals(Constants.LOCATION))
            {
                List&lt;User&gt; usersByLocation = new ArrayList&lt;&gt;();
                for(String value : e.getValue())
                {
                    usersByLocation.addAll(userRepository.findByLocation(value));
                }
                if(matchedUsers.isEmpty())
                {
                    matchedUsers.addAll(usersByLocation);
                }
                else
                {
                    matchedUsers.retainAll(usersByLocation);
                }
            }
            else if(key.equals(Constants.DEPARTMENT))
            {
                List&lt;User&gt; usersByDepartment = new ArrayList&lt;&gt;();
                for(String value : e.getValue())
                {
                    usersByDepartment.addAll(userRepository.findByDepartment(value));
                }
                if(matchedUsers.isEmpty())
                {
                    matchedUsers.addAll(usersByDepartment);
                }
                else
                {
                    matchedUsers.retainAll(usersByDepartment);
                }
            }
            else if(key.equals(Constants.LEVEL))
            {
                List&lt;User&gt; usersByLevel = new ArrayList&lt;&gt;();
                for(String value : e.getValue())
                {
                    usersByLevel.addAll(userRepository.findByLevel(value));
                }
                if(matchedUsers.isEmpty())
                {
                    matchedUsers.addAll(usersByLevel);
                }
                else
                {
                    matchedUsers.retainAll(usersByLevel);
                }
            }
            else
            {
                throw new RuntimeException(&quot;Unexpected attribute:&quot; + key);
            }
        }

        return matchedUsers;
    }

    private Map&lt;String, Set&lt;String&gt;&gt; getKeyStoreMapFromRuleProperties(List&lt;RulePropertiesMap&gt; rulePropertiesMaps)
    {
        Map&lt;String, Set&lt;String&gt;&gt; keyStoreMap = new HashMap&lt;&gt;();

        for (RulePropertiesMap rulePropertiesMap : rulePropertiesMaps)
        {
            List&lt;Properties&gt; propertiesList = propertiesRepository.findByPropertiesId(rulePropertiesMap.getPropertiesId());
            for (Properties properties : propertiesList)
            {
                Optional&lt;KeyStore&gt; keyStoreOptional = keyStoreRepository.findById(properties.getKeyStoreId());
                if (keyStoreOptional.isPresent())
                {
                    KeyStore keyStore = keyStoreOptional.get();
                    keyStoreMap.computeIfAbsent(keyStore.getKey(), a -&gt; new HashSet&lt;&gt;()).add(keyStore.getValue());
                }
            }
        }
        return keyStoreMap;
    }



    //  Helper methods
    private Link createUserLink(User user)
    {
        return linkTo(methodOn(UserController.class).getUsers(user.getID())).withRel(&quot;user&quot;).withTitle(user.getName());
    }

    private Link createRuleLink(Rule rule)
    {
        return linkTo(methodOn(RuleController.class).getRules(rule.getID())).withRel(&quot;rule&quot;).withTitle(rule.getName());
    }

    private Link createRuleLink(RulePresentation rulePresentation)
    {
        return linkTo(methodOn(RuleController.class).getRules(rulePresentation.getID())).withRel(&quot;rule&quot;);
    }

    private Link createDutyLink(Duty duty)
    {
        return linkTo(methodOn(DutyController.class).getDuties(duty.getID())).withRel(&quot;duty&quot;).withTitle(duty.getDutyName());
    }

    private Link createViolationsForUserLink(int userId)
    {
        return linkTo(methodOn(getClass()).getViolationsForUser(userId)).withSelfRel();
    }
}


</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
@RepositoryRestController
public class DutyRuleController
{
    @Autowired
    private DutyRuleMapRepository dutyRuleMapRepository;
    @Autowired
    private RuleRepository ruleRepository;
    @Autowired
    private DutyRepository dutyRepository;
    @Autowired
    private DutyController dutyController;
    @Autowired
    private RuleController ruleController;


    //  -------------------------------------------
    //  ------------ Duties With Rules ------------
    //  -------------------------------------------
    @LogInputOutput
    @GetMapping(&quot;/duties/rules&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;DutyPresentation&gt;&gt;&gt; getDutiesRules()
    {
        List&lt;Resource&lt;DutyPresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        ResponseEntity&lt;Resources&lt;DutyPresentation&gt;&gt; dutyPresentationResources = dutyController.getDutiesInternal();
        Map&lt;Integer, List&lt;DutyPresentation&gt;&gt; dutyPresentationResourcesMap = dutyPresentationResources.getBody().getContent().stream()
                .collect(Collectors.groupingBy(DutyPresentation::getID));

        List&lt;DutyRulePair&gt; dutyRulePairList = dutyRuleMapRepository.findAll();
        Map&lt;Duty, List&lt;Rule&gt;&gt; groupedDuties = dutyRulePairList.stream()
                .collect(Collectors
                        .groupingBy(d -&gt; d.getDuty(), Collectors.mapping(DutyRulePair::getRule, Collectors.toList())));

        for(Map.Entry&lt;Duty, List&lt;Rule&gt;&gt; e : groupedDuties.entrySet())
        {
            Duty duty = e.getKey();
            List&lt;DutyPresentation&gt; dutyPresentations = dutyPresentationResourcesMap.get(duty.getID());
            if(!dutyPresentations.isEmpty())
            {
                DutyPresentation dutyPresentation = dutyPresentations.get(0);
                Resource&lt;DutyPresentation&gt; dutyResource = new Resource&lt;&gt;(dutyPresentation, createDutyLink(duty));
                dutyResource.add(createRulesForDutyLink(duty.getID()));
                for(Rule rule : e.getValue())
                {
                    dutyResource.add(createRuleLink(rule));
                }
                resourceResult.add(dutyResource);
            }
        }

        Resources&lt;Resource&lt;DutyPresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getDutiesRules()).withSelfRel());
        return ResponseEntity.ok(resources);
    }


    @GetMapping(&quot;/duties/{id}/rules&quot;)
    public  ResponseEntity&lt;Resource&lt;DutyPresentation&gt;&gt;  getRulesForDuty(@PathVariable(&quot;id&quot;) int id)
    {
        List&lt;DutyRulePair&gt; dutyRulePairList = dutyRuleMapRepository.findByDutyId(id);

        if(dutyRulePairList.isEmpty())
        {
            throw new NotFoundException(&quot;dutyId-&quot; + id);
        }

        Duty duty = dutyRulePairList.get(0).getDuty();

        ResponseEntity&lt;Resource&lt;DutyPresentation&gt;&gt; dutyPresentationResource = dutyController.getDuties(duty.getID());
        DutyPresentation dutyPresentation = dutyPresentationResource.getBody().getContent();

        Resource&lt;DutyPresentation&gt; dutyResource = new Resource&lt;&gt;(dutyPresentation, createDutyLink(duty));

        List&lt;Rule&gt; rules = dutyRulePairList.stream().map(e -&gt; e.getRule()).collect(Collectors.toList());

        for(Rule rule : rules)
        {
            dutyResource.add(createRuleLink(rule));
        }
        dutyResource.add(linkTo(methodOn(getClass()).getRulesForDuty(id)).withSelfRel());
        return ResponseEntity.ok(dutyResource);
    }

    @PostMapping(&quot;/duties/{dutyId}/rules/{ruleId}&quot;)
    public ResponseEntity&lt;?&gt; addRuleToDuty(@PathVariable(&quot;dutyId&quot;) int dutyId, @PathVariable(&quot;ruleId&quot;) int ruleId)
    {
        //  Check if the association was previously deleted
        List&lt;DutyRulePair&gt; dutyRulePairList = dutyRuleMapRepository.findHistoryByRuleDutyId(ruleId, dutyId);
        if(!dutyRulePairList.isEmpty())
        {
            Optional&lt;DutyRulePair&gt; dutyRulePairOptional = dutyRulePairList.stream()
                    .sorted((m1, m2) -&gt; Long.compare(m2.getOutUtc().toInstant().toEpochMilli(), m1.getOutUtc().toInstant().toEpochMilli()))
                    .findFirst();

            if(dutyRulePairOptional.isPresent())
            {
                DutyRulePair dutyRulePairHistorical = dutyRulePairOptional.get();

                DutyRulePair dutyRulePair = new DutyRulePair(dutyRulePairHistorical.getDuty(), dutyRulePairHistorical.getRule());

                dutyRuleMapRepository.save(dutyRulePair);

                URI location = ServletUriComponentsBuilder
                        .fromCurrentRequest()
                        .buildAndExpand(dutyRulePair.getDuty().getID(), dutyRulePair.getRule().getID())
                        .toUri();
                return ResponseEntity.created(location).build();
            }
            return ResponseEntity.unprocessableEntity().build();
        }
        else
        {
            Optional&lt;Rule&gt; ruleOptional = ruleRepository.findById(ruleId);
            if (!ruleOptional.isPresent())
            {
                throw new NotFoundException(&quot;rule-&quot; + ruleId);
            }
            Optional&lt;Duty&gt; dutyOptional = dutyRepository.findById(dutyId);
            if (!dutyOptional.isPresent())
            {
                throw new NotFoundException(&quot;duty-&quot; + dutyId);
            }

            Duty duty = dutyOptional.get();
            Rule rule = ruleOptional.get();

            List&lt;Rule&gt; rules = duty.getDutyRulePair().stream().map(e -&gt; e.getRule()).collect(Collectors.toList());
            if (!rules.contains(rule))
            {
                DutyRulePair dutyRulePair = new DutyRulePair(duty, rule);
                duty.addDutyRuleMap(dutyRulePair);

                dutyRuleMapRepository.save(dutyRulePair);

                URI location = ServletUriComponentsBuilder
                        .fromCurrentRequest()
                        .buildAndExpand(duty.getID(), rule.getID())
                        .toUri();
                return ResponseEntity.created(location).build();
            }
            return ResponseEntity.unprocessableEntity().build();
        }
    }

    @DeleteMapping(&quot;/duties/{dutyId}/rules/{ruleId}&quot;)
    public ResponseEntity&lt;?&gt; deleteRuleFromDuty(@PathVariable(&quot;dutyId&quot;) int dutyId, @PathVariable(&quot;ruleId&quot;) int ruleId)
    {
        Optional&lt;DutyRulePair&gt; dutyRulePairOptional = dutyRuleMapRepository.findByRuleDutyId(ruleId, dutyId);
        if(!dutyRulePairOptional.isPresent())
        {
            throw new NotFoundException(&quot;ruleId-&quot; + ruleId + &quot;, dutyId-&quot; + dutyId);
        }

        Optional&lt;Rule&gt; ruleOptional = ruleRepository.findById(ruleId);
        Optional&lt;Duty&gt; dutyOptional = dutyRepository.findById(dutyId);

        if(!ruleOptional.isPresent())
        {
            throw new NotFoundException(&quot;ruleId-&quot; + ruleId);
        }
        if(!dutyOptional.isPresent())
        {
            throw new NotFoundException(&quot;dutyId-&quot; + dutyId);
        }

        Duty duty = dutyOptional.get();
        DutyRulePair dutyRulePair = dutyRulePairOptional.get();
        duty.removeDutyRuleMap(dutyRulePair);

        dutyRulePair.setOutUtc(ZonedDateTime.now());
        dutyRuleMapRepository.save(dutyRulePair);

        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .buildAndExpand(dutyRulePair).toUri();

        return ResponseEntity.created(location).build();
    }

    //  -------------------------------------------
    //  ------------ Rules With Duties ------------
    //  -------------------------------------------
    @LogInputOutput
    @GetMapping(&quot;/rules/duties&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;RulePresentation&gt;&gt;&gt; getRulesDuties()
    {
        List&lt;Resource&lt;RulePresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        ResponseEntity&lt;Resources&lt;RulePresentation&gt;&gt; rulePresentationResources = ruleController.getRules();
        Map&lt;Integer, List&lt;RulePresentation&gt;&gt; rulePresentationResourcesMap = rulePresentationResources.getBody().getContent().stream()
                .collect(Collectors.groupingBy(RulePresentation::getID));

        List&lt;DutyRulePair&gt; dutyRulePairList = dutyRuleMapRepository.findAll();
        Map&lt;Rule, List&lt;Duty&gt;&gt; groupedRules = dutyRulePairList.stream()
                .collect(Collectors
                        .groupingBy(d -&gt; d.getRule(), Collectors.mapping(DutyRulePair::getDuty, Collectors.toList())));

        for(Map.Entry&lt;Rule, List&lt;Duty&gt;&gt; e : groupedRules.entrySet())
        {
            Rule rule = e.getKey();
            List&lt;RulePresentation&gt; rulePresentations = rulePresentationResourcesMap.get(rule.getID());
            if(!rulePresentations.isEmpty())
            {
                RulePresentation rulePresentation = rulePresentations.get(0);
                Resource&lt;RulePresentation&gt; ruleResource = new Resource&lt;&gt;(rulePresentation, createRuleLink(rule));
                ruleResource.add(createDutiesForRuleLink(rule.getID()));
                for(Duty duty : e.getValue())
                {
                    ruleResource.add(createDutyLink(duty));
                }
                resourceResult.add(ruleResource);           }
        }

        Resources&lt;Resource&lt;RulePresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getRulesDuties()).withSelfRel());
        return ResponseEntity.ok(resources);
    }


    @GetMapping(&quot;/rules/{id}/duties&quot;)
    public  ResponseEntity&lt;Resource&lt;RulePresentation&gt;&gt;  getDutiesForRule(@PathVariable(&quot;id&quot;) int id)
    {
        List&lt;DutyRulePair&gt; dutyRulePairList = dutyRuleMapRepository.findByRuleId(id);

        if(dutyRulePairList.isEmpty())
        {
            throw new NotFoundException(&quot;ruleId-&quot; + id);
        }

        Rule rule = dutyRulePairList.get(0).getRule();

        ResponseEntity&lt;Resource&lt;RulePresentation&gt;&gt; rulePresentationResource = ruleController.getRules(rule.getID());
        RulePresentation rulePresentation = rulePresentationResource.getBody().getContent();

        Resource&lt;RulePresentation&gt; ruleResource = new Resource&lt;&gt;(rulePresentation, createRuleLink(rule));

        List&lt;Duty&gt; duties = dutyRulePairList.stream().map(e -&gt; e.getDuty()).collect(Collectors.toList());

        for(Duty duty : duties)
        {
            ruleResource.add(createDutyLink(duty));
        }
        ruleResource.add(linkTo(methodOn(getClass()).getDutiesForRule(id)).withSelfRel());
        return ResponseEntity.ok(ruleResource);
    }

    @PostMapping(&quot;/rules/{ruleId}/duties/{dutyId}&quot;)
    public ResponseEntity&lt;?&gt; addDutyToRule(@PathVariable(&quot;ruleId&quot;) int ruleId, @PathVariable(&quot;dutyId&quot;) int dutyId)
    {
        //  Check if the association was previously deleted
        List&lt;DutyRulePair&gt; dutyRulePairList = dutyRuleMapRepository.findHistoryByRuleDutyId(ruleId, dutyId);
        if(!dutyRulePairList.isEmpty())
        {
            Optional&lt;DutyRulePair&gt; dutyRulePairOptional = dutyRulePairList.stream()
                    .sorted((m1, m2) -&gt; Long.compare(m2.getOutUtc().toInstant().toEpochMilli(),m1.getOutUtc().toInstant().toEpochMilli()))
                    .findFirst();

            if(dutyRulePairOptional.isPresent())
            {
                DutyRulePair dutyRulePairHistorical = dutyRulePairOptional.get();

                DutyRulePair dutyRulePair = new DutyRulePair(dutyRulePairHistorical.getDuty(), dutyRulePairHistorical.getRule());

                dutyRuleMapRepository.save(dutyRulePair);

                URI location = ServletUriComponentsBuilder
                        .fromCurrentRequest()
                        .buildAndExpand(dutyRulePair.getRule().getID(), dutyRulePair.getDuty().getID())
                        .toUri();
                return ResponseEntity.created(location).build();
            }
            return ResponseEntity.unprocessableEntity().build();
        }
        else
        {
            Optional&lt;Rule&gt; ruleOptional = ruleRepository.findById(ruleId);
            if(!ruleOptional.isPresent())
            {
                throw new NotFoundException(&quot;rule-&quot; + ruleId);
            }
            Optional&lt;Duty&gt; dutyOptional = dutyRepository.findById(dutyId);
            if(!dutyOptional.isPresent())
            {
                throw new NotFoundException(&quot;duty-&quot; + dutyId);
            }

            Duty duty = dutyOptional.get();
            Rule rule = ruleOptional.get();

            List&lt;Duty&gt; duties = rule.getDutyRulePair().stream().map(e -&gt; e.getDuty()).collect(Collectors.toList());
            if(!duties.contains(duty))
            {
                DutyRulePair dutyRulePair = new DutyRulePair(duty, rule);
                rule.addDutyRuleMap(dutyRulePair);

                dutyRuleMapRepository.save(dutyRulePair);

                URI location = ServletUriComponentsBuilder
                        .fromCurrentRequest()
                        .buildAndExpand(rule.getID(), duty.getID())
                        .toUri();
                return ResponseEntity.created(location).build();
            }

            return ResponseEntity.unprocessableEntity().build();
        }
    }

    @DeleteMapping(&quot;/rules/{ruleId}/duties/{dutyId}&quot;)
    public ResponseEntity&lt;?&gt; deleteDutyFromRule(@PathVariable(&quot;ruleId&quot;) int ruleId, @PathVariable(&quot;dutyId&quot;) int dutyId)
    {
        Optional&lt;DutyRulePair&gt; dutyRulePairOptional = dutyRuleMapRepository.findByRuleDutyId(ruleId, dutyId);
        if(!dutyRulePairOptional.isPresent())
        {
            throw new NotFoundException(&quot;ruleId-&quot; + ruleId + &quot;, dutyId-&quot; + dutyId);
        }

        Optional&lt;Rule&gt; ruleOptional = ruleRepository.findById(ruleId);
        Optional&lt;Duty&gt; dutyOptional = dutyRepository.findById(dutyId);

        if(!ruleOptional.isPresent())
        {
            throw new NotFoundException(&quot;ruleId-&quot; + ruleId);
        }
        if(!dutyOptional.isPresent())
        {
            throw new NotFoundException(&quot;dutyId-&quot; + dutyId);
        }

        Rule rule = ruleOptional.get();
        DutyRulePair dutyRulePair = dutyRulePairOptional.get();
        rule.removeDutyRuleMap(dutyRulePair);

        dutyRulePair.setOutUtc(ZonedDateTime.now());
        dutyRuleMapRepository.save(dutyRulePair);

        URI location = ServletUriComponentsBuilder
                .fromCurrentRequest()
                .buildAndExpand().toUri();

        return ResponseEntity.created(location).build();
    }
    //  Helper methods
    private Link createDutyLink(Duty duty)
    {
        return linkTo(methodOn(DutyController.class).getDuties(duty.getID())).withRel(&quot;duty&quot;).withTitle(duty.getDutyName());
    }

    private Link createRuleLink(Rule rule)
    {
        return linkTo(methodOn(RuleController.class).getRules(rule.getID())).withRel(&quot;rule&quot;).withTitle(rule.getName());
    }

    private Link createRulesForDutyLink(int dutyId)
    {
        return linkTo(methodOn(getClass()).getRulesForDuty(dutyId)).withSelfRel();
    }

    private Link createDutiesForRuleLink(int ruleId)
    {
        return linkTo(methodOn(getClass()).getDutiesForRule(ruleId)).withSelfRel();
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
@RepositoryRestController
public class DutyPrivilegeController
{
    @Autowired
    private DutyPrivilegeMapRepository dutyPrivilegeMapRepository;
    @Autowired
    private DutyController dutyController;
    @Autowired
    private PrivilegeController privilegeController;

    //  -------------------------------------------
    //  ------------ Duties With Privileges ------------
    //  -------------------------------------------
    @GetMapping(&quot;/duties/privileges&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;DutyPresentation&gt;&gt;&gt; getDutiesPrivileges()
    {
        List&lt;Resource&lt;DutyPresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        ResponseEntity&lt;Resources&lt;DutyPresentation&gt;&gt; dutyPresentationResources = dutyController.getDutiesInternal();
        Map&lt;Integer, List&lt;DutyPresentation&gt;&gt; dutyPresentationResourcesMap = dutyPresentationResources.getBody().getContent().stream()
                .collect(Collectors.groupingBy(DutyPresentation::getID));

        List&lt;DutyPrivilegePair&gt; dutyPrivilegePairList = dutyPrivilegeMapRepository.findAll();
        Map&lt;Duty, List&lt;Privilege&gt;&gt; groupedDuties = dutyPrivilegePairList.stream()
                .collect(Collectors
                        .groupingBy(d -&gt; d.getDuty(), Collectors.mapping(DutyPrivilegePair::getPrivilege, Collectors.toList())));

        for(Map.Entry&lt;Duty, List&lt;Privilege&gt;&gt; e : groupedDuties.entrySet())
        {
            Duty duty = e.getKey();
            List&lt;DutyPresentation&gt; dutyPresentations = dutyPresentationResourcesMap.get(duty.getID());
            if(!dutyPresentations.isEmpty())
            {
                DutyPresentation dutyPresentation = dutyPresentations.get(0);
                Resource&lt;DutyPresentation&gt; dutyResource = new Resource&lt;&gt;(dutyPresentation, createDutyLink(duty));
                dutyResource.add(createPrivilegesForDutyLink(duty.getID()));
                for(Privilege privilege : e.getValue())
                {
                    dutyResource.add(createPrivilegeLink(privilege));
                }
                resourceResult.add(dutyResource);
            }
        }

        Resources&lt;Resource&lt;DutyPresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getDutiesPrivileges()).withSelfRel());
        return ResponseEntity.ok(resources);
    }


    @GetMapping(&quot;/duties/{id}/privileges&quot;)
    public  ResponseEntity&lt;Resource&lt;DutyPresentation&gt;&gt;  getPrivilegesForDuty(@PathVariable(&quot;id&quot;) int id)
    {
        List&lt;DutyPrivilegePair&gt; dutyPrivilegePairList = dutyPrivilegeMapRepository.findByDutyId(id);

        if(dutyPrivilegePairList.isEmpty())
        {
            throw new NotFoundException(&quot;dutyId-&quot; + id);
        }

        Duty duty = dutyPrivilegePairList.get(0).getDuty();

        ResponseEntity&lt;Resource&lt;DutyPresentation&gt;&gt; dutyPresentationResource = dutyController.getDuties(duty.getID());
        DutyPresentation dutyPresentation = dutyPresentationResource.getBody().getContent();

        Resource&lt;DutyPresentation&gt; dutyResource = new Resource&lt;&gt;(dutyPresentation, createDutyLink(duty));

        List&lt;Privilege&gt; privileges = dutyPrivilegePairList.stream().map(e -&gt; e.getPrivilege()).collect(Collectors.toList());

        for(Privilege privilege : privileges)
        {
            dutyResource.add(createPrivilegeLink(privilege));
        }
        dutyResource.add(linkTo(methodOn(getClass()).getPrivilegesForDuty(id)).withSelfRel());
        return ResponseEntity.ok(dutyResource);
    }


    //  -------------------------------------------
    //  ------------ Privileges With Duties ------------
    //  -------------------------------------------
    @GetMapping(&quot;/privileges/duties&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;PrivilegePresentation&gt;&gt;&gt; getPrivilegesDuties()
    {
        List&lt;Resource&lt;PrivilegePresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        ResponseEntity&lt;Resources&lt;PrivilegePresentation&gt;&gt; privilegePresentationResources = privilegeController.getPrivileges();
        Map&lt;Integer, List&lt;PrivilegePresentation&gt;&gt; privilegePresentationResourcesMap = privilegePresentationResources.getBody().getContent().stream()
                .collect(Collectors.groupingBy(PrivilegePresentation::getID));

        List&lt;DutyPrivilegePair&gt; dutyPrivilegePairList = dutyPrivilegeMapRepository.findAll();
        Map&lt;Privilege, List&lt;Duty&gt;&gt; groupedPrivileges = dutyPrivilegePairList.stream()
                .collect(Collectors
                        .groupingBy(d -&gt; d.getPrivilege(), Collectors.mapping(DutyPrivilegePair::getDuty, Collectors.toList())));

        for(Map.Entry&lt;Privilege, List&lt;Duty&gt;&gt; e : groupedPrivileges.entrySet())
        {
            Privilege privilege = e.getKey();
            List&lt;PrivilegePresentation&gt; privilegePresentations = privilegePresentationResourcesMap.get(privilege.getID());
            if(!privilegePresentations.isEmpty())
            {
                PrivilegePresentation privilegePresentation = privilegePresentations.get(0);
                Resource&lt;PrivilegePresentation&gt; privilegeResource = new Resource&lt;&gt;(privilegePresentation, createPrivilegeLink(privilege));
                privilegeResource.add(createDutiesForPrivilegeLink(privilege.getID()));
                for(Duty duty : e.getValue())
                {
                    privilegeResource.add(createDutyLink(duty));
                }
                resourceResult.add(privilegeResource);
            }
        }

        Resources&lt;Resource&lt;PrivilegePresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getPrivilegesDuties()).withSelfRel());
        return ResponseEntity.ok(resources);
    }



    @GetMapping(&quot;/privileges/{id}/duties&quot;)
    public  ResponseEntity&lt;Resource&lt;PrivilegePresentation&gt;&gt;  getDutiesForPrivilege(@PathVariable(&quot;id&quot;) int id)
    {
        List&lt;DutyPrivilegePair&gt; dutyPrivilegePairList = dutyPrivilegeMapRepository.findByPrivilegeId(id);

        if(dutyPrivilegePairList.isEmpty())
        {
            throw new NotFoundException(&quot;privilegeId-&quot; + id);
        }

        Privilege privilege = dutyPrivilegePairList.get(0).getPrivilege();

        ResponseEntity&lt;Resource&lt;PrivilegePresentation&gt;&gt; privilegePresentationResource = privilegeController.getPrivileges(privilege.getID());
        PrivilegePresentation privilegePresentation = privilegePresentationResource.getBody().getContent();

        Resource&lt;PrivilegePresentation&gt; privilegeResource = new Resource&lt;&gt;(privilegePresentation, createPrivilegeLink(privilege));

        List&lt;Duty&gt; duties = dutyPrivilegePairList.stream().map(e -&gt; e.getDuty()).collect(Collectors.toList());

        for(Duty duty : duties)
        {
            privilegeResource.add(createDutyLink(duty));
        }
        privilegeResource.add(linkTo(methodOn(getClass()).getDutiesForPrivilege(id)).withSelfRel());
        return ResponseEntity.ok(privilegeResource);
    }


    //  Helper methods
    private Link createDutyLink(Duty duty)
    {
        return linkTo(methodOn(DutyController.class).getDuties(duty.getID())).withRel(&quot;duty&quot;).withTitle(duty.getDutyName());
    }

    private Link createPrivilegeLink(Privilege privilege)
    {
        return linkTo(methodOn(PrivilegeController.class).getPrivileges(privilege.getID())).withRel(&quot;privilege&quot;).withTitle(privilege.getPrivilegeName());
    }

    private Link createPrivilegesForDutyLink(int dutyId)
    {
        return linkTo(methodOn(getClass()).getPrivilegesForDuty(dutyId)).withSelfRel();
    }

    private Link createDutiesForPrivilegeLink(int privilegeId)
    {
        return linkTo(methodOn(getClass()).getDutiesForPrivilege(privilegeId)).withSelfRel();
    }
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Transactional
@RestController
@RepositoryRestController
public class UserPrivilegeController
{
    @Autowired
    private UserPrivilegeMapRepository userPrivilegeMapRepository;
    @Autowired
    private UserController userController;
    @Autowired
    private PrivilegeController privilegeController;

    //  -------------------------------------------
    //  ---------- Users With Privileges ----------
    //  -------------------------------------------
    @GetMapping(&quot;/users/privileges&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;UserPresentation&gt;&gt;&gt; getUsersPrivileges()
    {
        List&lt;Resource&lt;UserPresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        ResponseEntity&lt;Resources&lt;UserPresentation&gt;&gt; userPresentationResources = userController.getUsers();
        Map&lt;Integer, List&lt;UserPresentation&gt;&gt; userPresentationResourcesMap = userPresentationResources.getBody().getContent().stream()
                .collect(Collectors.groupingBy(UserPresentation::getID));

        List&lt;UserPrivilegePair&gt; userPrivilegePairList = userPrivilegeMapRepository.findAll();
        Map&lt;User, List&lt;Privilege&gt;&gt; groupedUsers = userPrivilegePairList.stream()
                .collect(Collectors
                        .groupingBy(u -&gt; u.getUser(), Collectors.mapping(UserPrivilegePair::getPrivilege, Collectors.toList())));

        for(Map.Entry&lt;User, List&lt;Privilege&gt;&gt; e : groupedUsers.entrySet())
        {
            User user = e.getKey();
            List&lt;UserPresentation&gt; userPresentations = userPresentationResourcesMap.get(user.getID());
            if(!userPresentations.isEmpty())
            {
                UserPresentation userPresentation = userPresentations.get(0);
                Resource&lt;UserPresentation&gt; userResource = new Resource&lt;&gt;(userPresentation, createUserLink(user));
                userResource.add(createPrivilegesForUserLink(user.getID()));
                for(Privilege privilege : e.getValue())
                {
                    userResource.add(createPrivilegeLink(privilege));
                }
                resourceResult.add(userResource);
            }
        }

        Resources&lt;Resource&lt;UserPresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getUsersPrivileges()).withSelfRel());
        return ResponseEntity.ok(resources);
    }


    @GetMapping(&quot;/users/{id}/privileges&quot;)
    public ResponseEntity&lt;Resource&lt;UserPresentation&gt;&gt;  getPrivilegesForUser(@PathVariable(&quot;id&quot;) int id)
    {
        List&lt;UserPrivilegePair&gt; userPrivilegePairList = userPrivilegeMapRepository.findByUserId(id);

        if(userPrivilegePairList.isEmpty())
        {
            throw new NotFoundException(&quot;userId-&quot; + id);
        }

        User user = userPrivilegePairList.get(0).getUser();

        ResponseEntity&lt;Resource&lt;UserPresentation&gt;&gt; userPresentationResource = userController.getUsers(user.getID());
        UserPresentation userPresentation = userPresentationResource.getBody().getContent();

        Resource&lt;UserPresentation&gt; userResource = new Resource&lt;&gt;(userPresentation, createUserLink(user));

        List&lt;Privilege&gt; privileges = userPrivilegePairList.stream().map(e -&gt; e.getPrivilege()).collect(Collectors.toList());

        for(Privilege privilege : privileges)
        {
            userResource.add(createPrivilegeLink(privilege));
        }
        userResource.add(linkTo(methodOn(getClass()).getPrivilegesForUser(id)).withSelfRel());
        return ResponseEntity.ok(userResource);
    }


    //  -------------------------------------------
    //  ---------- Privileges With Users ----------
    //  -------------------------------------------
    @GetMapping(&quot;/privileges/users&quot;)
    public ResponseEntity&lt;Resources&lt;Resource&lt;PrivilegePresentation&gt;&gt;&gt; getPrivilegesUsers()
    {
        List&lt;Resource&lt;PrivilegePresentation&gt;&gt; resourceResult = new ArrayList&lt;&gt;();

        ResponseEntity&lt;Resources&lt;PrivilegePresentation&gt;&gt; privilegePresentationResources = privilegeController.getPrivileges();
        Map&lt;Integer, List&lt;PrivilegePresentation&gt;&gt; privilegePresentationResourcesMap = privilegePresentationResources.getBody().getContent().stream()
                .collect(Collectors.groupingBy(PrivilegePresentation::getID));

        List&lt;UserPrivilegePair&gt; userPrivilegePairList = userPrivilegeMapRepository.findAll();
        Map&lt;Privilege, List&lt;User&gt;&gt; groupedPrivileges = userPrivilegePairList.stream()
                .collect(Collectors
                        .groupingBy(d -&gt; d.getPrivilege(), Collectors.mapping(UserPrivilegePair::getUser, Collectors.toList())));

        for(Map.Entry&lt;Privilege, List&lt;User&gt;&gt; e : groupedPrivileges.entrySet())
        {
            Privilege privilege = e.getKey();
            List&lt;PrivilegePresentation&gt; privilegePresentations = privilegePresentationResourcesMap.get(privilege.getID());
            if(!privilegePresentations.isEmpty())
            {
                PrivilegePresentation privilegePresentation = privilegePresentations.get(0);
                Resource&lt;PrivilegePresentation&gt; privilegeResource = new Resource&lt;&gt;(privilegePresentation, createPrivilegeLink(privilege));
                privilegeResource.add(createUsersForPrivilegeLink(privilege.getID()));
                for(User user : e.getValue())
                {
                    privilegeResource.add(createUserLink(user));
                }
                resourceResult.add(privilegeResource);
            }
        }

        Resources&lt;Resource&lt;PrivilegePresentation&gt;&gt; resources = new Resources&lt;&gt;(resourceResult, linkTo(methodOn(getClass()).getPrivilegesUsers()).withSelfRel());
        return ResponseEntity.ok(resources);
    }



    @GetMapping(&quot;/privileges/{id}/users&quot;)
    public ResponseEntity&lt;Resource&lt;PrivilegePresentation&gt;&gt;  getUsersForPrivilege(@PathVariable(&quot;id&quot;) int id)
    {
        List&lt;UserPrivilegePair&gt; userPrivilegePairList = userPrivilegeMapRepository.findByPrivilegeId(id);

        if(userPrivilegePairList.isEmpty())
        {
            throw new NotFoundException(&quot;privilegeId-&quot; + id);
        }

        Privilege privilege = userPrivilegePairList.get(0).getPrivilege();

        ResponseEntity&lt;Resource&lt;PrivilegePresentation&gt;&gt; privilegePresentationResource = privilegeController.getPrivileges(privilege.getID());
        PrivilegePresentation privilegePresentation = privilegePresentationResource.getBody().getContent();

        Resource&lt;PrivilegePresentation&gt; privilegeResource = new Resource&lt;&gt;(privilegePresentation, createPrivilegeLink(privilege));

        List&lt;User&gt; users = userPrivilegePairList.stream().map(e -&gt; e.getUser()).collect(Collectors.toList());

        for(User user : users)
        {
            privilegeResource.add(createUserLink(user));
        }
        privilegeResource.add(linkTo(methodOn(getClass()).getUsersForPrivilege(id)).withSelfRel());
        return ResponseEntity.ok(privilegeResource);
    }


    //  Helper methods
    private Link createUserLink(User user)
    {
        return linkTo(methodOn(UserController.class).getUsers(user.getID())).withRel(&quot;user&quot;).withTitle(user.getName());
    }

    private Link createPrivilegeLink(Privilege privilege)
    {
        return linkTo(methodOn(PrivilegeController.class).getPrivileges(privilege.getID())).withRel(&quot;privilege&quot;).withTitle(privilege.getPrivilegeName());
    }

    private Link createPrivilegesForUserLink(int userId)
    {
        return linkTo(methodOn(getClass()).getPrivilegesForUser(userId)).withSelfRel();
    }

    private Link createUsersForPrivilegeLink(int privilegeId)
    {
        return linkTo(methodOn(getClass()).getUsersForPrivilege(privilegeId)).withSelfRel();
    }
}</pre>
</div></div></td></tr></tbody></table></div><h1 id="EligibilityRulesImplementation-AspectsforLogger">Aspects for Logger</h1><p>Add logging cross-cutting capabilities</p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Aspect
@Configuration
public class AspectLogger
{
    private Logger logger = LoggerFactory.getLogger(getClass());

    @Around(&quot;@annotation(com.springboot.eligibility.eligibilityrules.aspect.annotations.TrackTime)&quot;)
    public Object trackTime(ProceedingJoinPoint joinPoint) throws Throwable
    {
        long startTime = System.currentTimeMillis();
        Object returnValue = joinPoint.proceed();
        long endTime = System.currentTimeMillis();
        logger.info(&quot;Time taken by {} is {} ms&quot;, joinPoint, endTime - startTime);
        return returnValue;
    }

    @Around(&quot;@annotation(com.springboot.eligibility.eligibilityrules.aspect.annotations.LogInputOutput)&quot;)
    public Object logInputOutput(ProceedingJoinPoint joinPoint) throws Throwable
    {
        Signature signature = joinPoint.getSignature();
        logger.info(signature.getName() + &quot; Arguments: &quot; + Arrays.toString(joinPoint.getArgs()));
        Object returnValue = joinPoint.proceed();
        logger.info(signature.getName() + &quot; Return value: &quot; + returnValue);
        return returnValue;
    }
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="EligibilityRulesImplementation-Annotations">Annotations</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface LogInputOutput
{
}</pre>
</div></div></td></tr></tbody></table></div><p><br/></p><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface TrackTime
{
}</pre>
</div></div></td></tr></tbody></table></div><h3 id="EligibilityRulesImplementation-Usage">Usage</h3><div class="table-wrap"><table data-layout="default" class="confluenceTable"><tbody><tr><td data-highlight-colour="#ffffff" class="confluenceTd"><div class="code panel pdl" style="border-width: 1px;"><div class="codeContent panelContent pdl">
<pre class="syntaxhighlighter-pre" data-syntaxhighlighter-params="brush: java; gutter: false; theme: Confluence" data-theme="Confluence">@LogInputOutput
@GetMapping(&quot;/rules/duties&quot;)
public @ResponseBody
ResponseEntity&lt;Resources&lt;Resource&lt;RulePresentation&gt;&gt;&gt; getRulesDuties()
{...}</pre>
</div></div></td></tr></tbody></table></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" role="contentinfo">
                <section class="footer-body">
                    <p>Document generated by Confluence on Feb 12, 2021 23:35</p>
                    <div id="footer-logo"><a href="http://www.atlassian.com/">Atlassian</a></div>
                </section>
            </div>
        </div>     </body>
</html>
